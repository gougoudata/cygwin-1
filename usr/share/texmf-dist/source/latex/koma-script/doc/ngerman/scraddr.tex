% ======================================================================
% scraddr.tex
% Copyright (c) Markus Kohm, 2001-2012
%
% This file is part of the LaTeX2e KOMA-Script bundle.
%
% This work may be distributed and/or modified under the conditions of
% the LaTeX Project Public License, version 1.3c of the license.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of LaTeX 
% version 2005/12/01 or later and of this work.
%
% This work has the LPPL maintenance status "author-maintained".
%
% The Current Maintainer and author of this work is Markus Kohm.
%
% This work consists of all files listed in manifest.txt.
% ----------------------------------------------------------------------
% scraddr.tex
% Copyright (c) Markus Kohm, 2001-2012
%
% Dieses Werk darf nach den Bedingungen der LaTeX Project Public Lizenz,
% Version 1.3c, verteilt und/oder veraendert werden.
% Die neuste Version dieser Lizenz ist
%   http://www.latex-project.org/lppl.txt
% und Version 1.3c ist Teil aller Verteilungen von LaTeX
% Version 2005/12/01 oder spaeter und dieses Werks.
%
% Dieses Werk hat den LPPL-Verwaltungs-Status "author-maintained"
% (allein durch den Autor verwaltet).
%
% Der Aktuelle Verwalter und Autor dieses Werkes ist Markus Kohm.
% 
% Dieses Werk besteht aus den in manifest.txt aufgefuehrten Dateien.
% ======================================================================
%
% Chapter about scraddr of the KOMA-Script guide
% Maintained by Jens-Uwe Morawski (with help from Markus Kohm)
%
% ----------------------------------------------------------------------
%
% Kapitel über scraddr in der KOMA-Script-Anleitung
% Verwaltet von Jens-Uwe Morawski (mit Unterstützung von Markus Kohm)
%
% ======================================================================

\ProvidesFile{scraddr.tex}[2011/09/30 KOMA-Script guide (chapter: scraddr)]

\chapter{Adressdateien mit \Package{scraddr} erschließen}%
\labelbase{scraddr}%
\BeginIndex{Package}{scraddr}

\section{Überblick}\label{sec:scraddr.overview}
Das Paket \Package{scraddr} ist eine kleine Beigabe zur
Briefklasse von \KOMAScript.  Ziel ist, die Benutzung von Adressdateien zu
vereinfachen und ihre Anwendung flexibler zu gestalten.  Im Grunde stellt das
Paket nur einen Lademechanismus für Adressdateien bereit, die aus
\Macro{adrentry}- und neueren \Macro{addrentry}-Einträgen bestehen, wie sie in
\autoref{cha:scrlttr2} ab \autopageref{desc:scrlttr2.cmd.adrentry} beschrieben
sind.


\begin{Declaration}
\Macro{InputAddressFile}\Parameter{Dateiname}
\end{Declaration}%
\BeginIndex{Cmd}{InputAddressFile}%
Der Befehl \Macro{InputAddressFile} ist der zentrale Ladebefehl
von \Package{scraddr}.
Er erwartet als obligatorisches Argument den
Namen der einzulesenden Adressdatei.\Index{Adressdatei}
Wird diese Datei nicht gefunden, wird ein Fehler ausgegeben.

Für jeden Eintrag dieser Adressdatei wird eine Reihe von Makros generiert,
die es ermöglichen, auf die Daten der Adressdatei zuzugreifen. Es soll an
dieser Stelle nicht verschwiegen werden, dass dies bei großen Adressdateien
sehr viel \TeX-Speicher kostet.

\begin{Declaration}%
  \Macro{adrentry}\Parameter{Name}\Parameter{Vorname}\Parameter{Adresse}%
  \Parameter{Tel.}\Parameter{F1}\Parameter{F2}%
  \Parameter{Kommentar}\\
  \hphantom{\Macro{adrentry}}\Parameter{Kürzel}\\
  %
  \Macro{addrentry}\Parameter{Name}\Parameter{Vorname}\Parameter{Adresse}%
  \Parameter{Tel.}\Parameter{F1}\Parameter{F2}%
  \Parameter{F3}\Parameter{F4}\\
  \hphantom{\Macro{addrentry}}\Parameter{Kürzel}\\
  %
  \Macro{adrchar}\Parameter{Anfangsbuchstaben}\\
  \Macro{addrchar}\Parameter{Anfangsbuchstaben}%
\end{Declaration}%
\IndexCmd{adrentry}%
\IndexCmd{addrentry}%
\IndexCmd{adrchar}%
\IndexCmd{addrchar}%
Der Aufbau der Adresseinträge in der Adressdatei wurde in
\autoref{sec:scrlttr2.addressFile} ab
\autopageref{desc:scrlttr2.cmd.adrentry} ausführlich besprochen. Die
ebenfalls dort erwähnte Unterteilung der Adressdatei mit Hilfe von
\Macro{adrchar} oder \Macro{addrchar} hat für \Package{scraddr} keine
Bedeutung und wird vom Paket ignoriert.

Die Zugriffsbefehle sind mit englischen, den Argumenten entsprechenden
Bezeichnungen versehen.
\begin{Declaration}
\Macro{Name}\Parameter{Kürzel}\\
\Macro{FirstName}\Parameter{Kürzel}\\
\Macro{LastName}\Parameter{Kürzel}\\
\Macro{Address}\Parameter{Kürzel}\\
\Macro{Telephone}\Parameter{Kürzel}\\
\Macro{FreeI}\Parameter{Kürzel}\\
\Macro{FreeII}\Parameter{Kürzel}\\
\Macro{Comment}\Parameter{Kürzel}\\
\Macro{FreeIII}\Parameter{Kürzel}\\
\Macro{FreeIV}\Parameter{Kürzel}
\end{Declaration}%
\BeginIndex{Cmd}{Name}\BeginIndex{Cmd}{FirstName}\BeginIndex{Cmd}{LastName}%
\BeginIndex{Cmd}{Address}\BeginIndex{Cmd}{Telephone}\BeginIndex{Cmd}{FreeI}%
\BeginIndex{Cmd}{FreeII}\BeginIndex{Cmd}{FreeIII}\BeginIndex{Cmd}{FreeIV}%
\BeginIndex{Cmd}{Comment}%
Der Zugriff erfolgt anhand des Kürzels im letzten Argument eines
Eintrags, das heißt Argument Nummer 8
für \Macro{adrentry}-Einträge beziehungsweise Argument Nummer 9
für \Macro{addrentry}-Einträge. Das bedeutet auch, dass dieses Argument
nicht leer sein darf.
Um eine sichere Funktionsweise zu garantieren, empfiehlt es sich,
das Kürzel nur als Folge von Buchstaben aufzubauen,
wobei jedoch keine Umlaute benutzt werden dürfen.

Weiterhin ist zu beachten, dass bei mehrmaligem Auf"|treten
eines Kürzels in den Einträgen die Angaben beim
letzten Auf"|treten die gültigen sind.%
%
\EndIndex{Cmd}{InputAddressFile}%
\EndIndex{Cmd}{Name}\EndIndex{Cmd}{FirstName}\EndIndex{Cmd}{LastName}%
\EndIndex{Cmd}{Address}\EndIndex{Cmd}{Telephone}\EndIndex{Cmd}{FreeI}%
\EndIndex{Cmd}{FreeII}\EndIndex{Cmd}{FreeIII}\EndIndex{Cmd}{FreeIV}%
\EndIndex{Cmd}{Comment}%


\section{Benutzung}\label{sec:scraddr.usage}

Um das Paket benutzen zu können, ist eine gültige
Adressdatei zu erstellen.
Diese, hier \File{lotr.adr} genannt, könnte beispielsweise
folgendermaßen aussehen:
\begin{lstcode}
  \addrentry{Beutlin}{Frodo}%
            {Der Bühl\\ Beutelsend/Hobbingen im Auenland}{}%
            {Bilbo Beutlin}{Rauchen von Pfeifenkraut}%
            {der Ringträger}{Bilbos Erbe}{FRODO}
  \adrentry{Gamdschie}{Samweis}%
           {Beutelhaldenweg 3\\Hobbingen im Auenland}{}%
           {Rosie Kattun}{Knullen}%
           {des Ringträgers treuester Gefährte}{SAM}
  \adrentry{Bombadil}{Tom}%
           {Im Alten Wald}{}%
           {Goldbeere}{trällern von Nonsensliedern}%
           {Meister von Wald, Wasser und Berg}{TOM}
\end{lstcode}

Das vierte Argument, die Telefonnummer, wurde hier leer gelassen.
Erstens hat es in dem Zusammenhang keinen Sinn, und zweitens sollte
dies ja auch möglich sein.

Mit dem oben beschriebenen Ladebefehl lesen wir die Adressdatei
in unser Briefdokument ein:
\begin{lstcode}[belowskip=\dp\strutbox]
  \InputAddressFile{lotr}
\end{lstcode}

Mit Hilfe der vorgestellten Makros können wir dann einen Brief
an den alten \textsc{Tom Bombadil} schreiben, in dem wir ihn
fragen, ob er sich noch an zwei Gefährten aus alter Zeit
erinnern kann.
\begin{lstcode}[belowskip=\dp\strutbox]
  \begin{letter}{\Name{TOM}\\\Address{TOM}}
    \opening{Lieber \FirstName{TOM} \LastName{TOM},}
     
    oder \FreeIII{TOM}, wie Dich Deine geliebte \FreeI{TOM}
    nennt. Kannst Du Dich noch an einen Herrn 
    \LastName{FRODO}, genauer gesagt \Name{FRODO}, denn es gab
    ja auch noch den Herrn \FreeI{FRODO}, erinnern. Er war 
    \Comment{FRODO} im dritten Zeitalter und \FreeIV{FRODO}.
    Begleitet wurde er von \Name{SAM}, \Comment{SAM}.
      
    Beider Vorlieben waren sehr weltlich. Der 
    \FirstName{FRODO} genoss das \FreeII{FRODO}, sein Gefährte
    schätzte eine gute Mahlzeit mit \FreeII{SAM}.
      
    Weißt du noch? Mithrandir hat Dir bestimmt viel von ihnen 
    erzählt.
    \closing{"`O Frühling und Sommerzeit
                 und danach wieder Frühling!\\
               O Wind auf dem Wasserfall
                 und Lachen des Laubes!"'}
  \end{letter}
\end{lstcode}
Die in diesem Beispiel in \Macro{opening} verwendete Zusammensetzung aus
\Macro{FirstName}\Parameter{Kürzel} und \Macro{LastName}\Parameter{Kürzel}
kann auch direkt mittels \Macro{Name}\Parameter{Kürzel} erhalten werden.

Das fünf"|te und sechste Argument von \Macro{adrentry} und
\Macro{addrentry} steht zur freien Verfügung.
Mit den Makros \Macro{FreeI} und \Macro{FreeII} kann auf
diese Inhalte zugegriffen werden. Im vorliegenden Fall wurde
das fünf"|te Argument für die Person benutzt, die der Person des
Eintrags am nächsten steht. Das sechste Argument
enthält im Beispiel die besondere Vorliebe der jeweiligen Person.
Das siebente Argument ist ebenfalls ein freier Eintrag. Der Zugriff
erfolgt per \Macro{Comment} oder \Macro{FreeIII}.
Der Zugriff auf das vierte freie Argument mittels \Macro{FreeIV}
ist nur für \Macro{addrentry}-Einträge gültig.
Bei \Macro{adrentry}-Einträgen ist seine Verwendung nicht zulässig. Näheres
hierzu finde sich im nächsten Abschnitt.

\section{Paketoptionen für Warnungen}

Wie im vorherigen Abschnitt erwähnt, ist die Benutzung des Zugriffsbefehls
\Macro{FreeIV} bei \Macro{adrentry}-Einträgen nicht zulässig. Wie
\Package{scraddr} darauf reagiert, ist allerdings durch Paketoptionen
konfigurierbar.


\begin{Declaration}
\Option{adrFreeIVempty}\\
\Option{adrFreeIVshow}\\
\Option{adrFreeIVwarn}\\
\Option{adrFreeIVstop}
\end{Declaration}
\BeginIndex{Option}{adrFreeIVempty}%
\BeginIndex{Option}{adrFreeIVshow}%
\BeginIndex{Option}{adrFreeIVwarn}%
\BeginIndex{Option}{adrFreeIVstop}%
Diese vier Optionen erlauben die Auswahl aus vier verschiedenen
Reaktionen zwischen \emph{Ignorieren} bis \emph{Abbruch} falls bei einem
\Macro{adrentry}-Eintrag der Zugriffsbefehl \Macro{FreeIV} verwendet wird:
%
\begin{labeling}[~--]{\Option{adrFreeIVempty}}
\item[\Option{adrFreeIVempty}] 
        Der Befehl \Macro{FreeIV} wird einfach ignoriert.
\item[\Option{adrFreeIVshow}] 
        Es wird die Warnung: »(entry FreeIV undefined at \PName{Kürzel})«,
           in den Text geschrieben.
\item[\Option{adrFreeIVwarn}]
        In der Log-Datei erscheint eine Warnung.
\item[\Option{adrFreeIVstop}]
        Der \LaTeX{}-Lauf wird mit einer Fehlermeldung unterbrochen.
\end{labeling}
Zur Auswahl der gewünschten Reaktion wird die entsprechende Option beim Laden
des Pakets im optionalen Argument des \Macro{usepackage}-Befehls übergeben.
Die standardmäßige Einstellung für das Paket \Package{scraddr} ist die Option
\Option{adrFreeIVshow}.%
%
\EndIndex{Option}{adrFreeIVempty}\EndIndex{Option}{adrFreeIVshow}%
\EndIndex{Option}{adrFreeIVwarn}\EndIndex{Option}{adrFreeIVstop}

\endinput

%%% Local Variables: 
%%% mode: latex
%%% coding: iso-latin-1
%%% TeX-master: "../guide"
%%% End: 
