<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
<title>EMF: libEMF: Enhanced Metafile Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.5.9-20090622 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>libEMF: Enhanced Metafile Library</h1><h3>1.0 </h3><p>Table of Contents</p>
<ul>
<li><a class="el" href="index.html#intro">Introduction</a></li>
<li><a class="el" href="index.html#compilation">Compilation</a></li>
<li><a class="el" href="index.html#documentation">Documentation</a></li>
<li><a class="el" href="index.html#example">Example</a></li>
<li><a class="el" href="index.html#acknowledgements">Acknowledgements</a></li>
</ul>
<h2><a class="anchor" id="intro">
Introduction</a></h2>
<p>libEMF is a C/C++ library which provides a drawing toolkit based on <a href="http://www.ecma.ch/ecma1/STAND/ECMA-234.HTM">ECMA-234</a>. The general purpose of this library is to create vector graphics files on POSIX systems which can be imported into <a href="http://www.sun.com/staroffice/">StarOffice</a>/<a href="http://www.openoffice.org">OpenOffice.org</a>. The Enhanced MetaFile (EMF) is one of the two color vector graphics format which is "vectorially" understood by SO/OO.org. (SO/OO.org can import Encapsulated PostScript files, but will only display it if it has a bitmap preview image. SO/OO.org can also import a DXF file, but as near as I can tell, this is only monochrome. OpenOffice now has an XML based file format; in the future, use of this format will probably supplant this library.) The EMF format also has the additional advantage that it can be "broken" into its constituent components and edited like any other SO/OO.org graphics object.</p>
<p>My general interest in this library is for making scientific plots with <a href="http://www.gnuplot.org/">gnuplot</a> and <a href="http://plasma-gate.weizmann.ac.il/Grace/">Grace</a>(forthcoming). Therefore, this software includes patches to those programs to add the EMF as an output option. This library is mostly limited to the graphics commands required for gnuplot and Grace output drivers, though it's trivial to add new ones.</p>
<p>It is also possible now to generate EMF files from <a href="http://www.pstoedit.net/pstoedit/">PSTOEDIT</a> on POSIX systems. Therefore, if your graphics code only outputs PostScript, you can now easily convert it to EMF.</p>
<p><a href="http://sourceforge.net/projects/libemf">libEMF is hosted on SourceForge.</a> If you have questions or comments, try out the <a href="mailto:libemf-devel@lists.sourceforge.net">libEMF mailing list.</a></p>
<h2><a class="anchor" id="compilation">
Compilation</a></h2>
<p>libEMF uses a standard autoconf-generated configure script to prepare it for compilation. If you want to activate printing of EMF records, run the configure script with: </p>
<div class="fragment"><pre class="fragment">./configure --enable-editing
</pre></div><p>A single program is provided which can print the complete contents of a metafie (as far as the library understands them, anyway),</p>
<div class="fragment"><pre class="fragment">printemf metafile.emf
</pre></div><h2><a class="anchor" id="documentation">
Documentation</a></h2>
<p>The documentation of this project is generated with Doxygen and is largely for the internals of the library. However, the graphics commands which are available from C are <a href="libemf_8cpp.html">given here</a>.</p>
<h2><a class="anchor" id="example">
Example</a></h2>
<p>You will probably only use libEMF in the context of an output driver for another graphics program, but should you want to do some custom graphics generation, here is an annotated example.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;emf.h&gt;</span> <span class="comment">// Will depend on your installation of libEMF</span>

<span class="keywordtype">int</span> main ( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[] )
{
</pre></div><p>The first step is to create a device context for the metafile. The usual way this is accomplished is by acquiring a copy of the "desktop" device context and using it as a starting point for the metafile device context. libEMF supports the commands GetDesktopWindow() and GetDC(), but they are just dummy functions. The metafile device context has its own internal definitions.</p>
<p>The metafile creation subroutine takes four arguments (the first of which, the reference device context as obtained above, is ignored). The second argument is the path name of the metafile; you can use whatever name is valid on the system, but SO/OO.org prefers the file to end with the .emf extension. The third argument gives the size and position of the metafile; since SO/OO.org ignores the position, the first two values should be zero; the second pair of values should give the desired physical width and height of the drawing in units of 1/1000-th centimeters. The last argument to the creation routine is the description of the metafile; by convention, this consists of two null-terminated strings with an extra '\0' at the end.</p>
<div class="fragment"><pre class="fragment">   HWND desktop = GetDesktopWindow();
   HDC dc = GetDC( desktop );

   RECT size = { 0, 0, 10000, 10000 }; <span class="comment">// 10cm x 10cm</span>
   PCSTR filename = <span class="stringliteral">&quot;example.emf&quot;</span>;
   PCSTR description = <span class="stringliteral">&quot;Example metafile created\0with libEMF\0&quot;</span>;

   HDC metaDC = CreateEnhMetaFile( 0, filename, &amp;size, description );
</pre></div><p>Next, we want to set the drawing properties of the pen, brush and font to something other than the default, say a wide, cyan pen and a solid, blue brush, and a bold Helvetica font.</p>
<div class="fragment"><pre class="fragment">   LOGPEN lpen = { PS_SOLID, {2000,2000}, RGB(0,0xff,0xff) };
   LOGBRUSH lbrush = { BS_SOLID, RGB(0x0,0x0,0xff), HS_HORIZONTAL };
   HPEN pen = CreatePenIndirect( &amp;lpen );
   HBRUSH brush = CreateBrushIndirect( &amp;lbrush );
   HFONT font = CreateFont( -1100, 0, 0, 0, FW_BOLD, 0, 0, 0, ANSI_CHARSET,
                      OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS, DEFAULT_QUALITY,
                      DEFAULT_PITCH | FF_DONTCARE, <span class="stringliteral">&quot;Helvetica&quot;</span> );

   <span class="comment">// Make these the active objects for their respective types</span>

   SelectObject( metaDC, pen );
   SelectObject( metaDC, brush );
   SelectObject( metaDC, font );
</pre></div><p>Set the window size to the natural coordinates of the drawing. Here, we want to draw on a 100x100 grid.</p>
<div class="fragment"><pre class="fragment">   SetWindowExtEx( metaDC, 100, 100, 0 );
</pre></div><p>Now, we can draw as we like. For example, we'll make a solid background with some text centered in the window.</p>
<div class="fragment"><pre class="fragment">   Rectangle( metaDC, 0, 0, 100, 100 );

   SetTextColor( metaDC, RGB(0,0xff,0) );
   SetTextAlign( metaDC, TA_CENTER+TA_BASELINE );
   SetBkMode( metaDC, TRANSPARENT );
   TextOutA( metaDC, 50, 50, <span class="stringliteral">&quot;Welcome to libEMF&quot;</span>, 17 );
</pre></div><p>Finally, the metafile is written to disk when the metafile is closed. Delete the metafile and its assocated device context to free all the memory they have consumed.</p>
<div class="fragment"><pre class="fragment">   metafile = CloseEnhMetaFile( metaDC );
   DeleteEnhMetaFile( metafile );
   DeleteDC( metaDC );

   <span class="keywordflow">return</span> 0;
}
</pre></div><p>This is result of importing example.emf into OO.org and exporting the drawing as a PNG file (after using The GIMP to crop the transparent boundary).</p>
<div align="center">
<img src="example.png" alt="example.png"/>
</div>
<h2><a class="anchor" id="acknowledgements">
Acknowledgements</a></h2>
<p>Special thanks to Wolfgang Glunz (<a href="mailto:wglunz@pstoedit.net">wglunz@pstoedit.net</a>) for suggestions and help testing.</p>
<hr/>
 Copyright &copy; 2002 lignum Computing, Inc., <a href="mailto:dallenbarnett@users.sourceforge.net">dallenbarnett@users.sourceforge.net</a></p>
 
<HR>
Hosted by <a href="http://sourceforge.net/projects/libemf"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=31968&amp;type=8" width="80" height="15" alt="Get ECMA-234 Metafile Library at SourceForge.net. Fast, secure and Free Open Source software downloads" /></a>
 </div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Thu May 24 08:29:26 2012 for EMF by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.5.9-20090622 </small></address>
</body>
</html>
