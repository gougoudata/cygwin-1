# Generate automatically. Do not edit.

commit 4fd057258177f4f14bbe78c2d02d5a65eaf3f3dc
Author: Stef Walter <stefw@gnome.org>
Date:   2013-05-27

    Release version 0.19.1

 NEWS         | 11 +++++++++++
 configure.ac |  2 +-
 2 files changed, 12 insertions(+), 1 deletion(-)

commit e98522ba9e92be79526eba9daee9f60aa30ad942
Author: Stef Walter <stefw@gnome.org>
Date:   2013-05-21

    Mark p11_kit_message() as a stable function

 doc/manual/p11-kit-sections.txt | 2 +-
 p11-kit/p11-kit.h               | 4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

commit 61a9cfa62972678f1cbbad7f4d1a814e9b7f05e2
Author: Stef Walter <stefw@gnome.org>
Date:   2013-05-21

    Fix building of applications using CRYPTOKI_GNU style

 p11-kit/p11-kit.h | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

commit 435843812ab7b85f97cfdc32ae9412f78242b950
Author: Stef Walter <stefw@gnome.org>
Date:   2013-05-21

    Bump the version for deprecated function documentation

 p11-kit/modules.c | 18 +++++++++---------
 1 file changed, 9 insertions(+), 9 deletions(-)

commit 30830eb693ac2e89f28bb34459db6837031ca795
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-09

    Fix up Makefile.am files for automake 1.13 warnings

 common/tests/Makefile.am  | 4 ++--
 p11-kit/Makefile.am       | 2 +-
 p11-kit/tests/Makefile.am | 2 +-
 tools/Makefile.am         | 2 +-
 tools/tests/Makefile.am   | 2 +-
 trust/Makefile.am         | 2 +-
 trust/tests/Makefile.am   | 2 +-
 7 files changed, 8 insertions(+), 8 deletions(-)

commit dcabaf1d56d410ba7ddb3dfbab9011bbbea5e6bc
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-05

    Our own unit testing framework
    
     * Support the TAP protocol
     * Much cleaner without having to carry around state
     * First class support for setup/teardown
     * Port the common tests
     * Wait on porting other tests until we've merged outstanding code

 build/Makefile.am               |    8 -
 build/Makefile.tests            |    5 +-
 build/cutest/CuTest.c           |  329 ----------
 build/cutest/CuTest.h           |  111 ----
 build/cutest/README.txt         |  211 -------
 build/cutest/license.txt        |   38 --
 common/Makefile.am              |    5 +-
 common/debug.h                  |    2 +
 common/test.c                   |  261 ++++++++
 common/test.h                   |  131 ++++
 common/tests/Makefile.am        |    3 +-
 common/tests/test-array.c       |  101 ++--
 common/tests/test-asn1.c        |   53 +-
 common/tests/test-attrs.c       |  461 +++++++-------
 common/tests/test-base64.c      |   67 +--
 common/tests/test-buffer.c      |  113 ++--
 common/tests/test-compat.c      |   28 +-
 common/tests/test-constants.c   |   45 +-
 common/tests/test-dict.c        |  250 ++++----
 common/tests/test-hash.c        |   74 +--
 common/tests/test-lexer.c       |  126 ++--
 common/tests/test-oid.c         |   45 +-
 common/tests/test-path.c        |   68 +--
 common/tests/test-pem.c         |   76 +--
 common/tests/test-url.c         |   93 ++-
 common/tests/test-utf8.c        |   60 +-
 common/tests/test-x509.c        |  106 ++--
 p11-kit/tests/Makefile.am       |   14 +-
 p11-kit/tests/conf-test.c       |  428 -------------
 p11-kit/tests/pin-test.c        |  325 ----------
 p11-kit/tests/progname-test.c   |   98 ---
 p11-kit/tests/test-conf.c       |  414 +++++++++++++
 p11-kit/tests/test-deprecated.c |  187 +++---
 p11-kit/tests/test-init.c       |  144 ++---
 p11-kit/tests/test-iter.c       |  481 ++++++++-------
 p11-kit/tests/test-log.c        |   41 +-
 p11-kit/tests/test-managed.c    |   97 ++-
 p11-kit/tests/test-mock.c       | 1012 +++++++++++++++----------------
 p11-kit/tests/test-modules.c    |  157 +++--
 p11-kit/tests/test-pin.c        |  313 ++++++++++
 p11-kit/tests/test-progname.c   |   86 +++
 p11-kit/tests/test-proxy.c      |   75 +--
 p11-kit/tests/test-uri.c        | 1245 ++++++++++++++++++++++++++++++++++++++
 p11-kit/tests/test-virtual.c    |   70 +--
 p11-kit/tests/uri-test.c        | 1258 ---------------------------------------
 tools/tests/Makefile.am         |    6 +-
 tools/tests/test-extract.c      |  221 +++----
 tools/tests/test-openssl.c      |  186 +++---
 tools/tests/test-pem.c          |   96 +--
 tools/tests/test-save.c         |  329 +++++-----
 tools/tests/test-tools.c        |  216 +++++++
 tools/tests/test-tools.h        |  260 ++++++++
 tools/tests/test-x509.c         |  102 ++--
 tools/tests/test.c              |  209 -------
 tools/tests/test.h              |  260 --------
 trust/tests/Makefile.am         |    5 +-
 trust/tests/test-builder.c      |  446 +++++---------
 trust/tests/test-data.c         |  160 -----
 trust/tests/test-data.h         |  273 ---------
 trust/tests/test-index.c        |  395 ++++++------
 trust/tests/test-module.c       |  470 ++++++---------
 trust/tests/test-parser.c       |  219 +++----
 trust/tests/test-persist.c      |  155 +++--
 trust/tests/test-token.c        |   93 +--
 trust/tests/test-trust.c        |  152 +++++
 trust/tests/test-trust.h        |  273 +++++++++
 66 files changed, 6277 insertions(+), 7564 deletions(-)

commit 7fd6d89d92b6f1b543bf2aa4b2e578201dad7147
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-06

    Further reorganization of the core module tracking
    
     * Keep the module ownership apart from the tracking of module
       function pointers, since these are only relevant for unmanaged
       modules.
     * Less assumptions that each module has a raw unmanaged module
       function pointer.
     * More clarity in the naming of dictionaries tracking the modules.

 p11-kit/modules.c | 349 +++++++++++++++++++++++++-----------------------------
 1 file changed, 161 insertions(+), 188 deletions(-)

commit eb88be6c0b7ea39a74cd2aa8af33371de4aeb74c
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-07

    Pull the argv parsing code into its own file
    
    So it can be used from multiple code paths

 common/Makefile.am |   1 +
 common/argv.c      | 115 +++++++++++++++++++++++++++++++++++++++++++++++++++++
 common/argv.h      |  44 ++++++++++++++++++++
 trust/module.c     |  78 ++----------------------------------
 4 files changed, 164 insertions(+), 74 deletions(-)

commit 7b848defc704cc1fbb47a16b23727583c14b804d
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-06

    Support /xxx/yyy as an absolute path with Win32
    
    Because win32 code doesn't just run on windows, wine runs
    with unix style paths.

 common/path.c            | 8 ++++----
 common/tests/test-path.c | 2 +-
 2 files changed, 5 insertions(+), 5 deletions(-)

commit 10d26767fa39f43b0aabb82d73ed88b2c2522397
Author: Stef Walter <stefw@gnome.org>
Date:   2013-05-21

    Bump the version number to unstable

 configure.ac | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit b73f4ef126bdead47262e29e47d159a89984d65f
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-19

    Add the log-calls module config option
    
    If 'log-calls = yes' is set then all the PKCS#11 modules are logged
    to stderr.

 common/attrs.c                 |   22 +-
 common/attrs.h                 |    9 +
 common/constants.c             |  350 ++++++-
 common/constants.h             |    8 +
 common/tests/test-constants.c  |   18 +-
 doc/manual/Makefile.am         |    1 +
 doc/manual/p11-kit-sharing.xml |    5 +
 doc/manual/pkcs11.conf.xml     |   19 +
 p11-kit/Makefile.am            |    1 +
 p11-kit/log.c                  | 2022 ++++++++++++++++++++++++++++++++++++++++
 p11-kit/log.h                  |   53 ++
 p11-kit/modules.c              |   44 +-
 p11-kit/tests/Makefile.am      |    1 +
 p11-kit/tests/test-log.c       |  125 +++
 p11-kit/tests/test-mock.c      |    4 +-
 15 files changed, 2646 insertions(+), 36 deletions(-)

commit a14ff781ebf231daa99990fd65c2312f26db93a8
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-19

    Manage C_CloseAllSessions function for multiple callers
    
    Make C_CloseAllSessions work for different callers. Track the sessions
    that each caller opens and close just those when C_CloseAllSessiosn is
    called.

 common/mock.c                  |   2 +-
 doc/manual/p11-kit-sharing.xml |   6 ++
 p11-kit/modules.c              | 202 ++++++++++++++++++++++++++++++++++++++++-
 p11-kit/tests/test-init.c      |   9 +-
 p11-kit/tests/test-managed.c   |  64 ++++++++++++-
 5 files changed, 275 insertions(+), 8 deletions(-)

commit 0cb1132469c1e13be64f85cd6566e6617bfe32cc
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-15

    Update the proxy module to use managed PKCS#11 modules
    
    Each time C_GetFunctionList is called on the proxy module, a new
    managed PKCS#11 set of functions is returned. These are all cleaned
    up when the module is unloaded.
    
    We want the proxy module to continue to work even without the highly
    recommended libffi. For that reason we still keep the old behavior of
    sharing state in the proxy module.

 common/mock.c              |    9 -
 common/mock.h              |   11 +
 doc/manual/Makefile.am     |    1 +
 p11-kit/Makefile.am        |    2 +-
 p11-kit/modules.c          |    5 +-
 p11-kit/private.h          |    4 -
 p11-kit/proxy.c            | 1465 +++++++++++++++++++++++++++++++++++++-------
 p11-kit/proxy.h            |   45 ++
 p11-kit/tests/test-mock.c  |   26 +-
 p11-kit/tests/test-proxy.c |  116 +++-
 p11-kit/util.c             |    3 +
 11 files changed, 1422 insertions(+), 265 deletions(-)

commit 5c19f0cf66495f00ccf69eba1d0915f862a88c8d
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-06

    p11-kit: Managed PKCS#11 module loading
    
    Support a new managed style module loading for PKCS#11 modules. This
    allows us to better coordinate between multiple callers of the same
    PKCS#11 modules and provide hooks into their behavior.
    
    This meant redoing the public facing API. The old methods are now
    deprecated, marked and documented as such.

 common/compat.c                             |    6 +
 common/compat.h                             |    4 +-
 common/mock.c                               |   63 +-
 common/mock.h                               |    6 +-
 doc/manual/Makefile.am                      |    2 +
 doc/manual/p11-kit-docs.xml                 |    2 +
 doc/manual/p11-kit-proxy.xml                |   29 +
 doc/manual/p11-kit-sections.txt             |   39 +-
 doc/manual/p11-kit-sharing.xml              |   94 +-
 doc/manual/pkcs11.conf.xml                  |   24 +
 gtk-doc.make                                |    2 +-
 p11-kit/Makefile.am                         |    7 +-
 p11-kit/deprecated.h                        |   97 ++
 p11-kit/docs.h                              |   38 +
 p11-kit/modules.c                           | 1498 ++++++++++++++++++++----
 p11-kit/modules.h                           |   51 +
 p11-kit/p11-kit.h                           |   63 +-
 p11-kit/private.h                           |    6 -
 p11-kit/proxy.c                             |  231 ++--
 p11-kit/tests/Makefile.am                   |   10 +-
 p11-kit/tests/files/system-pkcs11.conf      |    5 +-
 p11-kit/tests/files/user-modules/one.module |    3 +-
 p11-kit/tests/test-deprecated.c             |  521 +++++++++
 p11-kit/tests/test-init.c                   |  176 ++-
 p11-kit/tests/test-iter.c                   |   72 +-
 p11-kit/tests/test-managed.c                |  168 +++
 p11-kit/tests/test-mock.c                   | 1687 +++++++++++++++++++++++++++
 p11-kit/tests/test-modules.c                |  124 +-
 p11-kit/tests/test-proxy.c                  |   94 ++
 tools/extract.c                             |   15 +-
 tools/list.c                                |   16 +-
 tools/tests/test-extract.c                  |    7 +-
 tools/tests/test-openssl.c                  |    9 +-
 tools/tests/test-pem.c                      |    9 +-
 tools/tests/test-x509.c                     |    9 +-
 trust/tests/frob-nss-trust.c                |   25 +-
 36 files changed, 4660 insertions(+), 552 deletions(-)

commit ff853bd7902e271256cada4a1b20a3d46b519b69
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-10

    Use libffi to implement mixins for managed code
    
     * This allows us to call into subclassed PKCS#11 modules as if
       they were plain old PKCS#11 modules
     * libffi is an optional dependency

 configure.ac                 |   31 +
 doc/manual/Makefile.am       |    5 +-
 doc/manual/p11-kit-devel.xml |    3 +
 p11-kit/Makefile.am          |    7 +-
 p11-kit/tests/Makefile.am    |    7 +
 p11-kit/tests/test-virtual.c |  183 +++
 p11-kit/virtual.c            | 2964 ++++++++++++++++++++++++++++++++++++++++++
 p11-kit/virtual.h            |   68 +
 8 files changed, 3265 insertions(+), 3 deletions(-)

commit a7af75a31010109529a9edddc825538884f326ca
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-14

    Add subclassable CK_X_FUNCTION_LIST
    
    One of the flaws in PKCS#11 for our usage is that each PKCS#11 module
    is not passed the pointer to the function list, ie: the vtable
    
    Here we define a new function list vtable, where each PKCS#11 function
    takes the vtable itself as the first argument. We use this new
    list internally to represent subclassable PKCS#11 modules for
    various features.

 common/mock.c    | 757 ++++++++++++++++++++++++++++++++++++++++++++++++++++++-
 common/mock.h    | 370 ++++++++++++++++++++++++++-
 common/pkcs11x.h | 438 ++++++++++++++++++++++++++++++++
 3 files changed, 1561 insertions(+), 4 deletions(-)

commit 06a84bafc7c5f0ac92883e9219a7c00f456df39c
Author: Stef Walter <stefw@gnome.org>
Date:   2013-05-15

    Fail early when running automaint.sh

 automaint.sh | 2 ++
 1 file changed, 2 insertions(+)

commit de8b99e2f04f94313a7748adedf7535603013951
Author: Stef Walter <stefw@gnome.org>
Date:   2013-05-15

    Implement valgrind's hellgrind checks for threading problems
    
    And cleanup our locks/locking model. There's no need to use
    recursive locks, especially since we can't use them on all
    platforms. In addition adjust taking of locks during initialization
    so that there's no chance of deadlocking here.

 automaint.sh         | 2 +-
 build/Makefile.decl  | 5 +++++
 build/Makefile.tests | 5 +++++
 common/compat.c      | 2 +-
 p11-kit/modules.c    | 2 +-
 5 files changed, 13 insertions(+), 3 deletions(-)

commit 4bd7eda265b94dfcb9a1db4aba756e1e05dd4f87
Author: Stef Walter <stefw@gnome.org>
Date:   2013-05-14

    Release version 0.18.2

 NEWS         | 3 +++
 configure.ac | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

commit c6793097e6f0d82cfca07aaeb55c7e9b742d2fdf
Author: manphiz@gmail.com <manphiz@gmail.com>
Date:   2013-05-09

    Patch to make test-lexer depend on ASN.1
    
    https://bugs.freedesktop.org/show_bug.cgi?id=64378

 common/tests/Makefile.am | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit e72df3c2546a79f51e7c203bc5735494d45c5c26
Author: Stef Walter <stefw@redhat.com>
Date:   2013-05-03

    Reduce libtasn1 dependency to 2.3
    
     * This passes all checks and is compatible

 configure.ac | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 32e26b5c1852fd7b0261929e3a9b39c473621fd2
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-15

    Release version 0.18.1

 NEWS         | 4 ++++
 configure.ac | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

commit d4392aef7fa3a3b2c308ad3d05c691569361ee49
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-04

    doc: Use gtk-doc in the no-tmpl flavor

 doc/manual/Makefile.am |  6 ++++++
 gtk-doc.make           | 39 +++++++++------------------------------
 2 files changed, 15 insertions(+), 30 deletions(-)

commit 153dc7a750a11d7940f4e4e6e718939d23ee4541
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-04

    manual: Use a consistent docbook version

 doc/manual/p11-kit-config.xml  | 5 +++--
 doc/manual/p11-kit-devel.xml   | 5 +++--
 doc/manual/p11-kit-sharing.xml | 5 +++--
 doc/manual/p11-kit-trust.xml   | 5 +++--
 doc/manual/p11-kit.xml         | 4 ++--
 doc/manual/pkcs11.conf.xml     | 4 ++--
 6 files changed, 16 insertions(+), 12 deletions(-)

commit 3e5916530b995bda1a5deea7ecf9c185a402d463
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-04

    Put the external tools in $libdir/p11-kit
    
    These are possibly architecture specific binaries, so they should be
    in $libdir/p11-kit and not in $datadir/p11-kit

 configure.ac      | 3 +++
 tools/Makefile.am | 4 ++--
 tools/tool.c      | 2 +-
 3 files changed, 6 insertions(+), 3 deletions(-)

commit 941ff24161e040fca7382e3f98b0c1b51da21dac
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-04

    Release version 0.18.0

 NEWS         | 8 ++++++++
 configure.ac | 2 +-
 2 files changed, 9 insertions(+), 1 deletion(-)

commit 32b0b448d0ac4f1fa5f9143f0c4385066a9b4a76
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-04

    Fix off by one in date parsing code
    
    We didn't treat the two digit year 00 as a valid year, whereas it
    actually represents the year 2000. This is in a non-critical code path.

 trust/builder.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit d6e0982658acb231333ebfbfb7efff8b762231d0
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-04

    Don't print erroneous debug messages when skipping files
    
    The parser automatically skips over files that it cannot parse. Don't
    print confusing debug messages about DER parse failures when it does so.

 common/asn1.c  | 12 ++++++------
 trust/parser.c |  8 +++++---
 2 files changed, 11 insertions(+), 9 deletions(-)

commit 032fbd8806333bdaf0201cfd9d7bcaac8ec75184
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-02

    Update to MurmurHash3
    
    This should also fix problems with accessing memory in a non-aligned
    fashion on platforms where this causes problems.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62819

 common/attrs.c           |   2 +-
 common/dict.c            |   2 +-
 common/hash.c            | 149 +++++++++++++++++++++++++----------------------
 common/hash.h            |   4 +-
 common/tests/test-hash.c |  18 +++---
 5 files changed, 91 insertions(+), 84 deletions(-)

commit 8c69e467527c5ee484c9a921e9b5fd18c0c49b12
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-29

    Don't respect timezones for CKA_START_DATE or CKA_END_DATE
    
    The PKCS#11 specification does not note what timezone these dates
    are in. In addition the time values are not represented in PKCS#11.
    
    So don't reinterpret certificate dates, other than filling in the
    century for dates that have a two digit year.
    
    Lastly, these are low resolution optional fields so not being all
    strict about timezones here is appropriate.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62825

 common/asn1.c              | 332 ---------------------------------------------
 common/asn1.h              |   6 -
 trust/builder.c            | 100 +++++++++++---
 trust/tests/test-builder.c |  14 +-
 4 files changed, 81 insertions(+), 371 deletions(-)

commit 91aa0f9623e232fa253308c4f7464dab8902dfea
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-29

    trust: Fix logic for matching invalid NSS serial numbers
    
    Sometimes NSS queries for trust objects using invalid serial numbers
    that do not have their DER decoding. We fixed this earlier, but want
    to make sure there are no corner cases, accidentally not matching
    serial numbers that happen to start with the same bytes as a DER
    TLV would.

 trust/module.c            | 120 ++++++++++++++++++++++++++++------------------
 trust/tests/test-module.c | 107 +++++++++++++++++++++++++++++++++++++++++
 2 files changed, 180 insertions(+), 47 deletions(-)

commit a63311a0f3f2669138d09ff8f618fd4d12fa0c3d
Author: Stef Walter <stefw@redhat.com>
Date:   2013-04-03

    More compatible path munging and handling code
    
    Centralize the path handling code, so we can remove unixy assumptions
    and have a chance of running on Windows. The current goal is to run
    all the tests on Windows.
    
    Includes some code from LRN <lrn1986@gmail.com>
    
    https://bugs.freedesktop.org/show_bug.cgi?id=63062

 common/Makefile.am         |   1 +
 common/compat.c            |  34 ------
 common/compat.h            |   9 +-
 common/path.c              | 258 +++++++++++++++++++++++++++++++++++++++++++++
 common/path.h              |  62 +++++++++++
 common/tests/Makefile.am   |   1 +
 common/tests/test-compat.c |  32 ------
 common/tests/test-path.c   | 202 +++++++++++++++++++++++++++++++++++
 p11-kit/conf.c             |  60 +----------
 p11-kit/modules.c          |  38 +------
 tools/tests/test-openssl.c |   3 +-
 tools/tests/test-pem.c     |   3 +-
 tools/tests/test-save.c    |   3 +-
 tools/tests/test-x509.c    |   3 +-
 tools/tool.c               |   3 +-
 trust/module.c             |   5 +-
 trust/parser.c             |   3 +-
 trust/tests/test-module.c  |  10 +-
 trust/token.c              |   3 +-
 19 files changed, 558 insertions(+), 175 deletions(-)

commit c3f1b0a45eb1c28b6f025f8ae56c3b020801b6aa
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-03

    Don't use free() on memory allocated by LocalFree()
    
    ihttps://bugs.freedesktop.org/show_bug.cgi?id=63046

 common/library.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit fcc3a83cc4d540bc2c4096524b5e8003046ba561
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-02

    Separate library init from message code
    
    Put library init/uninit code its into their own statically
    linked library so that they don't get linked into the p11-kit
    executable.
    
    Refactor the message code so that the library initialization can
    plug in its per thread message buffer.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=63046

 common/Makefile.am           |  15 ++---
 common/lexer.c               |   2 +-
 common/library.c             |  85 +++++---------------------
 common/library.h             |  14 -----
 common/message.c             | 140 +++++++++++++++++++++++++++++++++++++++++++
 common/message.h             |  62 +++++++++++++++++++
 common/mock.c                |   2 +-
 common/tests/Makefile.am     |   3 +-
 common/tests/test-base64.c   |   5 +-
 common/tests/test-lexer.c    |   3 +-
 common/tests/test-url.c      |   5 +-
 p11-kit/Makefile.am          |   2 +-
 p11-kit/conf.c               |   2 +-
 p11-kit/modules.c            |   1 +
 p11-kit/pin.c                |   1 +
 p11-kit/proxy.c              |   1 +
 p11-kit/tests/Makefile.am    |   6 +-
 p11-kit/tests/conf-test.c    |  31 +++++-----
 p11-kit/tests/test-iter.c    |   1 +
 p11-kit/tests/test-modules.c |   1 +
 p11-kit/tests/uri-test.c     |   5 +-
 p11-kit/uri.c                |   2 +-
 p11-kit/util.c               |   1 +
 tools/Makefile.am            |   3 +-
 tools/extract-info.c         |   2 +-
 tools/extract-jks.c          |   2 +-
 tools/extract-openssl.c      |   2 +-
 tools/extract-pem.c          |   2 +-
 tools/extract-x509.c         |   2 +-
 tools/extract.c              |   2 +-
 tools/list.c                 |   2 +-
 tools/save.c                 |   2 +-
 tools/tests/Makefile.am      |   3 +-
 tools/tests/test-extract.c   |   3 +-
 tools/tests/test-openssl.c   |   3 +-
 tools/tests/test-pem.c       |   3 +-
 tools/tests/test-save.c      |   5 +-
 tools/tests/test-x509.c      |   3 +-
 tools/tool.c                 |   2 +-
 trust/Makefile.am            |   2 +-
 trust/builder.c              |   2 +-
 trust/module.c               |   1 +
 trust/parser.c               |   2 +-
 trust/session.c              |   2 +-
 trust/tests/Makefile.am      |   5 +-
 trust/tests/test-builder.c   |   3 +-
 trust/tests/test-index.c     |   3 +-
 trust/tests/test-module.c    |   2 -
 trust/tests/test-parser.c    |   3 +-
 trust/tests/test-persist.c   |   3 +-
 trust/tests/test-token.c     |   3 +-
 trust/token.c                |   2 +-
 52 files changed, 294 insertions(+), 170 deletions(-)

commit ae7dd1be6d431f25b101bc7e2b3fa373a8cbb47b
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-02

    Don't use library locks from p11-kit tool
    
    The global library p11_library_mutex is for libraries to use, so don't
    use it from any code in common/, which is also used by the p11-kit tool
    
    https://bugs.freedesktop.org/show_bug.cgi?id=63046

 common/library.c | 4 ----
 p11-kit/util.c   | 4 ++++
 2 files changed, 4 insertions(+), 4 deletions(-)

commit 2e8f586cd5a0c4cf2471c085e9e0e4fdcc04d996
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-03

    Add new script for setting up p11-kit for a maintainer
    
    Add win32 cross build, and build out of tree

 .gitignore   |  6 ++++++
 automaint.sh | 50 ++++++++++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 56 insertions(+)

commit b7ccd06e1f969a6b86285360234582fe01d3aeaf
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-03

    Fix build on Win32
    
    Don't reference an undefined macro
    
    https://bugs.freedesktop.org/show_bug.cgi?id=63046

 tools/tests/test.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit bd6e31c485cd84746f474a64a63c15a7ea87d650
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-03

    Fix documentation so it builds out of tree

 doc/manual/Makefile.am       |   7 +-
 doc/manual/p11-kit-docs.sgml |  42 ----------
 doc/manual/p11-kit-docs.xml  |  42 ++++++++++
 gtk-doc.make                 | 189 +++++++++++++++++++++++++++----------------
 4 files changed, 165 insertions(+), 115 deletions(-)

commit e67c0e4465607560e0f6af9e9b0395a9ee78adbc
Author: Stef Walter <stefw@gnome.org>
Date:   2013-04-02

    Fix build with automake 1.13
    
    Also remove some generated files from the po/ directory.

 .gitignore                |   5 +
 common/tests/Makefile.am  |   4 +-
 p11-kit/tests/Makefile.am |   2 +-
 po/Makefile.in.in         | 444 ----------------------------------------------
 po/Rules-quot             |  47 -----
 tools/tests/Makefile.am   |   2 +-
 trust/tests/Makefile.am   |   2 +-
 7 files changed, 10 insertions(+), 496 deletions(-)

commit c3c18a1ea9cd84ee35783809c059d1b9c80c5cbe
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-29

    Use CKA_X_CERTIFICATE_VALUE for trust assertions
    
    These don't contain the CKA_VALUE attribute for certificate data
    but rather the CKA_X_CERTIFICATE_VALUE attribute.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62896

 trust/builder.c            | 15 ++++++++++-----
 trust/tests/test-builder.c |  6 +++---
 2 files changed, 13 insertions(+), 8 deletions(-)

commit 4560373c254473990306c13178b959ccc5d338e4
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-28

    Don't complain when applications call C_Logout or C_Login
    
    Some callers erroneously call our C_Logout function, like NSS.
    So return appropriate error codes in these cases.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62874

 trust/module.c            | 32 ++++++++++++++++++++++++++++++--
 trust/tests/test-module.c | 23 +++++++++++++++++++++++
 2 files changed, 53 insertions(+), 2 deletions(-)

commit 10d8e6d1836701e311d2b55e116909198932915b
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-28

    Release version 0.17.5

 NEWS         | 4 ++++
 configure.ac | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

commit 87a0afed5db7e916a6ad6715e14996b2e25641d7
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-27

    Don't try to guess at overflowing time values on 32-bit systems
    
    Since CKA_START_DATE and CKA_END_DATE are the only places
    where we want to parse out times, and these are optional, just
    leave blank if the time overflows what libc can handle on
    a 32-bit system.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62825

 build/certs/Makefile.am          |   3 ++
 build/certs/distant-end-date.der | Bin 0 -> 366 bytes
 common/asn1.c                    |   6 ++--
 trust/builder.c                  |   5 +--
 trust/tests/test-builder.c       |  71 +++++++++++++++++++++++++++++++++++++++
 5 files changed, 80 insertions(+), 5 deletions(-)

commit b0e44f8e1e589726c95506da5121e95a54269fd7
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-25

    Fix testing of murmur hash on bigendian systems
    
    The murmur hash produces different output depending on the architecture
    
    https://bugzilla.redhat.com/show_bug.cgi?id=927394

 common/tests/test-hash.c | 60 +++++++++++++++++++-----------------------------
 1 file changed, 23 insertions(+), 37 deletions(-)

commit 3f74a3b32ce42cc7e38bdbf8349f976000c3af4c
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-20

    Release 0.17.4

 NEWS         | 4 ++++
 configure.ac | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

commit 4b09d2b4d3958b58b020c1ae21fcd932e1eb6c37
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-20

    Fix memory leaks reported by 'make leakcheck'

 common/mock.c                |  4 +++-
 common/pem.c                 |  1 +
 common/tests/test-hash.c     |  2 ++
 common/tests/test-utf8.c     |  4 ++++
 common/tests/test-x509.c     |  1 +
 p11-kit/iter.c               |  3 +++
 p11-kit/tests/pin-test.c     |  1 -
 p11-kit/tests/test-iter.c    |  1 +
 p11-kit/tests/test-modules.c |  2 ++
 p11-kit/uri.c                |  5 +----
 tools/extract-openssl.c      |  3 ---
 tools/tests/test-openssl.c   |  7 ++++++
 tools/tests/test-pem.c       |  6 +++---
 tools/tests/test-save.c      |  2 ++
 tools/tests/test-x509.c      |  3 +++
 trust/builder.c              |  2 ++
 trust/index.c                |  7 +++---
 trust/module.c               |  5 +++--
 trust/session.c              |  1 +
 trust/tests/test-builder.c   | 51 +++++++++++++++++++++++++++++++++++---------
 trust/tests/test-index.c     |  5 +++++
 trust/tests/test-module.c    |  2 ++
 22 files changed, 91 insertions(+), 27 deletions(-)

commit 57d8f36a6cfbde5a9a783f11f2b75f19005c23e1
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-20

    Fix invalid memory accesses reported by 'make memcheck'
    
    These are things that showed up in valgrind while running the tests.

 common/compat.c            | 11 ++++-------
 common/tests/test-compat.c | 16 ++++++++++++++++
 common/tests/test-hash.c   | 22 +++++++++++-----------
 trust/index.c              |  2 +-
 trust/tests/test-index.c   |  2 ++
 5 files changed, 34 insertions(+), 19 deletions(-)

commit 9cf89e4b43e5e018bb3103be1873a3993769ce4a
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-20

    Add a bit of infrastructure for running valgrind
    
     * make memcheck: Runs basic memory checking
     * make leakcheck: Also runs leak checking

 Makefile.am                  |  2 ++
 build/Makefile.am            |  4 ++++
 build/Makefile.decl          | 11 +++++++++++
 build/Makefile.tests         | 11 +++++++++++
 common/Makefile.am           |  3 ++-
 common/tests/Makefile.am     |  2 --
 doc/Makefile.am              |  4 ++++
 doc/manual/p11-kit-devel.xml |  4 ++++
 p11-kit/Makefile.am          |  3 ++-
 tools/Makefile.am            |  3 ++-
 tools/tests/Makefile.am      |  4 ++--
 trust/Makefile.am            |  3 ++-
 trust/tests/Makefile.am      |  2 --
 13 files changed, 46 insertions(+), 10 deletions(-)

commit 0ecabc858dd6c1c2055f53202a01251e2ad7d2c2
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-20

    trust: Predictable behavior with duplicate certificates in token
    
    If duplicate certificates are present in a token, we warn about this,
    and don't really recommend it. However we have predictable behavior
    where blacklist is prefered to anchor is preferred to unknown trust.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62548

 trust/parser.c            |  94 +++++++++++++++++++++++++++++++++-
 trust/tests/test-parser.c | 127 ++++++++++++++++++++++++++++++++++++++++++++++
 trust/token.c             |  19 ++-----
 3 files changed, 224 insertions(+), 16 deletions(-)

commit e075585ef1cffc988894b4efbf3d14d5e55dcdcc
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-20

    trust: Rework index to be faster and more usable
    
    The index now uses a sort of cross between a hash table and a bloom
    filter internally to select matching items. This is needed for the
    massive amount of lookups we want to do during loading.
    
    In addition make p11_index_find() and p11_index_replace() easier
    to use.

 trust/builder.c            |  14 +-
 trust/index.c              | 439 ++++++++++++++++++++++++++++++++-------------
 trust/index.h              |  15 +-
 trust/tests/Makefile.am    |   3 +-
 trust/tests/frob-pow.c     |  57 ++++++
 trust/tests/test-builder.c |  44 ++---
 trust/tests/test-index.c   |  36 ++--
 trust/tests/test-parser.c  |   6 +-
 trust/tests/test-token.c   |   2 +-
 9 files changed, 437 insertions(+), 179 deletions(-)

commit fc562261c6bbb35dfed585a78fdec9a408b981c7
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-20

    attrs: Print out the CKA_VALUE for certificates when debugging
    
    While it's true that we shouldn't be pritning out CKA_VALUE in
    certain cases, like for keys, we obviously can do so for certificates.
    
    We don't have keys anyway, but in the interest of being general
    purpose use the class to determine whether CKA_VALUE can be printed

 common/attrs.c            | 49 ++++++++++++++++++++++++++++++++++++++---------
 common/attrs.h            | 14 ++++++++++----
 common/tests/test-attrs.c |  2 +-
 trust/tests/test-data.c   | 15 ++++++++++-----
 trust/tests/test-data.h   |  3 ++-
 5 files changed, 63 insertions(+), 20 deletions(-)

commit f45942a4fc3e1c5219e9b5201b82203337ee7280
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-20

    hash: Add the murmur2 hash and start using it
    
    Add implementation of the murmur2 hash function, and start using
    it for our dictionaries. Our implementation is incremental
    like our other hash functions.
    
    Also remove p11_oid_hash() which wasn't being used.
    
    In addition fix several tests whose success was based on the
    way that the dictionary hashed. This was a hidden testing bug.

 build/certs/Makefile.am                            |   6 +-
 common/attrs.c                                     |  11 +-
 common/dict.c                                      |  11 +-
 common/hash.c                                      | 126 +++++++++++++++++++++
 common/hash.h                                      |   7 ++
 common/oid.c                                       |  17 ---
 common/oid.h                                       |   2 -
 common/tests/test-hash.c                           |  71 ++++++++++++
 .../files/cacert3-trusted-client-server-alias.pem  |  43 -------
 tools/tests/files/cacert3-trusted-multiple.pem     |   4 +-
 tools/tests/files/cacert3-trusted-server-alias.pem |  43 +++++++
 tools/tests/test-openssl.c                         |  14 +--
 tools/tests/test.h                                 |   5 +-
 trust/tests/files/cacert3-trusted.pem              |   4 +-
 trust/tests/test-parser.c                          |   3 +-
 15 files changed, 275 insertions(+), 92 deletions(-)

commit 1dc227b4fce16fcc721276925492f4ba4db00b4f
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-20

    hash: Rename file and functions for hashes
    
    We're going to be adding other hashes. Also build as part of a
    different common library.

 common/Makefile.am           |   2 +-
 common/checksum.c            | 542 -------------------------------------------
 common/checksum.h            |  60 -----
 common/hash.c                | 542 +++++++++++++++++++++++++++++++++++++++++++
 common/hash.h                |  60 +++++
 common/tests/Makefile.am     |   2 +-
 common/tests/test-checksum.c | 151 ------------
 common/tests/test-hash.c     | 151 ++++++++++++
 common/x509.c                |   4 +-
 tools/extract-jks.c          |  14 +-
 tools/extract-openssl.c      |  10 +-
 trust/builder.c              |  16 +-
 trust/parser.c               |   4 +-
 trust/tests/test-builder.c   |   6 +-
 trust/tests/test-module.c    |  10 +-
 15 files changed, 787 insertions(+), 787 deletions(-)

commit ef8c54a355d3f9814cc53a0aad72d61247b169a0
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-19

    Release version 0.17.3

 NEWS         | 7 +++++++
 configure.ac | 2 +-
 2 files changed, 8 insertions(+), 1 deletion(-)

commit 80303340701c2cba78937193084f3d716b883b55
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-19

    trust: Use descriptive labels for tokens
    
    Try to determine which one is the system trust input token,
    and which one is the default token by using datadir and sysconfdir
    respectively.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62534

 trust/Makefile.am         |  2 ++
 trust/module.c            | 63 +++++++++++++++++++++++++++++++++++++----------
 trust/tests/Makefile.am   |  2 ++
 trust/tests/frob-token.c  |  2 +-
 trust/tests/test-module.c | 30 +++++++++++++++-------
 trust/tests/test-token.c  | 13 +++++++++-
 trust/token.c             | 22 +++++++++++++++--
 trust/token.h             |  5 +++-
 8 files changed, 112 insertions(+), 27 deletions(-)

commit 832015f1fd91a9e94478514d7fe9b21e050f121a
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-19

    trust: Remove the temporary built in distrust objects
    
    These should now be loaded from the .p11-kit persist format.

 trust/token.c | 148 ----------------------------------------------------------
 1 file changed, 148 deletions(-)

commit b6295dd63a8028ae0b239859406c477d779f4d5e
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-19

    extract: Make extracted output directories read-only
    
    This is not a security feature or anything like that, but a hint
    that the files are managed by the extract tool and should not be
    modified manually.

 tools/save.c            | 60 ++++++++++++++++++++++++++++++++++++-------------
 tools/tests/test-save.c | 25 +++++++++------------
 tools/tests/test.c      |  8 +++++--
 3 files changed, 61 insertions(+), 32 deletions(-)

commit 7c27e9fbbe86b3268065f248eab2d6964983a715
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-19

    trust: Don't use POSIX or GNU basename()
    
    Both are nasty. Do our own, and test it a bit
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62479

 common/compat.c            | 44 +++++++++++++---------
 common/compat.h            | 17 ++++++---
 common/tests/Makefile.am   |  1 +
 common/tests/test-compat.c | 93 ++++++++++++++++++++++++++++++++++++++++++++++
 trust/module.c             |  5 ++-
 trust/parser.c             |  4 +-
 6 files changed, 137 insertions(+), 27 deletions(-)

commit 535475c238c427cb685b4282997f7bce0876bfdf
Author: Andreas Metzler <ametzler@downhill.at.eu.org>
Date:   2013-03-19

    Do not export (de)constructor
    
    Rename p11_kit_init and p11_kit_fini to _p11_kit_init and _p11_kit_fini
    respectively to stop them from being exported in the ABI. It does not seem
    to be necessary.

 p11-kit/util.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

commit 1d60d5a6b8c5784b7ac10098c3d9b513094f49a8
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    Release version 0.17.2

 NEWS         | 4 ++++
 configure.ac | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

commit 4ad4d5742037f156e07a4e28b202e49984e27a89
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    trust: Fix trust tests on 32-bit builds

 trust/tests/test-persist.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

commit ba67d1214f6d9254546997ceec310fce2f675679
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    trust: Fix invalid varargs call in the builder

 trust/builder.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit caaeaffb86c572f996bec31f67443da2219def84
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    Release version 0.17.1
    
     * Fix distcheck bugs surrounding the strndup() workaround

 NEWS            | 16 ++++++++++++++++
 common/compat.c | 22 +++++++++++++++++++++-
 configure.ac    |  9 ++-------
 3 files changed, 39 insertions(+), 8 deletions(-)

commit 6c47831b3bfc66e1e995fb27e80c23085bb41e08
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    trust: Provide better debugging of trust module functions
    
    Make C_FindObjects() and C_GetAttributeValue() functions dump the
    attributes that they're dealing with when in debug mode.

 trust/module.c | 20 +++++++++++++++-----
 1 file changed, 15 insertions(+), 5 deletions(-)

commit 128239732a5b7e184d5d9c505402630ee9215080
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    attrs: Change p11_attrs_to_string() to allow static templates
    
    Allow passing the number of attributes to print, which lets us use
    this directly on templates passed in by callers of the PKCS#11 API.

 common/attrs.c               | 13 ++++++++-----
 common/attrs.h               |  3 ++-
 common/tests/test-attrs.c    |  6 +++++-
 trust/tests/frob-nss-trust.c |  2 +-
 4 files changed, 16 insertions(+), 8 deletions(-)

commit 1ad9f98b11f3f0d411bf9517f1dc8985ea3dbe2a
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    trust: Handle incorrectly encoded CKA_SERIAL_NUMBER lookups
    
    Handle lookups for trust objects (by NSS) which expect CKA_SERIAL_NUMBER
    attributes without appropriate DER encoding.
    
    In addition allow creation of NSS trust objects as PKCS#11 session
    objects, so that we can test this behavior.

 trust/builder.c           |  2 +-
 trust/module.c            | 47 +++++++++++++++++++++++++++++++++
 trust/tests/test-module.c | 66 +++++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 114 insertions(+), 1 deletion(-)

commit f40e5f7129ece4b74aa2cb23b28b24b381bbe223
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    Add workaround for broken strndup() in firefox
    
    Unconditionally use our own strndup() until this issue is resolved
    and in the stable versions of various distros.
    
    See: https://bugzilla.mozilla.org/show_bug.cgi?id=826171

 configure.ac | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

commit 749c0cdfeb3b7cc86165deb1cc51c32c0768a149
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    compat: Fix trivial comment

 common/compat.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 64aa734f484f81ac97914b2ddecf68ff76b317c0
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    Use the nickname x-distrusted for CKA_X_DISTRUSTED
    
    This is a non-standard PKCS#11 attribute, so has the X prefix
    like the other ones we've added.

 common/constants.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 6c574777f6ab5996a9ba3bea493e96e4ad53dc69
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    trust: Better generation of nss objects and assertions for serial+issuer
    
    In many cases certficates are distrusted by serial+issuer. Make sure
    this works, and fix various cases where we weren't generating
    compat NSS objects and compat trust assertions for these types
    of input.

 trust/builder.c            | 267 ++++++++++++++++++++++------------------
 trust/index.c              |   3 +-
 trust/tests/test-builder.c | 296 ++++++++++++++++++++++++++++-----------------
 3 files changed, 341 insertions(+), 225 deletions(-)

commit a904e98b78b55e7a6213356225e45a04fdc457e1
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-18

    Refine looking up of attributes in arrays
    
    There was a class of bugs for looking up invalid or empty
    attributes in the internal PKCS#11 attribute arrays.
    
     * Refine what p11_attrs_find_valid() treats as valid
     * Rename p11_attrs_is_empty() to p11_attrs_terminator() for clarity

 common/attrs.c             | 62 ++++++++++++------------------
 common/attrs.h             | 11 ++----
 common/mock.c              | 44 +++++++--------------
 common/tests/test-attrs.c  | 54 ++++++++++++++++++++++++--
 tools/extract-info.c       | 21 +++-------
 tools/extract-jks.c        |  2 +-
 tools/extract-openssl.c    |  8 ++--
 tools/tests/test-extract.c |  7 ++--
 trust/builder.c            | 96 +++++++++++++++++++++-------------------------
 trust/index.c              |  2 +-
 trust/parser.c             |  8 ++--
 trust/tests/test-data.c    |  2 +-
 trust/tests/test-module.c  |  4 +-
 13 files changed, 158 insertions(+), 163 deletions(-)

commit f71baf6adf00626e73326149d55183bc62f827ae
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-17

    trust: Remove file that's no longer used

 trust/mozilla.c | 301 --------------------------------------------------------
 1 file changed, 301 deletions(-)

commit d5b9e3915d75c04c547a0db7fe0c92839a0e78a5
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-15

    Bump version number

 configure.ac | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 062c09fbcad6945d6c40c5f2ce47894abdf87b07
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-15

    Fix distcheck and documentation

 common/tests/test-dict.c     | 16 ++++++++--------
 doc/manual/p11-kit-devel.xml | 15 +++++----------
 trust/tests/Makefile.am      |  3 +--
 trust/tests/test-module.c    |  7 +++++--
 4 files changed, 19 insertions(+), 22 deletions(-)

commit 57e835d55f6eae39c25b97e35efe0cb58e46b897
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-15

    trust: Update frob-nss-tool so it can compare modules for trust info
    
    Can run with two modules now so that it can compare tokens NSS
    trust info.

 common/attrs.c               |  23 ++++++
 common/attrs.h               |   2 +
 trust/tests/frob-nss-trust.c | 174 ++++++++++++++++++++++++++++++++++---------
 3 files changed, 164 insertions(+), 35 deletions(-)

commit 7fd74a78fcad81227be3650239669bca5851a1db
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-15

    trust: Support a p11-kit specific serialization format
    
    This is documented in doc/internals/ subdirectory
    Add tests for the format as well.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62156

 common/Makefile.am                    |   2 +
 common/basic.asn                      |  12 +
 common/basic.asn.h                    |  13 +
 doc/internal/persist-format.txt       |  54 ++++
 trust/Makefile.am                     |   1 +
 trust/parser.c                        |  35 +++
 trust/persist.c                       | 401 +++++++++++++++++++++++++++++
 trust/persist.h                       |  59 +++++
 trust/tests/Makefile.am               |   1 +
 trust/tests/input/verisign-v1.p11-kit |  17 ++
 trust/tests/test-builder.c            |  39 ---
 trust/tests/test-data.h               |  39 +++
 trust/tests/test-module.c             |   2 +-
 trust/tests/test-parser.c             |  32 +++
 trust/tests/test-persist.c            | 472 ++++++++++++++++++++++++++++++++++
 trust/tests/test-token.c              |   2 +-
 16 files changed, 1140 insertions(+), 41 deletions(-)

commit 48004b92d4c65080ac71f6a48297abd4d83dfdcb
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-11

    url: Split out the URL encoding and decoding functions
    
    We want to use these as the format for encoding binary data
    in our PKCS#11 attribute persistence
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62156

 common/Makefile.am       |   1 +
 common/tests/Makefile.am |   1 +
 common/tests/test-url.c  | 166 +++++++++++++++++++++++++++++++++++++++++++++++
 common/url.c             | 142 ++++++++++++++++++++++++++++++++++++++++
 common/url.h             |  59 +++++++++++++++++
 p11-kit/uri.c            | 120 ++++------------------------------
 6 files changed, 381 insertions(+), 108 deletions(-)

commit 06bf3da80eb780621e0f1eb0ab8d4716ed7b3478
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-11

    lexer: Make a lexer for our config file format
    
    This lexer will be used in our PKCS#11 persistence format as well.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62156

 common/Makefile.am        |   1 +
 common/lexer.c            | 238 +++++++++++++++++++++++++++++++++++++++
 common/lexer.h            |  84 ++++++++++++++
 common/tests/Makefile.am  |   1 +
 common/tests/test-lexer.c | 281 ++++++++++++++++++++++++++++++++++++++++++++++
 p11-kit/conf.c            | 131 +++++++--------------
 6 files changed, 644 insertions(+), 92 deletions(-)

commit 29af2c1eeca2fb0257e1172753b129d638472f0f
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-15

    trust: Use a SHA-1 hash of subjectPublicKeyInfo as CKA_ID by default
    
    This is what's recommended by the spec, and allows stapled extensions
    to hang off a predictable CKA_ID.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62329

 common/x509.c                     |  22 +++++++++++++++++
 common/x509.h                     |   5 ++++
 trust/builder.c                   |  20 +++++++++++-----
 trust/parser.c                    |  48 +++++++++++++++++---------------------
 trust/tests/files/verisign-v1.der | Bin 0 -> 576 bytes
 trust/tests/test-builder.c        |  18 +++++++++++++-
 trust/tests/test-module.c         |  10 ++++----
 trust/tests/test-parser.c         |  31 ++++++++++++++++++++++++
 8 files changed, 115 insertions(+), 39 deletions(-)

commit 2d75eb32793a569dc3de359bb623713c80393d24
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-14

    trust: Add a builder which builds objects out of parsed data
    
    The builder completes the objects from the parsed data and takes
    over the responsibilities that the parser and adapter previously
    shared.
    
    This is necessary to prepare for arbitrary data coming from
    the p11-kit specific input files.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62329

 build/certs/entrust-invalid.der |  Bin 0 -> 1120 bytes
 build/certs/verisign-v1.der     |  Bin 0 -> 576 bytes
 trust/Makefile.am               |    2 +-
 trust/adapter.c                 |  472 ------------
 trust/adapter.h                 |   44 --
 trust/builder.c                 | 1556 +++++++++++++++++++++++++++++++++++++
 trust/builder.h                 |   66 ++
 trust/parser.c                  |  836 +++++---------------
 trust/parser.h                  |   45 +-
 trust/session.c                 |    7 +-
 trust/session.h                 |    2 +
 trust/tests/Makefile.am         |    1 +
 trust/tests/test-builder.c      | 1611 +++++++++++++++++++++++++++++++++++++++
 trust/tests/test-data.c         |    2 -
 trust/tests/test-module.c       |   28 +-
 trust/tests/test-parser.c       |  666 +++-------------
 trust/tests/test-token.c        |   58 +-
 trust/token.c                   |   21 +-
 18 files changed, 3630 insertions(+), 1787 deletions(-)

commit d7d68de6c9de9190c85da36b731e61ae3421a811
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-14

    attrs: Add info functions for constant names and values
    
     * For retrieving the name and/or nick of constants
     * The nick is what we'll use in the file format
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62329

 common/Makefile.am            |   1 +
 common/attrs.c                | 242 ++--------------------------
 common/constants.c            | 363 ++++++++++++++++++++++++++++++++++++++++++
 common/constants.h            |  74 +++++++++
 common/tests/Makefile.am      |   1 +
 common/tests/test-constants.c | 117 ++++++++++++++
 6 files changed, 566 insertions(+), 232 deletions(-)

commit ff009f8a671e6ddd02a684bb1707a2a797fe4600
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-12

    trust: Refactor to include concept of the index
    
     * The index holds PKCS#11 objects whether for the token or for the session.
     * The index provides hook for a builder to expand or validate objects
       being added to the index.
     * In addition theres a change hook so that a builder can maintain state
       between objects, such as the compat NSS trust objects.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62329

 trust/Makefile.am          |    1 +
 trust/index.c              |  566 +++++++++++++++++++++++
 trust/index.h              |  126 ++++++
 trust/module.c             |  111 ++---
 trust/session.c            |  121 +----
 trust/session.h            |   19 +-
 trust/tests/Makefile.am    |    2 +-
 trust/tests/frob-token.c   |    6 +-
 trust/tests/test-index.c   | 1063 ++++++++++++++++++++++++++++++++++++++++++++
 trust/tests/test-module.c  |  238 ++++++++++
 trust/tests/test-session.c |  161 -------
 trust/tests/test-token.c   |   32 +-
 trust/token.c              |   32 +-
 trust/token.h              |    3 +-
 14 files changed, 2097 insertions(+), 384 deletions(-)

commit 3fc6365093ad07b2eb5ef859093c5c5eb56ee700
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-14

    attrs: New p11_attrs_merge() function
    
    This takes one set of attributes and merges them into
    another, without copying memory needlessly.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62329

 common/attrs.c            |  52 ++++++++++++++++++++---
 common/attrs.h            |   4 ++
 common/tests/test-attrs.c | 103 ++++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 153 insertions(+), 6 deletions(-)

commit 5208fc8539aabc626c1699f181e1191d6bb1c787
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-14

    asn1: Implement a parsed ASN.1 tree cache
    
    In order to unmarry the parser from the future builder, but still retain
    efficiency, we need to be able to cache parsed ASN.1 trees. The ASN.1
    cache provides this. In addition it carries around the loaded ASN.1
    definitions.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62329

 common/asn1.c            | 110 +++++++++++++++++++++++++++++++++++++++++++++++
 common/asn1.h            |  21 +++++++++
 common/tests/test-asn1.c |  46 ++++++++++++++++++++
 3 files changed, 177 insertions(+)

commit 07a53cecc3220b3811f9db7514e49235fff32b94
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-15

    extract: Combine trust policy when extracting
    
     * Collapse multiple identical certificates coming from different
       tokens. Note that if a certificate should not be placed multiple
       times on a token. We cannot know which one to respect.
     * Add a new extract filter: --trust-policy
       This extracts all anchor and blacklist information
    
    https://bugs.freedesktop.org/show_bug.cgi?id=61497

 doc/manual/p11-kit.xml     |  19 ++++-
 tools/extract-info.c       |  80 ++++++++++++++++++++-
 tools/extract.c            |  82 ++++++++++++++--------
 tools/extract.h            |   4 ++
 tools/tests/test-extract.c | 171 +++++++++++++++++++++++++++++++++++++++++++--
 5 files changed, 313 insertions(+), 43 deletions(-)

commit 7fc0ecd1ca7840e71958e62163b27d645c936c25
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-15

    extract: --comment option adds comments to PEM bundles
    
     * Placed before the certificate, simple one liner
     * No need to put comments in PEM files extracted into
       directories, as the file names are already descriptive.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62029

 doc/manual/p11-kit.xml     |  5 +++++
 tools/extract-info.c       | 20 ++++++++++++++++++++
 tools/extract-openssl.c    | 11 ++++++++++-
 tools/extract-pem.c        | 11 +++++++++--
 tools/extract.c            |  6 ++++++
 tools/extract.h            |  8 ++++++++
 tools/tests/test-extract.c | 45 +++++++++++++++++++++++++++++++++++++++++++++
 7 files changed, 103 insertions(+), 3 deletions(-)

commit 58e1e3764250fbda96c5ef7244e891a6be04d4cb
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-15

    extract: Allow p11_save_write() to automatically calculate length
    
    Also if automatically calculating length, then ignore input
    that is NULL, as something that shouldn't be written out.
    
    This allows easier chaining of optional output, such as comments.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62029

 tools/save.c                    | 11 +++++++--
 tools/save.h                    |  4 ++--
 tools/tests/files/empty-file    |  0
 tools/tests/files/simple-string |  1 +
 tools/tests/test-save.c         | 50 +++++++++++++++++++++++++++++++++++++++++
 5 files changed, 62 insertions(+), 4 deletions(-)

commit 8fd55c8089c90b52f00e4ffad572d1b9da72e6ba
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-07

    p11-kit: New priority option and change trust-policy option
    
     * Sort loaded modules appropriately using the 'priority' option. This
       allows us to have a predictable order for callers, when callers
       iterate through modules.
     * Modules default to having an 'priority' option of '0'.
     * If modules have the same order value, then sort by name.
     * The above assumes the role of ordering trust-policy sources.
     * Change the trust-policy option to a boolean
     * Some of this code will be rearranged when the managed branch
       is merged.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=61978

 doc/manual/p11-kit-trust.xml                       |  5 ++-
 doc/manual/pkcs11.conf.xml                         | 20 ++++++---
 p11-kit/modules.c                                  | 47 ++++++++++++++++++++++
 p11-kit/tests/files/package-modules/four.module    |  1 +
 .../tests/files/package-modules/win32/four.module  |  1 +
 .../files/system-modules/two-duplicate.module      |  1 +
 p11-kit/tests/files/system-modules/two.badname     |  1 +
 .../tests/files/system-modules/win32/one.module    |  3 +-
 .../system-modules/win32/two-duplicate.module      |  1 +
 .../tests/files/system-modules/win32/two.badname   |  1 +
 p11-kit/tests/files/user-modules/three.module      |  3 +-
 .../tests/files/user-modules/win32/three.module    |  3 +-
 p11-kit/tests/test-modules.c                       | 42 +++++++++++++++++++
 tools/extract.c                                    | 47 +++-------------------
 trust/p11-kit-trust.module                         | 14 +++++--
 15 files changed, 136 insertions(+), 54 deletions(-)

commit 0e75a5ba8261955d4d75a38a528f79ff4edd5c21
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-06

    trust: Make each configured path its own token
    
     * Each source directory or file configured into the module or passed
       in as an initialization argument becomes its own token.
       Previously there was one token that contained certificates from
       all the configured paths.
     * These tokens are clearly labeled in the token info as
       to the directory or file that they represent.
     * Update PKCS#11 module logic to deal with multiple tokens, validate
       the slot ids and so on.
     * The order in which the paths are configured will become the
       order of trust priority. This is the same order in which they
       are listed through 'p11-kit list-modules' and C_GetSlotList.
     * Update the frob-token internal tool to only play with one path
     * Adjust tests where necessary to reflect the new state of things
       and add tests for modified trust module code
    
    https://bugs.freedesktop.org/show_bug.cgi?id=61499

 trust/module.c             | 202 +++++++++++++++++++++++---------
 trust/tests/frob-token.c   |   4 +-
 trust/tests/test-module.c  | 283 +++++++++++++++++++++++++++++++++++++++------
 trust/tests/test-session.c |   2 +-
 trust/tests/test-token.c   |  33 +++++-
 trust/token.c              |  64 ++++------
 trust/token.h              |   8 +-
 7 files changed, 460 insertions(+), 136 deletions(-)

commit d2128c263ea77e4f99bccc6ac46964ad419ec2d1
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-06

    dict: Allow removal of current item in a p11_dict iteration
    
     * This was already possible to do safely before
     * Document and test this behavior
    
    https://bugs.freedesktop.org/show_bug.cgi?id=61499

 common/dict.h            |  2 ++
 common/tests/test-dict.c | 60 ++++++++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 62 insertions(+)

commit 86e60637394340ef2fa3b3db6b451dac1d73052b
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-14

    trust: Rework input path treatment
    
     * Accept a single --with-trust-paths argument to ./configure
       which cotnains all the input paths.
     * The --with-system-anchors and --with-system-certificates
       ./configure arguments are no longer supported. Since they were
       only present briefly, no provision is made for backwards
       compatibility.
     * Each input file is treated as containing anchors by default
       unless an input certificate contains detailed trust information.
     * The files in each input directory are not automatically treated
       as anchors unless a certificate contains detailed trust information.
     * The files in anchors/ subdirectory of each input directory are
       automatically marked as anchors.
     * The files in the blacklist/ subdirectory of each input directory
       are automatically marked as blacklisted.
     * Update tests and move around test certificates so we can
       test these changes.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62327

 build/certs/Makefile.am                           |  13 +--
 build/certs/self-signed-with-ku.der               | Bin 501 -> 478 bytes
 configure.ac                                      |  74 +++++--------
 doc/manual/p11-kit-trust.xml                      |  61 ++++++-----
 p11-kit/p11-kit-1.pc.in                           |   3 -
 trust/module.c                                    |  21 ++--
 trust/parser.c                                    |  47 ++++++++-
 trust/tests/anchors/cacert3.der                   | Bin 1885 -> 0 bytes
 trust/tests/anchors/testing-ca.der                | Bin 970 -> 0 bytes
 trust/tests/certificates/cacert-ca.der            | Bin 1857 -> 0 bytes
 trust/tests/certificates/self-signed-with-eku.der | Bin 480 -> 0 bytes
 trust/tests/certificates/self-signed-with-ku.der  | Bin 501 -> 0 bytes
 trust/tests/files/self-server.der                 | Bin 396 -> 0 bytes
 trust/tests/files/self-signed-with-eku.der        | Bin 0 -> 480 bytes
 trust/tests/frob-token.c                          |   2 +-
 trust/tests/input/anchors/cacert3.der             | Bin 0 -> 1885 bytes
 trust/tests/input/anchors/testing-ca.der          | Bin 0 -> 970 bytes
 trust/tests/input/blacklist/self-server.der       | Bin 0 -> 396 bytes
 trust/tests/input/cacert-ca.der                   | Bin 0 -> 1857 bytes
 trust/tests/input/distrusted.pem                  |  23 ++++
 trust/tests/test-module.c                         |   8 +-
 trust/tests/test-session.c                        |   2 +-
 trust/tests/test-token.c                          | 123 +++++++++++++++++++++-
 trust/token.c                                     |  78 +++++++++-----
 trust/token.h                                     |   3 +-
 25 files changed, 318 insertions(+), 140 deletions(-)

commit bf63f009cd4a1147a3e0684d898f140f46666b0e
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-15

    pem: Fix a bug decoding some PEM files
    
    When bringing over the BSD base64 code, there was a regression.
    In addition add some tests for the base64 stuff.

 common/base64.c              |  19 ++--
 common/tests/Makefile.am     |   1 +
 common/tests/test-base64.c   | 212 +++++++++++++++++++++++++++++++++++++++++++
 trust/tests/files/thawte.pem |  25 +++++
 4 files changed, 246 insertions(+), 11 deletions(-)

commit 08f11e4c8fb173ed1341e6e0cf0cb0403df7e547
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-10

    Don't overwrite the build directory when uploading documentation

 Makefile.am | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 3177cbccb237bfef66721eeb773b574f1d8ba076
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-10

    Fix up the system anchors/certificates configure arguments
    
    Double check various combinations, and make sure we don't fail
    needlessly when --disable-trust-module. Also check that actual
    paths are passed into the arguments.

 configure.ac | 35 ++++++++++++++++++++---------------
 1 file changed, 20 insertions(+), 15 deletions(-)

commit df29c0dcb6cce6a215dee9dc4e17aff59ae67c5b
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-11

    doc: Move manual into doc/manual subdirectory

 .gitignore                         |  34 ++---
 Makefile.am                        |   2 +-
 configure.ac                       |   7 +-
 doc/Makefile.am                    | 132 +---------------
 doc/annotation-glossary.xml        |  67 ---------
 doc/docbook-params.xsl             |  39 -----
 doc/manual/Makefile.am             | 132 ++++++++++++++++
 doc/manual/annotation-glossary.xml |  67 +++++++++
 doc/manual/docbook-params.xsl      |  39 +++++
 doc/manual/p11-kit-config.xml      |  90 +++++++++++
 doc/manual/p11-kit-devel.xml       | 299 +++++++++++++++++++++++++++++++++++++
 doc/manual/p11-kit-docs.sgml       |  42 ++++++
 doc/manual/p11-kit-overrides.txt   |   0
 doc/manual/p11-kit-sections.txt    | 106 +++++++++++++
 doc/manual/p11-kit-sharing.xml     |  92 ++++++++++++
 doc/manual/p11-kit-trust.xml       | 112 ++++++++++++++
 doc/manual/p11-kit.xml             | 229 ++++++++++++++++++++++++++++
 doc/manual/pkcs11.conf.xml         | 207 +++++++++++++++++++++++++
 doc/manual/style.css               | 116 ++++++++++++++
 doc/manual/version.xml.in          |   1 +
 doc/p11-kit-config.xml             |  90 -----------
 doc/p11-kit-devel.xml              | 299 -------------------------------------
 doc/p11-kit-docs.sgml              |  42 ------
 doc/p11-kit-overrides.txt          |   0
 doc/p11-kit-sections.txt           | 106 -------------
 doc/p11-kit-sharing.xml            |  92 ------------
 doc/p11-kit-trust.xml              | 112 --------------
 doc/p11-kit.xml                    | 229 ----------------------------
 doc/pkcs11.conf.xml                | 207 -------------------------
 doc/style.css                      | 116 --------------
 doc/version.xml.in                 |   1 -
 31 files changed, 1555 insertions(+), 1552 deletions(-)

commit 0a6bf1bfad01aae0b707b9e13e6d14deade9cecf
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-12

    Release version 0.16.4

 NEWS         | 4 ++++
 configure.ac | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

commit 22993290d75bacb33c177be8ee2bc78ea0687ac8
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-11

    tools: Display per-command help appropriately
    
     * Fixes a regression
     * In addition allows --help to be specified before the command. If
       a command is present, command help will be shown
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62153

 tools/tool.c | 19 ++++++++++++-------
 1 file changed, 12 insertions(+), 7 deletions(-)

commit c80956aef3abaa90fa9ab7c2873a45adbe127dc4
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-11

    tools: Initialize local debug code correctly
    
    Unless initialized according to the environment all debug output
    is printed.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62152

 tools/tool.c | 3 +++
 1 file changed, 3 insertions(+)

commit ee632a4a904f9f16c66a24c97f5724f0c3150b10
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    Release version 0.16.3

 NEWS         | 6 ++++++
 configure.ac | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

commit b5660380769aa5b1c9b51af7e0fd2f18ed463a7e
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    iter: Don't skip tokens that don't have CKF_TOKEN_INITIALIZED
    
    This flag is not required to be set unless C_InitToken has been
    called. Many modules, like libnssckbi.so, do not set this flag.

 p11-kit/iter.c            |  4 ----
 p11-kit/tests/test-iter.c | 33 ---------------------------------
 2 files changed, 37 deletions(-)

commit ab14d9291df41b27f70ec3158d94f50f68ed80e1
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    trust: add a simple frob-nss-token tool to dump distrust
    
    Add a simple tool to dump NSS style distrust attributes from
    a module.

 trust/tests/Makefile.am      |   6 +++
 trust/tests/frob-nss-trust.c | 103 +++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 109 insertions(+)

commit 6ecf586a1e31f2874c7b185f4f2061aa9e83c08a
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    trust: Use the new NSS PKCS#11 extension codes
    
    NSS had subtly changed the values of the distrust CK_TRUST codes
    so update them to stay in sync.

 common/attrs.c            | 76 +++++++++++++++++++++++------------------------
 common/pkcs11x.h          | 59 ++++++++++++++++++------------------
 trust/adapter.c           | 22 +++++++-------
 trust/tests/test-module.c |  4 +--
 trust/tests/test-parser.c | 22 +++++++-------
 trust/token.c             |  6 ++--
 6 files changed, 95 insertions(+), 94 deletions(-)

commit 66fbcf7b6aac7fb808d3146335625cc15d4d2959
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    Hard code distrust temporarily.
    
    This is because we have no way to load this data into the trust module.
    Working on a real solution.

 trust/token.c | 150 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++-
 1 file changed, 149 insertions(+), 1 deletion(-)

commit b96095115a17818d3e6107e10bad0fef757611d7
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    tools: Parse global options appropriately, even if after command

 tools/tool.c | 31 ++++++++++++++++++-------------
 1 file changed, 18 insertions(+), 13 deletions(-)

commit 2ce1b21109c90b7dab240806686829e498875d74
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    trust: Refactor how we load builtin objects

 trust/token.c | 24 +++++++++++++-----------
 1 file changed, 13 insertions(+), 11 deletions(-)

commit b06b58b275ebccf6d7360083708b2614dd75e1b5
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    Don't shove messages into debug output if they're already displayed

 common/library.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

commit 347ac14998835ee18e5958a8b7c9aa1afec8eaa2
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    Release 0.16.2

 NEWS         | 5 +++++
 configure.ac | 2 +-
 2 files changed, 6 insertions(+), 1 deletion(-)

commit ba9cb5cab824fa4180355def6bc2e464b4e24ab0
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    extract: Use bool instead of int where appropriate

 tools/extract-info.c | 30 +++++++++++++++---------------
 1 file changed, 15 insertions(+), 15 deletions(-)

commit d7aee0a1ab76fb1299db5cf398088ebec1fe98be
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    tools: Add a bit of debugging to the PEM extract handler

 common/debug.h      | 1 +
 tools/extract-pem.c | 3 +++
 2 files changed, 4 insertions(+)

commit 082bc5773abe1c003bf34bbb3bf6a6b5282a212c
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    extract: Fix regression in --purpose option
    
    The --purpose option would only match certificates that had no
    purposes marked on them. Fix it so that it correctly matches
    certificates with the given purpose.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62009

 tools/extract-info.c       | 13 ++++++++++--
 tools/tests/test-extract.c | 50 ++++++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 61 insertions(+), 2 deletions(-)

commit fc383e025f09af70d3eb52fcd7e03c02733b14b0
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    Document and put code coverage online
    
     * Document our testing practices
     * Put lcov code coverage output online

 Makefile.am           | 16 ++++++++++++----
 doc/p11-kit-devel.xml | 22 ++++++++++++++++++++++
 2 files changed, 34 insertions(+), 4 deletions(-)

commit 945585b698b08b6f349e2e104862589b5acce0aa
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-08

    Properly detect the stdbool.h header
    
    https://bugs.freedesktop.org/show_bug.cgi?id=62001

 configure.ac | 2 ++
 1 file changed, 2 insertions(+)

commit cc6189fc4051be33c6f5c86ab767e614633bf831
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-07

    Release version 0.16.1

 NEWS         | 5 +++++
 configure.ac | 2 +-
 2 files changed, 6 insertions(+), 1 deletion(-)

commit 85eaff1aebb0e6625382fba179164490b6ebb538
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-07

    doc: Fix external URLs in documentation

 doc/p11-kit-devel.xml | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

commit ae05057c69a6ef9ed49b47db6e9ba2b8acdcfe23
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-07

    doc: Add P11_KIT_STRICT=yes debugging tip

 doc/p11-kit-devel.xml | 11 +++++++++++
 1 file changed, 11 insertions(+)

commit 220d7b027871f79f446c7b3c2db9ef43f24c19cc
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-07

    x509: Don't break when cA field of BasicConstraints is missing
    
    The field defaults to FALSE. It sucks that libtasn1 doesn't
    fill this in for us.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=61975

 common/x509.c | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

commit 3e532011ac100391315ffa13f537ed130cc45b2e
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-07

    tools: Remove extra debugging statement when running external commands

 tools/tool.c | 1 -
 1 file changed, 1 deletion(-)

commit be5d505fe840836561488bba3d11d8584ca9cb97
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-07

    extract-trust: Turn into a placeholder script that does nothing
    
    If the 'p11-kit extract-trust' command is to be used by
    distributions, make them customize it appropriately.

 tools/p11-kit-extract-trust.in | 36 +++++++++++++++---------------------
 1 file changed, 15 insertions(+), 21 deletions(-)

commit 0644bfd4c09c710fec1ed424779919fea7c06fca
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-07

    doc: Don't wrap the options in the pkcs11.conf manual page

 doc/pkcs11.conf.xml | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

commit 7b3da7d5bdaa97488668a16fcf1ea04b3d9de64e
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-04

    Release version 0.16.0

 NEWS         | 8 ++++++++
 configure.ac | 2 +-
 2 files changed, 9 insertions(+), 1 deletion(-)

commit 3f13da890649b8cb88e8e2e39872831c13567a1e
Author: Stef Walter <stefw@redhat.com>
Date:   2013-03-04

    Build with the libtasn1 CFLAGS properly
    
    Tweaks by: Roman Bogorodskiy <bogorodskiy@gmail.com>
    
    https://bugs.freedesktop.org/show_bug.cgi?id=61739

 common/Makefile.am       | 3 +++
 common/tests/Makefile.am | 4 ++++
 tools/Makefile.am        | 4 +++-
 tools/tests/Makefile.am  | 4 +++-
 trust/Makefile.am        | 1 +
 5 files changed, 14 insertions(+), 2 deletions(-)

commit 14b3b3d158bdd874f5bbd626f948d20e78b38f01
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-04

    Redo mock.h header in order to relicense
    
    Rewrite the mock.h header to relicense it. It is based on the BSD
    licensed mock.c file, so this isn't a big issue.

 common/mock.h | 1353 +++++++++++++++++++++++++++++----------------------------
 1 file changed, 686 insertions(+), 667 deletions(-)

commit a90cb3cc21fc479434165c8c531e1e49a6de6dd4
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-04

    Remove duplicate typedef
    
    https://bugs.freedesktop.org/show_bug.cgi?id=60894

 p11-kit/iter.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

commit 3ccec864bfc57ebdd524a0c9603aca829c64e3dc
Author: Roman Bogorodskiy <bogorodskiy@gmail.com>
Date:   2013-03-03

    Fix missing bracket in trust module check
    
    This fixes building --without-libtasn1
    
    https://bugs.freedesktop.org/show_bug.cgi?id=61740

 configure.ac | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 205ed0e0e26010150950e9e963a9a36693b5f71e
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Initialize modules correctly in tests
    
    This fixes hangs when running tests on windows

 tools/tests/test-extract.c | 2 ++
 tools/tests/test-openssl.c | 2 ++
 tools/tests/test-pem.c     | 2 ++
 tools/tests/test-save.c    | 2 ++
 tools/tests/test-x509.c    | 2 ++
 trust/tests/test-module.c  | 2 +-
 trust/tests/test-parser.c  | 1 +
 trust/tests/test-session.c | 1 +
 trust/tests/test-token.c   | 1 +
 9 files changed, 14 insertions(+), 1 deletion(-)

commit 6c55425a7de23a71d0abc3137f0015e878188bae
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Windows doesn't support symlinks, chmod, or atomic renames
    
     * Don't create symlinks on windows
     * No atomic renames, so delete and then rename
     * Make sure to close files before unlinking on windows
     * No chmod permissions on windows

 tools/extract-openssl.c    | 14 +++++++++++++-
 tools/save.c               | 44 ++++++++++++++++++++++++++++++++++++++++++--
 tools/save.h               |  4 ++++
 tools/tests/test-openssl.c |  7 ++++++-
 tools/tests/test-save.c    | 26 ++++++++++++++++++++++++--
 tools/tests/test.c         |  4 ++++
 tools/tests/test.h         |  8 ++++++++
 7 files changed, 101 insertions(+), 6 deletions(-)

commit 3acf285916968a05ea42b3ef0f9654a33e308da7
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Use mingw compatible coverage flags
    
    The way that coverage is built and linked is different with mingw
    so just use the --coverage flag to represent the correct behavior
    when cross compiling.

 configure.ac | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

commit 5868e4aba23b211d8dd35af5061939ee72fe9c41
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Don't use wchar_t for storing unicode characters
    
    On Win32 wchar_t is only 2 bytes, which breaks our UTF-8 conversion
    functions.

 common/utf8.c | 71 ++++++++++++++++++++++++++++++-----------------------------
 1 file changed, 36 insertions(+), 35 deletions(-)

commit bee435e09111f43dcc406160e9c9bdd8645fc86c
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Fix syntax errors in OS_WIN32 ifdefs

 common/compat.h           | 4 ++--
 common/library.c          | 6 +++---
 p11-kit/conf.c            | 2 +-
 p11-kit/util.c            | 4 ++--
 trust/module.c            | 6 ++++--
 trust/tests/test-module.c | 2 ++
 6 files changed, 14 insertions(+), 10 deletions(-)

commit 61e0cb5dddb89ddab1d68791eb28d892c114622f
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Open files in binary mode on windows
    
    So that the Windows' C library doesn't munge line endings

 common/compat.h    |  4 ++++
 p11-kit/conf.c     |  2 +-
 p11-kit/pin.c      |  2 +-
 tools/tests/test.c | 11 +++++------
 4 files changed, 11 insertions(+), 8 deletions(-)

commit d9076a99c59bb0132b25277a2340f428c9b6c98e
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Add compat gmtime_r() and timegm() functions
    
    Not available on Win32 or ancient unixes

 common/compat.c | 55 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 common/compat.h | 15 +++++++++++++++
 configure.ac    |  6 ++++++
 3 files changed, 76 insertions(+)

commit 2737be8914270275d07ccf4526a4ba8b781c195e
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Add compat mkstemp() and mkdtemp() functions
    
    Not available on Win32 or ancient unixes

 common/compat.c | 144 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 common/compat.h |  12 +++++
 2 files changed, 156 insertions(+)

commit 193f0043a546e0ef186addb2a0487d09e690d5b1
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Add compat vasprintf() and asprintf() functions
    
    These are not available on Win32 and ancient unixes

 common/compat.c | 66 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 common/compat.h | 17 +++++++++++++++
 configure.ac    |  1 +
 3 files changed, 84 insertions(+)

commit 66ee55e5947682d10eed7a36b9da72a8cf6a40f2
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Add compat strndup() function
    
    Not available on Win32 and ancient unixes

 common/compat.c | 22 ++++++++++++++++++++++
 common/compat.h |  7 +++++++
 configure.ac    |  1 +
 3 files changed, 30 insertions(+)

commit ae76545a0094114ef29dba52df97e69ab28b3dbc
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Abstract mmap() into a compat API
    
    The Win32 for mmap() is very different from Unix, so abstract
    this into our own p11_mmap_xxx() functions.

 common/compat.c          | 158 +++++++++++++++++++++++++++++++++++++----------
 common/compat.h          |  16 +++++
 common/tests/frob-cert.c |  35 ++++-------
 tools/tests/test.c       |   2 +
 trust/parser.c           |  28 +++------
 5 files changed, 160 insertions(+), 79 deletions(-)

commit 38acf11889c1e1da2610c8e05f1f380f2a2a1ae6
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Use putenv() instead of setenv()
    
    Since older operating systems don't support setenv()

 common/tests/test-asn1.c      | 2 +-
 common/tests/test-attrs.c     | 2 +-
 common/tests/test-buffer.c    | 2 +-
 common/tests/test-oid.c       | 2 +-
 common/tests/test-x509.c      | 2 +-
 p11-kit/tests/conf-test.c     | 2 +-
 p11-kit/tests/pin-test.c      | 2 +-
 p11-kit/tests/progname-test.c | 2 +-
 p11-kit/tests/test-init.c     | 2 +-
 p11-kit/tests/test-iter.c     | 2 +-
 p11-kit/tests/test-modules.c  | 2 +-
 p11-kit/tests/uri-test.c      | 2 +-
 trust/tests/test-module.c     | 2 +-
 trust/tests/test-parser.c     | 2 +-
 trust/tests/test-session.c    | 2 +-
 trust/tests/test-token.c      | 2 +-
 16 files changed, 16 insertions(+), 16 deletions(-)

commit 7823c9ddcb18b5155b3cc0e9d9f57ad0333d5eba
Author: Stef Walter <stefw@gnome.org>
Date:   2013-03-03

    Add compat implementation of basename()
    
    For Win32 and older unixes

 common/compat.c | 62 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 common/compat.h |  6 ++++++
 configure.ac    |  5 +++--
 3 files changed, 71 insertions(+), 2 deletions(-)

commit 02d7da2ba2247d017f248dd48e4365bd0a219bff
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-24

    tools: Update comments for cacerts jks format

 tools/extract-jks.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

commit b06bee023df6f4f2b004030e86e8ee90579681f5
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-20

    Rename p11_module_xxx() compat functions to p11_dl_xxx()
    
    For clarity. In addition, make p11_dl_close() able to be used
    as a destroyer callback.
    
    Also make p11_dl_error() return an allocated string

 common/compat.c   | 18 +++++++++---------
 common/compat.h   | 20 ++++++++++----------
 p11-kit/modules.c | 15 ++++++++++-----
 3 files changed, 29 insertions(+), 24 deletions(-)

commit 6521cccc021530f59f2f5e60a9cbf0c5b458360d
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-15

    Update the pkcs11.h header for missing mechanisms

 common/attrs.c  |  2 +-
 common/pkcs11.h | 25 +++++++++++++++++++++++++
 2 files changed, 26 insertions(+), 1 deletion(-)

commit 95ec58961a480c15fe780bbce6d6cd974f478407
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-06

    Only do shared object and DLL initialization in libraries
    
    Don't do library initialization on shared object load when not running
    in a library. We'll want to plug into this and do different things
    per library in the future.

 common/library.c | 60 +++++++++++---------------------------------------------
 common/library.h |  2 ++
 p11-kit/util.c   | 54 ++++++++++++++++++++++++++++++++++++++++++++++++++
 trust/module.c   | 55 +++++++++++++++++++++++++++++++++++++++++++++++++++
 4 files changed, 122 insertions(+), 49 deletions(-)

commit c6ebe7eb68e07e4f22c7b7ede14a1e4f04e893b7
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-15

    Move pkcs11.conf and module documentation to a manual page

 .gitignore             |   1 +
 doc/Makefile.am        |  19 ++++-
 doc/p11-kit-config.xml | 166 +++------------------------------------
 doc/p11-kit-docs.sgml  |   3 +-
 doc/p11-kit.xml        |   5 +-
 doc/pkcs11.conf.xml    | 207 +++++++++++++++++++++++++++++++++++++++++++++++++
 6 files changed, 239 insertions(+), 162 deletions(-)

commit 726e98ed071601770c2724f358eabbbc682f1fdc
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-13

    Pull translations from transifex
    
     * Build a script to help with this
    
    https://bugs.freedesktop.org/show_bug.cgi?id=60792

 .gitignore      |   1 +
 Makefile.am     |   3 +
 build/tx-update |  68 +++++++++++
 po/LINGUAS      |  34 ++++++
 po/bg.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/cs.po        | 343 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/de.po        |  24 ++--
 po/el.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/en_GB.po     | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/eo.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/es.po        | 346 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/eu.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/fa.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/fi.po        |  20 ++--
 po/fr.po        | 343 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/gl.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/hr.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/hu.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/ia.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/id.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/it.po        | 346 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/ja.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/ka.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/ko.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/lv.po        | 346 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/nl.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/pa.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/pl.po        | 346 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/pt_BR.po     | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/ru.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/sk.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/sl.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/sq.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/sr.po        | 346 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/te.po        | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/tr.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/uk.po        | 345 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/zh_CN.po     | 343 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/zh_HK.po     | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 po/zh_TW.po     | 344 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 40 files changed, 11845 insertions(+), 21 deletions(-)

commit 380f457ce458e32f1ccc15acfa664df82629981f
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-12

    Relicense the buffer code appropriate for inclusion in p11-kit
    
     * All original lines in this file upon arrival in the p11-kit
       project were written by me, and copyright held by me.

 common/buffer.c | 57 ++++++++++++++++++++++++++++++++++-----------------------
 common/buffer.h | 57 ++++++++++++++++++++++++++++++++++-----------------------
 2 files changed, 68 insertions(+), 46 deletions(-)

commit 65e68c88d85d8b6896afe9f9e101aefb618ce6be
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-12

    Release version 0.15.2
    
     * This is an unstable release

 NEWS         | 6 ++++++
 configure.ac | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

commit efef089a772f4f05caefebf2a6466b4225dc9b00
Author: Timo Jyrinki <timo.jyrinki@iki.fi>
Date:   2013-02-12

    Add finish translation

 po/LINGUAS |   1 +
 po/fi.po   | 343 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 344 insertions(+)

commit 41b3f707906a4f6273f7fdb1174be3343bbf1ea7
Author: Andreas Metzler <ametzler@downhill.at.eu.org>
Date:   2011-09-24

    Add and enable German gettext translation
    
    Enable installation of gettext translations and add German translation
    by Chris Leick.

 .gitignore   |   3 +
 configure.ac |   3 +
 po/LINGUAS   |   4 +
 po/de.po     | 351 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 4 files changed, 361 insertions(+)

commit b90410f7c6ef5e1bb73837d7ddbda855a91ac79f
Author: Andreas Metzler <ametzler@downhill.at.eu.org>
Date:   2013-02-12

    Respect destdir when creating package module config directory

 p11-kit/Makefile.am | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 04781672277a537551c369ae71ecdc8410e31dc3
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-11

    Fix dereference of varargs in p11_attrs_build()
    
    https://bugs.freedesktop.org/show_bug.cgi?id=60473

 common/attrs.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 077fd91bed34bb6226e0a43a26f9e546372db54a
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-11

    Remove unnecessary code to be more compatible with various libtasn1 versions
    
    https://bugs.freedesktop.org/show_bug.cgi?id=60434

 common/asn1.c | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

commit 828df42b98fa0ffc1695db8af9bd0bd03f2583bc
Author: Andreas Metzler <ametzler@downhill.at.eu.org>
Date:   2013-02-07

    Don't require explictly disabling trust module if --without-libtasn1
    
    And provide more intelligent error messages about why to build
    with libtasn1
    
    Tweaked by Stef Walter

 configure.ac | 28 ++++++++++++++++------------
 1 file changed, 16 insertions(+), 12 deletions(-)

commit 2e8ce8c5ecb6d1f1c8f0af244d9f9b75dc6050ea
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-06

    Fix various clang analyzer warnings
    
     * Add annotations to our precondition functions so that they
       don't make the analyzer complain

 common/compat.h         | 13 +++++++++++++
 common/debug.h          |  3 ++-
 p11-kit/conf.c          |  2 +-
 p11-kit/pin.c           |  3 ++-
 p11-kit/uri.c           |  1 -
 tools/extract-openssl.c |  9 +++++++--
 tools/extract.c         |  3 +++
 tools/tool.c            |  3 +--
 8 files changed, 29 insertions(+), 8 deletions(-)

commit 0c6517104d1306228c31e596b0df6a4fb5af4dd1
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-05

    Our minimum version of libtasn1 is 2.14

 configure.ac | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit e7fe6fd2cdde5e15a14abca39303c5049174f4f9
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-05

    Release version 0.15.1
    
     * This is an unstable release

 NEWS         | 14 ++++++++++++++
 configure.ac |  2 +-
 2 files changed, 15 insertions(+), 1 deletion(-)

commit f3a3e1e6a413dc93d0a1eb330a32404d803f5307
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-03

    Add a placeholder external 'extract-trust' command

 .gitignore                     |  1 +
 configure.ac                   |  1 +
 doc/p11-kit-devel.xml          | 23 +++++++++++++++++++++++
 doc/p11-kit.xml                | 19 +++++++++++++++++++
 tools/Makefile.am              |  4 ++++
 tools/p11-kit-extract-trust.in | 27 +++++++++++++++++++++++++++
 6 files changed, 75 insertions(+)

commit 08f1a7f3cfe87bc19ecd564711b4d2beaa603924
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-01

    Implement support for java JKS keystore format
    
     * All aliases must be lower case in order to work with the
       default keystore implementation.

 doc/p11-kit.xml     |   4 +
 tools/Makefile.am   |   2 +-
 tools/extract-jks.c | 331 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 tools/extract.c     |   4 +-
 4 files changed, 339 insertions(+), 2 deletions(-)

commit 32ca4f6d3167d08fc985d66fe48f453954596f87
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-03

    Use the CN, OU or O of certificates to generate a label
    
     * This is in cases where the certificate information does not
       already have a friendly name or alias.

 common/Makefile.am         |   1 +
 common/oid.h               |  18 +++
 common/tests/Makefile.am   |   1 +
 common/tests/test-utf8.c   | 252 ++++++++++++++++++++++++++++++++++
 common/tests/test-x509.c   |  81 +++++++++++
 common/utf8.c              | 328 +++++++++++++++++++++++++++++++++++++++++++++
 common/utf8.h              |  53 ++++++++
 common/x509.c              | 136 +++++++++++++++++++
 common/x509.h              |  16 +++
 tools/extract-openssl.c    |  70 +++-------
 tools/tests/Makefile.am    |   7 -
 tools/tests/test-openssl.c |  16 ++-
 tools/tests/test-utf8.c    | 252 ----------------------------------
 tools/utf8.c               | 328 ---------------------------------------------
 tools/utf8.h               |  53 --------
 trust/parser.c             |  51 ++++---
 trust/tests/test-parser.c  |  22 +--
 17 files changed, 951 insertions(+), 734 deletions(-)

commit 39e9f190416ecb4260a3b079e1d79fc2e55f5a33
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-30

    Add support for exporting OpenSSL's TRUSTED CERTIFICATE format

 build/certs/Makefile.am                            |   9 +
 doc/p11-kit.xml                                    |   8 +
 tools/Makefile.am                                  |   2 +
 tools/extract-openssl.c                            | 686 +++++++++++++++++++++
 tools/extract.c                                    |   4 +
 tools/tests/Makefile.am                            |  15 +
 tools/tests/files/cacert3-distrust-all.pem         |  44 ++
 tools/tests/files/cacert3-distrusted-all.pem       |  43 ++
 tools/tests/files/cacert3-not-trusted.pem          |  42 ++
 tools/tests/files/cacert3-trusted-alias.pem        |  42 ++
 .../files/cacert3-trusted-client-server-alias.pem  |  43 ++
 tools/tests/files/cacert3-trusted-keyid.pem        |  42 ++
 tools/tests/files/cacert3-trusted-multiple.pem     |  85 +++
 tools/tests/test-openssl.c                         | 671 ++++++++++++++++++++
 tools/tests/test-utf8.c                            | 252 ++++++++
 tools/tests/test.h                                 |   9 +
 tools/utf8.c                                       | 328 ++++++++++
 tools/utf8.h                                       |  53 ++
 18 files changed, 2378 insertions(+)

commit dbcf3c049f4aadc1d25eb952b4feabdec14cf35d
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-30

    Add support for extracting to pem-bundle and pem-directory formats

 build/certs/Makefile.am             |   2 +
 doc/p11-kit.xml                     |   8 ++
 tools/Makefile.am                   |   1 +
 tools/extract-pem.c                 | 125 +++++++++++++++++
 tools/extract.c                     |   2 +
 tools/tests/Makefile.am             |   8 ++
 tools/tests/files/cacert3-twice.pem |  84 +++++++++++
 tools/tests/files/cacert3.pem       |  42 ++++++
 tools/tests/test-pem.c              | 269 ++++++++++++++++++++++++++++++++++++
 9 files changed, 541 insertions(+)

commit 5df24bf0fb8532e0ebdf5f2366834848fdf6097d
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-23

    Implement code for writing PEM
    
     * Based on the gcr code
     * Bring in base64 output code from BSD
     * Make sure to output base64 lines of 64 character length since
       this is what OpenSSL expects

 common/base64.c         |  62 ++++++++++++++++++++++++++
 common/base64.h         |   6 +++
 common/pem.c            |  54 ++++++++++++++++++++++-
 common/pem.h            |   5 +++
 common/tests/test-pem.c | 114 ++++++++++++++++++++++++++++++++++++++++++++++--
 5 files changed, 237 insertions(+), 4 deletions(-)

commit 722efb88cf12261d705e2a6dfb4aceab9ff7b76f
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-30

    Implement basic extract support
    
     * The only formats supported are x509-file and x509-directory
    
    Allow tool to build without extract

 configure.ac               |   1 +
 doc/Makefile.am            |   1 -
 doc/p11-kit.xml            |  95 ++++++++++
 doc/style.css              |   4 +
 tools/Makefile.am          |  20 +-
 tools/extract-info.c       | 359 +++++++++++++++++++++++++++++++++++
 tools/extract-x509.c       | 116 ++++++++++++
 tools/extract.c            | 461 +++++++++++++++++++++++++++++++++++++++++++++
 tools/extract.h            | 110 +++++++++++
 tools/tests/Makefile.am    |  15 ++
 tools/tests/test-extract.c | 301 +++++++++++++++++++++++++++++
 tools/tests/test-x509.c    | 276 +++++++++++++++++++++++++++
 tools/tests/test.h         |  33 ++++
 tools/tool.c               |   3 +
 tools/tool.h               |   3 +
 15 files changed, 1796 insertions(+), 2 deletions(-)

commit 9a21e6ddf9eb7bb0f13f01cddba9dedd7a6e43b3
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-23

    Support for sane writing to files extracted
    
     * Implement atomic writes of files
     * Writing with checks that not overwriting anything unless desired
     * Writing and overwriting of directory contents in a robust way

 build/certs/Makefile.am       |   2 +
 configure.ac                  |   1 +
 tools/Makefile.am             |   3 +
 tools/save.c                  | 462 +++++++++++++++++++++++++++++++++++++++
 tools/save.h                  |  79 +++++++
 tools/tests/Makefile.am       |  52 +++++
 tools/tests/files/cacert3.der | Bin 0 -> 1885 bytes
 tools/tests/test-save.c       | 494 ++++++++++++++++++++++++++++++++++++++++++
 tools/tests/test.c            | 200 +++++++++++++++++
 tools/tests/test.h            | 211 ++++++++++++++++++
 10 files changed, 1504 insertions(+)

commit 3e70ecbab850bcc08ee89e1256d82cca70d80ee7
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-21

    Add public iterator API to p11-kit

 common/mock.c                  |  113 +++-
 common/mock.h                  |   37 ++
 doc/Makefile.am                |    1 +
 doc/annotation-glossary.xml    |   67 +++
 doc/p11-kit-docs.sgml          |    3 +
 doc/p11-kit-sections.txt       |   17 +
 p11-kit/Makefile.am            |    2 +
 p11-kit/iter.c                 |  829 +++++++++++++++++++++++++++++
 p11-kit/iter.h                 |  101 ++++
 p11-kit/p11-kit.h              |    2 +
 p11-kit/tests/Makefile.am      |    4 +-
 p11-kit/tests/mock-module-ep.c |    2 +-
 p11-kit/tests/test-iter.c      | 1140 ++++++++++++++++++++++++++++++++++++++++
 13 files changed, 2308 insertions(+), 10 deletions(-)

commit e5816187231ce27e5f634995e62c1d3ae5c5b2f1
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-21

    Allow internal use of token and module info matching

 p11-kit/private.h |  6 ++++++
 p11-kit/uri.c     | 55 +++++++++++++++++++++++++++++++++++--------------------
 2 files changed, 41 insertions(+), 20 deletions(-)

commit 67ce28e9d9ec1528c9b762b0912d6a7e339fbcd5
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-21

    Move the X.509 extension parsing code in common/
    
     * So it can be used by other code, in addition to the trust stuff

 common/tests/test-x509.c | 191 +++++++++++++++++++++++++++++++++++++++++++++--
 common/x509.c            |  67 ++++++++++++++++-
 common/x509.h            |   9 ++-
 trust/adapter.c          | 132 ++++++++++++++++++--------------
 trust/parser.c           |  69 ++---------------
 5 files changed, 335 insertions(+), 133 deletions(-)

commit 5e4a3ea9b8f254d99544490eed8e17e88c81f975
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-18

    Add p11_array_clear() function
    
     * Clears an array without freeing the array itself

 common/array.c            | 21 ++++++++++++++-------
 common/array.h            |  2 ++
 common/tests/test-array.c | 27 +++++++++++++++++++++++++++
 3 files changed, 43 insertions(+), 7 deletions(-)

commit 4400d8ecc4525cfc848937dc562c542fc58a533a
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-04

    Implement trust assertion PKCS#11 objects
    
     * Implement trust assertions for anchored and distrusted certs
     * Pinned certificate trust assertions are not implemented yet
     * Add an internal tool for pulling apart bits of certificates

 common/oid.h                    |   1 -
 common/tests/Makefile.am        |   1 +
 common/tests/test-oid.c         |  18 +-
 doc/p11-kit-trust.xml           |  11 +
 trust/Makefile.am               |   2 +-
 trust/adapter.c                 | 456 ++++++++++++++++++++++++++++++++++++++++
 trust/adapter.h                 |  44 ++++
 trust/mozilla.h                 |  44 ----
 trust/p11-kit-trust.module      |   3 +
 trust/parser.c                  |   5 +-
 trust/tests/files/redhat-ca.der | Bin 0 -> 948 bytes
 trust/tests/test-parser.c       | 352 ++++++++++++++++++++++++++++---
 12 files changed, 844 insertions(+), 93 deletions(-)

commit 7e61265ced3f33685b68bb6e2c7505485cfe0177
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-04

    Refactor how parsing of ASN.1 data and certificate extensions work

 common/Makefile.am        |   2 +
 common/asn1.c             | 551 ++++++++++++++++++++++++++++++++++++++++++++++
 common/asn1.h             |  65 ++++++
 common/oid.h              |  12 +-
 common/tests/Makefile.am  |   2 +
 common/tests/test-asn1.c  | 113 ++++++++++
 common/tests/test-x509.c  | 185 ++++++++++++++++
 common/x509.c             | 152 +++++++++++++
 common/x509.h             |  56 +++++
 trust/mozilla.c           |  31 ++-
 trust/parser.c            | 546 +++------------------------------------------
 trust/parser.h            |  14 +-
 trust/tests/test-data.h   |  28 +--
 trust/tests/test-parser.c | 103 ---------
 14 files changed, 1193 insertions(+), 667 deletions(-)

commit 8b02ff64b30311a4730b60dd72590435f56fb3a2
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-03

    Fill in certificate authority and trust data correctly
    
     * Fill in CKA_CERTIFICATE_CATEGORY properly for authorities
       based on the presence of BasicConstraints and/or v1 certificates
     * Fill in CKA_TRUSTED and CKA_X_DISTRUSTED based on whether the
       parser is running for anchors or blacklist
     * In addition support the concept of blacklisted certificates mixed
       in with the anchors (without any purposes) since that's what exists
       in the real world.
     * We do this after the various hooks have had a chance to mess
       with the certificate extensions and such.

 common/oid.h              |   9 +-
 trust/mozilla.c           |  74 +++++-----
 trust/parser.c            | 351 ++++++++++++++++++++++++++++++++++++----------
 trust/parser.h            |  11 +-
 trust/tests/test-data.c   |  18 ++-
 trust/tests/test-data.h   |   9 ++
 trust/tests/test-parser.c | 246 ++++++++++++++++++++++++--------
 trust/tests/test-token.c  |   2 +-
 8 files changed, 552 insertions(+), 168 deletions(-)

commit 18bb2582c32f4373f7ed85894fb490f2733cb03b
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-02

    Implement stapled certificate extensions internally
    
     * Use stapled certificate extensions to represent loaded trust policy
     * Build NSS trust objects from stapled certificate extensions
     * Add further attribute debugging for NSS trust objects
     * Use a custom certificate extension for the OpenSSL reject purpose data
     * Use SubjectKeyIdentifier for OpenSSL keyid data
     * Use ExtendedKeyUsage for OpenSSL trust purpose data
     * Implement simple way to handle binary DER OIDs, using the DER TLV
       length. DER OIDs are used in the CKA_OBJECT_ID value, and elsewhere.
     * Split out the building of NSS trust objects from the main parser

 common/Makefile.am                        |   1 +
 common/compat.c                           |   2 +-
 common/compat.h                           |   2 +-
 common/oid.c                              | 100 +++++
 common/oid.h                              | 209 +++++++++
 common/tests/Makefile.am                  |   2 +
 common/tests/frob-ku.c                    |  28 +-
 common/tests/frob-oid.c                   | 100 +++++
 common/tests/test-oid.c                   | 133 ++++++
 trust/Makefile.am                         |   1 +
 trust/mozilla.c                           | 284 ++++++++++++
 trust/mozilla.h                           |  44 ++
 trust/parser.c                            | 724 +++++++++++++++++-------------
 trust/parser.h                            |  39 +-
 trust/tests/files/self-signed-with-ku.der | Bin 0 -> 478 bytes
 trust/tests/test-data.c                   |   9 +-
 trust/tests/test-parser.c                 | 159 +++++--
 17 files changed, 1450 insertions(+), 387 deletions(-)

commit 3b482acc47ba971406db526ebddf589ad1a8f16e
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-02

    Better debugging and checks for attribute values

 trust/tests/test-data.c   | 154 ++++++++++++++++++++++++----------------------
 trust/tests/test-data.h   |  32 +++++++++-
 trust/tests/test-module.c |  13 ++--
 trust/tests/test-parser.c |  11 ++--
 4 files changed, 124 insertions(+), 86 deletions(-)

commit e46c74aef6eee7da3cdfb17077905811b9e04a61
Author: Stef Walter <stefw@gnome.org>
Date:   2012-12-19

    Add tool for testing how fast the token loads

 trust/tests/Makefile.am  |  1 +
 trust/tests/frob-token.c | 64 ++++++++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 65 insertions(+)

commit 83af40091fdc50a1da21d6cd2582ecef759bfb7c
Author: Stef Walter <stefw@gnome.org>
Date:   2012-12-17

    Some debug info about which files are being loaded

 trust/token.c | 17 +++++++++++++++--
 1 file changed, 15 insertions(+), 2 deletions(-)

commit 1f47fbffe1befb30a1bd3dfcec079a8a9f2fd957
Author: Stef Walter <stefw@gnome.org>
Date:   2012-12-17

    Test a TRUSTED CERTIFICATE without any trust OIDs

 build/certs/Makefile.am          |   2 ++
 build/certs/redhat-newca.der     | Bin 0 -> 948 bytes
 trust/tests/files/distrusted.pem |  23 +++++++++++++++++++++++
 trust/tests/test-parser.c        |  15 +++++++++++++++
 4 files changed, 40 insertions(+)

commit 75654253498993ff1638e0e64440c335b54df1db
Author: Stef Walter <stefw@gnome.org>
Date:   2012-12-17

    Add the builtin roots NSS specific object
    
    This tells NSS that this is a source of anchors.

 doc/p11-kit-trust.xml     |  5 ++++-
 trust/tests/test-module.c | 27 +++++++++++++++++++++++++++
 trust/tests/test-token.c  |  6 +++---
 trust/token.c             | 28 +++++++++++++++++++++++++++-
 4 files changed, 61 insertions(+), 5 deletions(-)

commit c2dcd0b3cb1ccac4eff98044d43d3f8696094644
Author: Stef Walter <stefw@gnome.org>
Date:   2012-12-17

    Add support for openssl TRUSTED CERTIFICATE PEM files

 build/certs/Makefile.am               |   3 +
 common/Makefile.am                    |   2 +
 common/openssl.asn                    |  28 ++++
 common/openssl.asn.h                  |  28 ++++
 doc/p11-kit-trust.xml                 |   8 ++
 trust/parser.c                        | 244 ++++++++++++++++++++++++++++------
 trust/tests/files/cacert3-trusted.pem |  43 ++++++
 trust/tests/test-parser.c             |  52 ++++++++
 8 files changed, 368 insertions(+), 40 deletions(-)

commit a286df75050db8b306685cb22e491d11be842584
Author: Stef Walter <stefw@gnome.org>
Date:   2012-12-17

    Add support for parsing PEM files

 build/certs/Makefile.am       |   1 +
 common/Makefile.am            |   2 +
 common/base64.c               | 192 +++++++++++++++++++++++++++++++
 common/base64.h               |  53 +++++++++
 common/pem.c                  | 241 +++++++++++++++++++++++++++++++++++++++
 common/pem.h                  |  50 +++++++++
 common/tests/Makefile.am      |  14 ++-
 common/tests/test-pem.c       | 254 ++++++++++++++++++++++++++++++++++++++++++
 trust/Makefile.am             |   3 +-
 trust/parser.c                |  38 +++++++
 trust/tests/files/cacert3.pem |  42 +++++++
 trust/tests/test-parser.c     |  26 +++++
 12 files changed, 910 insertions(+), 6 deletions(-)

commit 5147d71466455b3d087b3f3a7472a35e8216c55a
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-24

    Add basic trust module
    
    This is based off the roots-store from gnome-keyring and loads
    certificates from a root directory and exposes them as PKCS#11
    objects.

 Makefile.am                                       |    7 +
 build/Makefile.am                                 |    2 +
 build/certs/Makefile.am                           |   27 +
 build/certs/cacert-ca.der                         |  Bin 0 -> 1857 bytes
 build/certs/cacert3.der                           |  Bin 0 -> 1885 bytes
 build/certs/self-server.der                       |  Bin 0 -> 396 bytes
 build/certs/self-signed-with-eku.der              |  Bin 0 -> 480 bytes
 build/certs/self-signed-with-ku.der               |  Bin 0 -> 501 bytes
 build/certs/testing-ca.der                        |  Bin 0 -> 970 bytes
 build/certs/testing-server.der                    |  Bin 0 -> 554 bytes
 build/certs/with-eku.conf                         |   19 +
 build/certs/with-ku.conf                          |   19 +
 common/Makefile.am                                |   15 +-
 common/compat.c                                   |  107 ++
 common/compat.h                                   |   17 +-
 common/debug.c                                    |    1 +
 common/debug.h                                    |   11 +
 common/pkix.asn                                   |  566 ++++++++
 common/pkix.asn.h                                 |  408 ++++++
 common/tests/Makefile.am                          |   20 +-
 common/tests/frob-cert.c                          |  147 ++
 common/tests/frob-eku.c                           |  101 ++
 common/tests/frob-ku.c                            |  134 ++
 configure.ac                                      |  128 +-
 doc/Makefile.am                                   |    2 +
 doc/p11-kit-config.xml                            |   10 +
 doc/p11-kit-devel.xml                             |   24 +
 doc/p11-kit-docs.sgml                             |    1 +
 doc/p11-kit-trust.xml                             |   90 ++
 doc/style.css                                     |    6 +-
 p11-kit/Makefile.am                               |    1 +
 p11-kit/conf.c                                    |   37 -
 p11-kit/p11-kit-1.pc.in                           |    3 +
 trust/Makefile.am                                 |   52 +
 trust/module.c                                    | 1517 +++++++++++++++++++++
 trust/module.h                                    |   42 +
 trust/p11-kit-trust.module                        |    6 +
 trust/parser.c                                    | 1103 +++++++++++++++
 trust/parser.h                                    |  108 ++
 trust/session.c                                   |  206 +++
 trust/session.h                                   |   78 ++
 trust/tests/Makefile.am                           |   44 +
 trust/tests/anchors/cacert3.der                   |  Bin 0 -> 1885 bytes
 trust/tests/anchors/testing-ca.der                |  Bin 0 -> 970 bytes
 trust/tests/certificates/cacert-ca.der            |  Bin 0 -> 1857 bytes
 trust/tests/certificates/self-signed-with-eku.der |  Bin 0 -> 480 bytes
 trust/tests/certificates/self-signed-with-ku.der  |  Bin 0 -> 501 bytes
 trust/tests/files/cacert-ca.der                   |  Bin 0 -> 1857 bytes
 trust/tests/files/cacert3.der                     |  Bin 0 -> 1885 bytes
 trust/tests/files/self-server.der                 |  Bin 0 -> 396 bytes
 trust/tests/files/testing-server.der              |  Bin 0 -> 554 bytes
 trust/tests/files/unrecognized-file.txt           |    1 +
 trust/tests/test-data.c                           |  128 ++
 trust/tests/test-data.h                           |  220 +++
 trust/tests/test-module.c                         |  331 +++++
 trust/tests/test-parser.c                         |  315 +++++
 trust/tests/test-session.c                        |  160 +++
 trust/tests/test-token.c                          |  106 ++
 trust/token.c                                     |  256 ++++
 trust/token.h                                     |   51 +
 60 files changed, 6580 insertions(+), 47 deletions(-)

commit 603c7d4eb996f51178ccc9d235597497bbb2c7a4
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-24

    Add basic checksum algorithms
    
    The SHA-1 and MD5 digests here are used for checksums in legacy
    protocols. We don't use them in cryptographic contexts at all.
    These particular algorithms would be poor choices for that.

 .gitignore                   |   4 +-
 common/Makefile.am           |   9 +
 common/checksum.c            | 542 +++++++++++++++++++++++++++++++++++++++++++
 common/checksum.h            |  60 +++++
 common/tests/Makefile.am     |   2 +
 common/tests/test-checksum.c | 151 ++++++++++++
 6 files changed, 766 insertions(+), 2 deletions(-)

commit f6db686846480e0611879c5f4751955a53859808
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-05

    Remove the unused err() function and friends
    
    We want to use p11_message in our commands anyway, since that
    allows us control with --verbose and --quiet.

 common/compat.c | 164 --------------------------------------------------------
 common/compat.h |  23 --------
 2 files changed, 187 deletions(-)

commit 1ac3edf711b1cdb5e7fb8b1d6321fa855e07c1da
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-05

    Tweak style of the manual
    
     * Unindent the main headings
     * Don't wrap options
     * Better spacing in table of contents
     * Don't have line numbers on code examples

 doc/Makefile.am       |  5 ++++-
 doc/p11-kit-devel.xml |  4 ----
 doc/p11-kit.xml       |  2 --
 doc/style.css         | 23 +++++++++++++++++++++++
 4 files changed, 27 insertions(+), 7 deletions(-)

commit 866e3204cee593817850f5e5c23a0bcf7af9c591
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-05

    Add documentation about contributing to p11-kit

 HACKING                |  34 ++------
 doc/Makefile.am        |   2 +-
 doc/p11-kit-config.xml |   4 +-
 doc/p11-kit-devel.xml  | 223 +++++++++++++++++++++++++++++++++++++++++++++++++
 doc/p11-kit-docs.sgml  |  13 +--
 doc/p11-kit-notes.xml  |  48 -----------
 6 files changed, 241 insertions(+), 83 deletions(-)

commit 28777eeebf38c13a43d0118a86391d2a487ad15b
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-05

    Add a p11-kit tool manual page

 .gitignore            |   1 +
 configure.ac          |   4 ++
 doc/Makefile.am       |  33 +++++++++++++-
 doc/p11-kit-docs.sgml |   5 +++
 doc/p11-kit.xml       | 122 ++++++++++++++++++++++++++++++++++++--------------
 5 files changed, 130 insertions(+), 35 deletions(-)

commit 23b18cb345afe061274ff73cd66fe8e6672fbcd4
Author: Stef Walter <stefw@gnome.org>
Date:   2013-02-05

    Change the documentation configure arg to --enable-doc
    
     * We're building more than just the gtk-doc reference

 Makefile.am  |  2 +-
 configure.ac | 41 +++++++++++++++++++++++------------------
 2 files changed, 24 insertions(+), 19 deletions(-)

commit 85751aa21dd9b93d8eb51e36767b5564ce6ce005
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-29

    Add a /usr/share/p11-kit/modules directory for package module configs
    
     * Try to make /etc/pkcs11/modules for administrator use
     * Override the old pkg-config variables to help packages start
       using the new location

 configure.ac                                          |  3 +++
 doc/p11-kit-notes.xml                                 |  4 ++--
 p11-kit/Makefile.am                                   |  4 ++++
 p11-kit/conf.c                                        |  8 ++++++--
 p11-kit/conf.h                                        |  3 ++-
 p11-kit/modules.c                                     |  4 +++-
 p11-kit/p11-kit-1.pc.in                               | 13 +++++++------
 p11-kit/tests/conf-test.c                             |  4 ++++
 p11-kit/tests/files/package-modules/four.module       |  3 +++
 p11-kit/tests/files/package-modules/win32/four.module |  3 +++
 p11-kit/tests/files/system-modules/four.module        |  3 ---
 p11-kit/tests/files/system-modules/win32/four.module  |  3 ---
 12 files changed, 37 insertions(+), 18 deletions(-)

commit a9790a21302f47016a88ba9a2c904bed11efb388
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-29

    Make the p11-kit tool have distinct commands
    
     * Change the -l argument into the list-modules command.
     * Add proper functions for printing usage
     * Support for external commands in the path or /usr/share/p11-kit

 tools/Makefile.am |   9 +-
 tools/list.c      | 292 ++++++++++++++++++++++++++++++++++++++++++++++
 tools/p11-kit.c   | 273 -------------------------------------------
 tools/tool.c      | 337 ++++++++++++++++++++++++++++++++++++++++++++++++++++++
 tools/tool.h      |  56 +++++++++
 5 files changed, 692 insertions(+), 275 deletions(-)

commit 15163fb9b7b03543da02d74d75d0f49c314f1c33
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-29

    Add p11_kit_be_loud() function for use in tests and tools
    
    This does the opposite of p11_kit_be_quiet().

 doc/p11-kit-sections.txt |  1 +
 p11-kit/p11-kit.h        |  2 ++
 p11-kit/util.c           | 14 ++++++++++++++
 3 files changed, 17 insertions(+)

commit cba41e5a46893b16cfbd845d55285894f4a43408
Author: Stef Walter <stefw@gnome.org>
Date:   2012-08-23

    Add internal function for turning on messages
    
    To be used from tests

 common/library.c | 8 ++++++++
 common/library.h | 2 ++
 2 files changed, 10 insertions(+)

commit 43a3f5df8124bb85567feb18975d19fa1b639b9f
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-24

    Add more mock-module implementation
    
     * Move mock code into the common/ directory to be used by multiple
       components of p11-kit

 common/Makefile.am             |    5 +
 common/mock.c                  | 3117 ++++++++++++++++++++++++++++++++++++++++
 common/mock.h                  |  696 +++++++++
 doc/Makefile.am                |    3 +
 p11-kit/tests/Makefile.am      |   14 +-
 p11-kit/tests/mock-module-ep.c |    4 +-
 p11-kit/tests/mock-module.c    |  898 ------------
 p11-kit/tests/mock-module.h    |  337 -----
 p11-kit/tests/test-init.c      |    4 +-
 9 files changed, 3835 insertions(+), 1243 deletions(-)

commit 7ddff6795830deff6ec5fb1b8b0c704fbdea2c97
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-24

    Further tweaks and cleanup for functions dealing with PKCS#11 attributes
    
     * Check that the size is correct when looking for a boolean
       or a ulong.
     * Make sure that the length is not the invalid negative ulong.
     * Functions for dumping out attribute contents
     * Make it possible to use attributes in hash tables

 common/attrs.c            | 795 +++++++++++++++++++++++++++++++++++++++++++---
 common/attrs.h            |  59 +++-
 common/tests/test-attrs.c | 126 +++++++-
 3 files changed, 910 insertions(+), 70 deletions(-)

commit 322b4739cb51aa45568d9479224f2b07ac82a35f
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-24

    Add generic buffer code
    
    Represents a block of memory that can be added to, parsed and so on

 common/Makefile.am         |   1 +
 common/buffer.c            | 180 ++++++++++++++++++++++++++++++++++++++
 common/buffer.h            |  82 +++++++++++++++++
 common/tests/Makefile.am   |   1 +
 common/tests/test-buffer.c | 214 +++++++++++++++++++++++++++++++++++++++++++++
 p11-kit/uri.c              |  93 ++++++++------------
 6 files changed, 515 insertions(+), 56 deletions(-)

commit b28c936bd281c4b7ff9ed0f621b840f6d5a4b328
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-23

    Use the stdbool.h C99 bool type
    
    It was getting really wild knowing whether a function returning
    an int would return -1 on failure or 0 or whether the int return
    value was actually a number etc..

 common/array.c              |  16 +++---
 common/array.h              |   4 +-
 common/attrs.c              |  12 ++---
 common/compat.h             |   8 +++
 common/debug.c              |   8 +--
 common/debug.h              |  14 +++---
 common/dict.c               |  41 +++++++--------
 common/dict.h               |  26 +++++-----
 common/library.c            |   4 +-
 common/tests/test-dict.c    |  90 +++++++++++++++++----------------
 configure.ac                |   2 +-
 p11-kit/conf.c              |  58 +++++++++++-----------
 p11-kit/conf.h              |   6 +--
 p11-kit/modules.c           |  32 ++++++------
 p11-kit/pin.c               |  22 ++++-----
 p11-kit/tests/conf-test.c   |  19 +++++--
 p11-kit/tests/mock-module.c |  14 +++---
 p11-kit/tests/uri-test.c    |  41 +++++++++++++--
 p11-kit/uri.c               | 118 ++++++++++++++++++++++++++------------------
 tools/p11-kit.c             |  10 ++--
 20 files changed, 311 insertions(+), 234 deletions(-)

commit 4671352fe2a4f56c6707322dcab0015e2e8600c4
Author: Stef Walter <stefw@gnome.org>
Date:   2012-12-17

    Only initialize p11-kit libraries once
    
     * Make the gcc constructor call p11_library_init_once()

 common/library.c | 14 ++++++++++----
 common/library.h |  6 ++++--
 2 files changed, 14 insertions(+), 6 deletions(-)

commit b39c9a7792824dfa8a05926261315356d9007098
Author: Stef Walter <stefw@gnome.org>
Date:   2012-12-10

    Set strict debug preconditions during testing

 common/tests/test-attrs.c     | 4 ++++
 p11-kit/tests/conf-test.c     | 1 +
 p11-kit/tests/pin-test.c      | 1 +
 p11-kit/tests/progname-test.c | 1 +
 p11-kit/tests/test-init.c     | 1 +
 p11-kit/tests/test-modules.c  | 1 +
 p11-kit/tests/uri-test.c      | 1 +
 7 files changed, 10 insertions(+)

commit 3ebc9a78d4bca0b630a8b887ab93d6cc654f2cb2
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-07

    Add common functions for manipulating CK_ATTRIBUTE arrays

 common/Makefile.am        |   1 +
 common/attrs.c            | 310 +++++++++++++++++++++++++++
 common/attrs.h            |  86 ++++++++
 common/tests/Makefile.am  |   1 +
 common/tests/test-attrs.c | 518 ++++++++++++++++++++++++++++++++++++++++++++++
 configure.ac              |   2 +-
 p11-kit/tests/uri-test.c  |   6 +-
 p11-kit/uri.c             | 207 +++++-------------
 8 files changed, 977 insertions(+), 154 deletions(-)

commit 4a0bd25fcafae57ef2ae0cfe8676eee2332d5951
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-02

    Move the pkcs11.h header files into common directory
    
     * Allows use of them across the whole project
     * Put a stub file in the p11-kit/ directory, so we can still refer
       to the headers using that path, which is what it will be at
       when in the installed includes directory.

 common/Makefile.am  |    7 +
 common/pkcs11.h     | 1373 +++++++++++++++++++++++++++++++++++++++++++++++++
 common/pkcs11x.h    |  155 ++++++
 p11-kit/Makefile.am |    3 +-
 p11-kit/pkcs11.h    | 1413 ++-------------------------------------------------
 5 files changed, 1577 insertions(+), 1374 deletions(-)

commit 8fb222266c5bf9181cd934c27528507d45476dad
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-08

    Build common code into noinst libraries
    
     * This is cleaner than building the same source files all over
       the place over and over.
     * Works better with code coverage.

 common/Makefile.am        | 12 ++++++++++--
 common/tests/Makefile.am  | 14 +++++---------
 p11-kit/Makefile.am       | 34 ++++++++--------------------------
 p11-kit/tests/Makefile.am |  8 ++++++--
 tools/Makefile.am         | 12 ++++++++----
 5 files changed, 37 insertions(+), 43 deletions(-)

commit 3d503948450d69293a3fdfec096e398fedf714f2
Author: Stef Walter <stefw@gnome.org>
Date:   2012-12-06

    Move debug and library code into the common/ subdirectory
    
    Start using p11_ as our internal prefix rather than _p11_. We explicitly
    export p11_kit_ so this is fine as far as visibility.
    
    Move the threading, mutex, and module compat, dict, and array code
    into the common directory too.
    
    Take this opportunity to clean up a bit of internal API as well,
    since so many lines are being touched internally.

 .gitignore                                         |   32 +-
 Makefile.am                                        |   13 +-
 build/Makefile.am                                  |   11 +
 build/Makefile.tests                               |    8 +
 build/cutest/CuTest.c                              |  329 ++++++
 build/cutest/CuTest.h                              |  111 ++
 build/cutest/README.txt                            |  211 ++++
 build/cutest/license.txt                           |   38 +
 build/m4/.empty                                    |    1 +
 common/Makefile.am                                 |   11 +
 common/array.c                                     |  119 ++
 common/array.h                                     |   66 ++
 common/compat.c                                    |   95 ++
 common/compat.h                                    |  123 ++
 common/debug.c                                     |  151 +++
 common/debug.h                                     |  129 +++
 common/dict.c                                      |  391 +++++++
 common/dict.h                                      |  178 +++
 common/library.c                                   |  286 +++++
 common/library.h                                   |   80 ++
 common/tests/Makefile.am                           |   32 +
 common/tests/test-array.c                          |  194 ++++
 common/tests/test-dict.c                           |  465 ++++++++
 configure.ac                                       |    7 +-
 doc/Makefile.am                                    |   11 +-
 m4/.empty                                          |    1 -
 p11-kit/Makefile.am                                |   54 +-
 p11-kit/conf.c                                     |  116 +-
 p11-kit/conf.h                                     |   14 +-
 p11-kit/debug.c                                    |  151 ---
 p11-kit/debug.h                                    |  129 ---
 p11-kit/hashmap.c                                  |  391 -------
 p11-kit/hashmap.h                                  |  173 ---
 p11-kit/modules.c                                  |  318 ++---
 p11-kit/pin.c                                      |   78 +-
 p11-kit/private.h                                  |   41 -
 p11-kit/proxy.c                                    |   86 +-
 p11-kit/ptr-array.c                                |  154 ---
 p11-kit/ptr-array.h                                |   61 -
 p11-kit/tests/Makefile.am                          |   63 +
 p11-kit/tests/conf-test.c                          |  415 +++++++
 p11-kit/tests/files/system-modules/four.module     |    3 +
 p11-kit/tests/files/system-modules/one.module      |    3 +
 .../files/system-modules/two-duplicate.module      |    3 +
 p11-kit/tests/files/system-modules/two.badname     |    5 +
 .../tests/files/system-modules/win32/four.module   |    3 +
 .../tests/files/system-modules/win32/one.module    |    3 +
 .../system-modules/win32/two-duplicate.module      |    3 +
 .../tests/files/system-modules/win32/two.badname   |    5 +
 p11-kit/tests/files/system-pkcs11.conf             |    3 +
 p11-kit/tests/files/test-1.conf                    |    6 +
 p11-kit/tests/files/test-pinfile                   |    1 +
 p11-kit/tests/files/test-pinfile-large             |   53 +
 p11-kit/tests/files/test-system-invalid.conf       |    3 +
 p11-kit/tests/files/test-system-merge.conf         |    7 +
 p11-kit/tests/files/test-system-none.conf          |    8 +
 p11-kit/tests/files/test-system-only.conf          |    8 +
 p11-kit/tests/files/test-user-invalid.conf         |    3 +
 p11-kit/tests/files/test-user-only.conf            |    4 +
 p11-kit/tests/files/test-user.conf                 |    3 +
 p11-kit/tests/files/user-modules/one.module        |    2 +
 p11-kit/tests/files/user-modules/three.module      |    5 +
 p11-kit/tests/files/user-modules/win32/one.module  |    2 +
 .../tests/files/user-modules/win32/three.module    |    5 +
 p11-kit/tests/mock-module-ep.c                     |   52 +
 p11-kit/tests/mock-module.c                        |  898 ++++++++++++++
 p11-kit/tests/mock-module.h                        |  337 ++++++
 p11-kit/tests/pin-test.c                           |  325 ++++++
 p11-kit/tests/print-messages.c                     |  137 +++
 p11-kit/tests/progname-test.c                      |   97 ++
 p11-kit/tests/test-init.c                          |  320 +++++
 p11-kit/tests/test-modules.c                       |  246 ++++
 p11-kit/tests/uri-test.c                           | 1223 ++++++++++++++++++++
 p11-kit/uri.c                                      |    6 +-
 p11-kit/util.c                                     |  318 +----
 p11-kit/util.h                                     |  158 ---
 tests/Makefile.am                                  |   76 --
 tests/conf-test.c                                  |  414 -------
 tests/cutest/CuTest.c                              |  329 ------
 tests/cutest/CuTest.h                              |  111 --
 tests/cutest/README.txt                            |  211 ----
 tests/cutest/license.txt                           |   38 -
 tests/files/system-modules/four.module             |    3 -
 tests/files/system-modules/one.module              |    3 -
 tests/files/system-modules/two-duplicate.module    |    3 -
 tests/files/system-modules/two.badname             |    5 -
 tests/files/system-modules/win32/four.module       |    3 -
 tests/files/system-modules/win32/one.module        |    3 -
 .../system-modules/win32/two-duplicate.module      |    3 -
 tests/files/system-modules/win32/two.badname       |    5 -
 tests/files/system-pkcs11.conf                     |    3 -
 tests/files/test-1.conf                            |    6 -
 tests/files/test-pinfile                           |    1 -
 tests/files/test-pinfile-large                     |   53 -
 tests/files/test-system-invalid.conf               |    3 -
 tests/files/test-system-merge.conf                 |    7 -
 tests/files/test-system-none.conf                  |    8 -
 tests/files/test-system-only.conf                  |    8 -
 tests/files/test-user-invalid.conf                 |    3 -
 tests/files/test-user-only.conf                    |    4 -
 tests/files/test-user.conf                         |    3 -
 tests/files/user-modules/one.module                |    2 -
 tests/files/user-modules/three.module              |    5 -
 tests/files/user-modules/win32/one.module          |    2 -
 tests/files/user-modules/win32/three.module        |    5 -
 tests/hash-test.c                                  |  465 --------
 tests/mock-module-ep.c                             |   52 -
 tests/mock-module.c                                |  898 --------------
 tests/mock-module.h                                |  337 ------
 tests/pin-test.c                                   |  323 ------
 tests/print-messages.c                             |  137 ---
 tests/progname-test.c                              |  110 --
 tests/ptr-array-test.c                             |  257 ----
 tests/test-init.c                                  |  319 -----
 tests/test-modules.c                               |  245 ----
 tests/uri-test.c                                   | 1221 -------------------
 116 files changed, 7687 insertions(+), 7592 deletions(-)

commit c343f355b6abfe65adc696b57b18dc57c834acbc
Author: Pankaj Sharma <pankaj.cscience@gmail.com>
Date:   2012-12-24

    Fix leak when initializing the proxy module
    
    https://bugs.freedesktop.org/show_bug.cgi?id=58704

 p11-kit/proxy.c | 2 ++
 1 file changed, 2 insertions(+)

commit 8b4c3561d9681096d588d599d049a77bea68470b
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-09

    Documentation fixes for PIN functions

 p11-kit/pin.c | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

commit e8aa2fa8f3a085ca514e7b305ff91e2c77e5e6f4
Author: Pankaj Sharma <pankaj.cscience@gmail.com>
Date:   2012-12-24

    Fix file descriptor leak in p11_kit_pin_file_callback()
    
     * Close the file descriptor used to read the the pin file
    
    https://bugs.freedesktop.org/show_bug.cgi?id=58706

 p11-kit/pin.c | 2 ++
 1 file changed, 2 insertions(+)

commit 488a466935d7995c803880ed258792f8a99095c0
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-08

    Distribute HACKING in the tarball

 Makefile.am | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

commit 6ac5af8deece74c383c912f2003b9650c87317b8
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-07

    Fix documentation warnings.
    
     * P11_KIT_URI_NO_MEMORY is an unexpected state, that will probably
       never actually be returned. But kept for API compatibility.
     * make distcheck doc fix

 doc/Makefile.am          | 2 +-
 doc/p11-kit-sections.txt | 3 ++-
 p11-kit/uri.c            | 9 ++++++---
 3 files changed, 9 insertions(+), 5 deletions(-)

commit e2b5bba185c96bf4ecddfe22d34ace02706122b4
Author: Stef Walter <stefw@gnome.org>
Date:   2013-01-07

    Guarantee that the key is freed when replaced
    
     * When setting a key in a map that already exists, then free
       the old key and replace with the new one.
     * Fix related bug where key was not properly allocated
     * Add tests for this
    
    https://bugs.freedesktop.org/show_bug.cgi?id=59087

 p11-kit/hashmap.c |   7 ++-
 p11-kit/modules.c |   6 ++-
 tests/hash-test.c | 124 +++++++++++++++++++++++++++++++++++++++---------------
 3 files changed, 102 insertions(+), 35 deletions(-)

commit 1559a3e43637406c8b56e880ba00c96bdd16462c
Author: Stef Walter <stefw@gnome.org>
Date:   2012-11-14

    Don't complain if we cannot access ~/.pkcs11/pkcs11.conf
    
     * If a process is running under selinux it may not be able
       to access the home directory of the uid that it is running as.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=57115

 p11-kit/conf.c | 42 +++++++++++++++++++++++++++++++++---------
 p11-kit/conf.h |  1 +
 2 files changed, 34 insertions(+), 9 deletions(-)

commit b5de8e1d514794f6ec3e8d79a766a9dae9eab6ea
Author: Stef Walter <stefw@gnome.org>
Date:   2012-09-18

    Refuse to load the p11-kit-proxy.so as a registered module
    
     * Since p11-kit-proxy.so is a symlink to the libp11-kit.so library
       we check that we are not calling into our known CK_FUNCTION_LIST
       for the proxy code.
     * Although such a configuration is invalid, detecting this directly
       prevents strange initialization loop issues that are hard to debug.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=55052

 p11-kit/modules.c | 14 ++++++++++----
 p11-kit/private.h |  1 +
 p11-kit/proxy.c   |  7 ++-----
 3 files changed, 13 insertions(+), 9 deletions(-)

commit 3e82c6182d913a3fd5cf904342a9a6fa44aef0d6
Author: Stef Walter <stefw@gnome.org>
Date:   2012-09-18

    Don't fail initialization if last initialized module fails
    
     * We weren't resetting the result code after a failure,
       so even though failures for critical modules didn't interrupt
       the initialization loop, the result still leaked to callers.
     * Also print an error message clearly indicating that a module
       failed to initialize, regardless of whether critical or not.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=55051

 p11-kit/modules.c | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

commit 37889e5f7ca5e2e45442f98dc84efb70d2acf907
Author: Stef Walter <stefw@gnome.org>
Date:   2012-09-06

    Release version 0.14

 NEWS         | 8 ++++++++
 configure.ac | 2 +-
 2 files changed, 9 insertions(+), 1 deletion(-)

commit bb6949da2fd071d879a13f8e24389fef697b451a
Author: Stef Walter <stefw@gnome.org>
Date:   2012-09-06

    Change the default of 'user-config' to merge.
    
     * This allows user configured PKCS#11 modules by default.
     * Admins can change this to 'none' in /etc/pkcs11/pkcs11.conf
       to go back to the previous behavior.
     * Posted to the mailing list.

 doc/p11-kit-config.xml         | 4 ++--
 p11-kit/conf.c                 | 2 +-
 p11-kit/pkcs11.conf.example.in | 4 ++--
 3 files changed, 5 insertions(+), 5 deletions(-)

commit 56860b7f72c444eed5923e11d735b85b630a171d
Author: Antoine Jacoutot <ajacoutot@openbsd.org>
Date:   2012-08-23

    configure.ac: Fix bogus comma, and fix up spacing
    
     * Fixes a mistake in the previous commit
    
    https://bugs.freedesktop.org/show_bug.cgi?id=53706

 configure.ac | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

commit 359bb15bc83484e4de69fa8dbc9113d97817d01e
Author: Antoine Jacoutot <ajacoutot@openbsd.org>
Date:   2012-08-21

    Use AC_LANG_PROGRAM to detect program_invocation_short_name functionality
    
    Were erroneusly detecting program_invocation_short_name on OpenBSD
    
    https://bugs.freedesktop.org/show_bug.cgi?id=53706

 configure.ac | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

commit 61abcb61e8b8e988dd03cfd4553f29132a8ca38a
Author: Rob McMahon <Rob.McMahon@warwick.ac.uk>
Date:   2012-07-31

    Fix build on solaris
    
     * Conditional inclusion of the errno.h header
     * Link librt when appropriate for nanosleep
    
    https://bugs.freedesktop.org/show_bug.cgi?id=52261

 common/compat.h | 4 ++++
 configure.ac    | 4 +++-
 2 files changed, 7 insertions(+), 1 deletion(-)

commit 76180db6b326f8c87aef5b3eded9463432ce8d82
Author: Dan Winship <danw@gnome.org>
Date:   2012-07-27

    Always encode the "id" attribute in URIs
    
    Per recommendation of the spec.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=52606

 p11-kit/uri.c    | 24 ++++++++++++++----------
 tests/uri-test.c |  2 +-
 2 files changed, 15 insertions(+), 11 deletions(-)

commit c6fc7b3ac4c6d4595f17989cff220d6d6dafe620
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-17

    Initialize mutexes correctly in mock module
    
    https://bugzilla.gnome.org/show_bug.cgi?id=44740

 tests/mock-module-ep.c | 1 +
 tests/mock-module.c    | 6 +++++-
 2 files changed, 6 insertions(+), 1 deletion(-)

commit 1f428d62a13e481aa51d1fcee0c4652dc9ef7a72
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-17

    Fix warning on windows
    
    https://bugzilla.gnome.org/show_bug.cgi?id=44740

 tests/conf-test.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 542cb48951b7c4c21ca3669d07bf936b0fa58b42
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-17

    Don't rely on loading order for duplicate modules
    
     * We had relied on module 'two' loading before 'two-duplicate'
       in the conf tests. However this isn't always the case, and the
       name of the module can end up as 'two-duplicate'
    
    https://bugzilla.gnome.org/show_bug.cgi?id=44740

 tests/Makefile.am                            | 7 ++++++-
 tests/files/system-modules/four.module       | 3 +++
 tests/files/system-modules/two.badname       | 2 --
 tests/files/system-modules/win32/four.module | 3 +++
 tests/test-modules.c                         | 6 +++---
 5 files changed, 15 insertions(+), 6 deletions(-)

commit 06595e93ff57e97adbb313aebc50a2e32acd6039
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-17

    Use Windows thread ids instead of handles for comparisons
    
     * It seems that the HANDLE's returned from GetCurrentThread
       are often equal for two threads. GetCurrentThreadID doesn't
       have this problem.
     * Separate our cross platform thread_t and thread_id_t types
       even though on unix they're the same thing.
    
    https://bugzilla.gnome.org/show_bug.cgi?id=44740

 p11-kit/modules.c |  6 +++---
 p11-kit/util.h    | 11 ++++++++---
 2 files changed, 11 insertions(+), 6 deletions(-)

commit 356377709cd1de1308d9d8cf15f528578a360cf3
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-17

    Use correct shared library extension on windows
    
     * The windows shared libraries have the .dll extension
     * This means we also need separate directories for the test module
       configs on win32
    
    https://bugzilla.gnome.org/show_bug.cgi?id=44740

 configure.ac                                          |  4 ++++
 p11-kit/Makefile.am                                   | 14 ++++++++++++++
 tests/files/system-modules/win32/one.module           |  3 +++
 tests/files/system-modules/win32/two-duplicate.module |  3 +++
 tests/files/system-modules/win32/two.badname          |  5 +++++
 tests/files/user-modules/win32/one.module             |  2 ++
 tests/files/user-modules/win32/three.module           |  5 +++++
 tests/test-init.c                                     |  2 +-
 8 files changed, 37 insertions(+), 1 deletion(-)

commit f10d361a5b523ce7f9289ba8d45ccd847510d619
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-16

    Use '.module' extension on module configs
    
     * And want alphanumeric/_.- filenames
     * Currently this is just a warning, soon it will be enforced
     * The name of a module does not include the extension
    
    Andreas Metzler and Ubuntu both worked on this patch, and I've made
    some more changes.
    
    See https://bugs.launchpad.net/ubuntu/+source/p11-kit/+bug/911436
    
    https://bugs.freedesktop.org/show_bug.cgi?id=52158

 doc/p11-kit-config.xml                          |  7 +++-
 p11-kit/conf.c                                  | 56 +++++++++++++++++++++++--
 tests/conf-test.c                               | 23 ++++++----
 tests/files/system-modules/one                  |  3 --
 tests/files/system-modules/one.module           |  3 ++
 tests/files/system-modules/two                  |  5 ---
 tests/files/system-modules/two-duplicate        |  3 --
 tests/files/system-modules/two-duplicate.module |  3 ++
 tests/files/system-modules/two.badname          |  7 ++++
 tests/files/user-modules/one                    |  2 -
 tests/files/user-modules/one.module             |  2 +
 tests/files/user-modules/three                  |  5 ---
 tests/files/user-modules/three.module           |  5 +++
 tests/test-modules.c                            |  4 +-
 14 files changed, 95 insertions(+), 33 deletions(-)

commit c0251b132cad98318be0565f676b9fa92dd1b8b4
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-24

    Fix compiler warning about uninitialized variable

 p11-kit/modules.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 45c4936ba0d5e3de7813c47811b277bed1c71576
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-24

    Don't use strict aliasing during compilation
    
     * Due to the way in which we pass pointers of different types
       to _p11_hash_iter_next()

 configure.ac | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

commit 5cd198107374ff1879767679d29df0ce78f9427f
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-17

    Fix getprogname() running under wine
    
     * Wine uses normal slashes instead of backslashes on windows

 common/compat.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

commit d51914b6483b7ddc806ee3861084aa98ee97a7fb
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-17

    Use EFBIG as the error code when pin file is too large
    
     * The previous EOVERFLOW was not supported on mingw

 p11-kit/pin.c    | 2 +-
 tests/pin-test.c | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit 4a6a685c03bd92566c1656f1af3662ca7deecefa
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-16

    Don't define duplicate symbols
    
     * clang was giving a build failure here.

 tests/mock-module.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 023efacf30a7ae4ee5a76f909f973fa5058bb7b9
Author: Stef Walter <stefw@gnome.org>
Date:   2012-07-16

    Release version 0.13

 NEWS         | 14 ++++++++++++++
 configure.ac |  2 +-
 2 files changed, 15 insertions(+), 1 deletion(-)

commit 413ca6be40a4f9351f12030c791544edd5a52e16
Author: Stef Walter <stefw@gnome.org>
Date:   2012-06-29

    Don't allow reading of pin files larger than 4096 bytes
    
     * p11_kit_pin_file_callback() only returns pins up to 4096 bytes now

 p11-kit/pin.c                  | 19 +++++++++------
 tests/files/test-pinfile-large | 53 ++++++++++++++++++++++++++++++++++++++++++
 tests/pin-test.c               | 26 +++++++++++++++++++++
 3 files changed, 91 insertions(+), 7 deletions(-)

commit da2606bfbbdbd36d5e42bf2acf614735dfc515d2
Author: Stef Walter <stefw@gnome.org>
Date:   2012-06-29

    Win32 build fixes
    
     * Remove unused functions
     * Use getprogname() instead of calc_progname() which no longer exists
     * Fix up exporting of functions in the mock module

 common/compat.c        | 11 +++++++----
 configure.ac           |  2 ++
 p11-kit/util.c         | 26 --------------------------
 tests/mock-module-ep.c |  1 +
 4 files changed, 10 insertions(+), 30 deletions(-)

commit 89602ce99feb7e8c5a37634c3f577532f82eddbd
Author: Stef Walter <stefw@gnome.org>
Date:   2012-06-27

    tools: Don't barf when p11-kit -h

 tools/p11-kit.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 483db3ee5d0c0e92dd8ecd8bf0cbefaa6254b6eb
Author: Stef Walter <stefw@gnome.org>
Date:   2012-06-27

    If a module is not marked 'critical' then ignore failure
    
     * Ignore failure when initializing registered modules when
       'critical' is not set on a module.

 p11-kit/modules.c | 14 +++++++++++---
 1 file changed, 11 insertions(+), 3 deletions(-)

commit 59774b11eb478cc714a6c5da937e89c6089fd833
Author: Stef Walter <stefw@gnome.org>
Date:   2012-06-08

    Fix the flags in pin.h
    
     * Due to a brain fart the P11_KIT_PIN_* flags were not
       bit flags but decimal numbers.
     * This necessarily breaks API/ABI for users of the
       P11_KIT_PIN_FLAGS_RETRY, P11_KIT_PIN_FLAGS_MANY_TRIES and
       P11_KIT_PIN_FLAGS_FINAL_TRY flags. But those wouldn't have
       worked anyway.

 p11-kit/pin.h | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

commit caa953cba4d2d0cdd4823eb2f1c4f24bbf18a231
Author: Stef Walter <stefw@gnome.org>
Date:   2012-05-13

    Preconditions to check for input probs and out of memory
    
     * We don't try to guarantee completely robust and problem
       free behavior in cases where the caller or process isn't
       behaving. We consider these to be outside of our control.

 HACKING           |  31 ++++++++++++
 p11-kit/conf.c    |  76 +++++++++---------------------
 p11-kit/debug.c   |  19 ++++++++
 p11-kit/debug.h   |  30 ++++++++++++
 p11-kit/modules.c |  85 +++++++++++++++++----------------
 p11-kit/pin.c     | 138 ++++++++++++++++++++++++++----------------------------
 p11-kit/proxy.c   |  27 ++++-------
 p11-kit/uri.c     | 112 ++++++++++++++++++++------------------------
 p11-kit/uri.h     |   4 +-
 p11-kit/util.c    |   9 ----
 p11-kit/util.h    |   2 -
 tests/Makefile.am |   3 +-
 tests/test-init.c |  68 ++++++++++++++++++++++++++-
 tests/uri-test.c  |  12 ++++-
 14 files changed, 352 insertions(+), 264 deletions(-)

commit 7bd4114182fcc86cd2515708fdf4d76622e0237d
Author: Stef Walter <stefw@gnome.org>
Date:   2012-05-13

    Use gcc extensions to check varargs during compile
    
     * Add macros GNUC_PRINTF and GNUC_NULL_TERMINATED to check
       correct printf and NULL terminated style varargs

 common/compat.h   | 24 ++++++++++++++++++------
 p11-kit/conf.c    | 11 ++++++++---
 p11-kit/debug.h   |  4 +++-
 p11-kit/modules.c |  7 +++++--
 p11-kit/private.h |  4 +++-
 tests/Makefile.am |  1 +
 6 files changed, 38 insertions(+), 13 deletions(-)

commit 14b0be4353e5c4464cb9f61e419a2f8caf8757d0
Author: Stef Walter <stefw@gnome.org>
Date:   2012-05-01

    Fix test modules linking errors
    
     * And display warning messages in the debug output

 p11-kit/Makefile.am | 2 ++
 p11-kit/util.c      | 1 +
 2 files changed, 3 insertions(+)

commit fed549ee2049a318081cfce3fde01ae625263d98
Author: Stef Walter <stefw@gnome.org>
Date:   2012-05-01

    Provide compat getprogname() implementations on other OS's
    
     * And use them in our replacement err() and p11_kit_set_progname()

 common/compat.c     | 87 +++++++++++++++++++++++++++++++++++++++--------------
 common/compat.h     | 10 ++++--
 p11-kit/Makefile.am |  7 ++++-
 p11-kit/util.c      | 38 ++---------------------
 tools/Makefile.am   |  1 +
 tools/p11-kit.c     |  2 +-
 6 files changed, 81 insertions(+), 64 deletions(-)

commit a3bcb9037ddf6657f79f0aae42aa83dd2b8f6b14
Author: Stef Walter <stefw@gnome.org>
Date:   2012-04-30

    Move the compat.[ch] headers into common directory/
    
     * And the compat stuff in the p11-kit directory merged
       into util.c and util.h

 common/compat.c     | 228 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 common/compat.h     |  63 +++++++++++++++
 p11-kit/Makefile.am |   3 +-
 p11-kit/compat.c    | 114 --------------------------
 p11-kit/compat.h    | 149 ----------------------------------
 p11-kit/conf.c      |   2 +-
 p11-kit/debug.c     |   1 -
 p11-kit/private.h   |   2 +-
 p11-kit/util.c      |  66 +++++++++++++++
 p11-kit/util.h      | 111 +++++++++++++++++++++++++
 tests/mock-module.c |   2 +-
 tests/test-init.c   |   2 +-
 tools/Makefile.am   |   3 +-
 tools/compat.c      | 228 ----------------------------------------------------
 tools/compat.h      |  63 ---------------
 tools/p11-kit.c     |   4 +-
 16 files changed, 477 insertions(+), 564 deletions(-)

commit eeb40dccb63682367e03f52750355bf5951edff7
Author: Stef Walter <stefw@gnome.org>
Date:   2012-04-16

    Doc tweaks for PIN functionality

 p11-kit/pin.c | 47 ++++++++++++++++++++++++++++-------------------
 1 file changed, 28 insertions(+), 19 deletions(-)

commit 85f9d306832964f6d6412392f335e1fa3f3efd8b
Author: Stef Walter <stefw@gnome.org>
Date:   2012-04-02

    Add tests for enable-in and disable-in

 p11-kit/Makefile.am            |   8 +--
 p11-kit/modules.c              |   4 +-
 tests/Makefile.am              |   4 +-
 tests/conf-test.c              |  16 ++---
 tests/files/system-modules/two |   4 +-
 tests/files/system-pkcs11.conf |   3 +
 tests/files/user-modules/three |   4 +-
 tests/test-modules.c           | 156 ++++++++++++++++++++++++++++++++++++++---
 8 files changed, 171 insertions(+), 28 deletions(-)

commit d4c5661a695b5fc4a0126a4583e30ef70aea54ac
Author: Stef Walter <stefw@gnome.org>
Date:   2012-04-02

    Build some test modules for testing main p11-kit functionality
    
     * And put together a test for duplicate modules

 p11-kit/Makefile.am                      |  29 ++++++--
 tests/Makefile.am                        |  32 +++++++--
 tests/conf-test.c                        |  16 ++---
 tests/files/system-modules/one           |   2 +-
 tests/files/system-modules/two           |   2 +-
 tests/files/system-modules/two-duplicate |   3 +
 tests/files/user-modules/three           |   2 +-
 tests/mock-module-ep.c                   |  50 ++++++++++++++
 tests/test-modules.c                     | 111 +++++++++++++++++++++++++++++++
 9 files changed, 225 insertions(+), 22 deletions(-)

commit c43038d82edcfd878ff66e3aa7fe247f53876f9b
Author: Stef Walter <stefw@gnome.org>
Date:   2012-02-27

    Add more p11-kit cleanup to fix valgrind leak reports
    
     * per-thread memory isn't actually a real memory leak, but was
       still reachable after exit, so clean this up.

 p11-kit/util.c | 11 +++++++++++
 1 file changed, 11 insertions(+)

commit ff9926b8dcead91e7fc6d08d0ca1d2d8cc982308
Author: Stef Walter <stefw@gnome.org>
Date:   2012-04-01

    Fix crasher when a duplicate module is present

 p11-kit/modules.c | 13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

commit a899d9be0cab72dcfe00f100527c52ea598fed70
Author: Stef Walter <stefw@gnome.org>
Date:   2012-04-01

    Add enable-in and disable-in options to module config
    
     * These can be used to load certain modules in certain
       programs, or prevent loading in others.
     * Useful for a key manager like seahorse, so we can load
       extra modules (think NSS) that other modules shouldn't
       load.

 .gitignore               |   2 +
 configure.ac             |  12 ++++-
 doc/p11-kit-config.xml   |  27 +++++++++++
 doc/p11-kit-sections.txt |   1 +
 p11-kit/modules.c        |  75 ++++++++++++++++++++++++++++++-
 p11-kit/p11-kit.h        |   2 +
 p11-kit/private.h        |   4 ++
 p11-kit/util.c           | 115 ++++++++++++++++++++++++++++++++++++++++++++++-
 tests/Makefile.am        |   2 +
 tests/progname-test.c    | 110 +++++++++++++++++++++++++++++++++++++++++++++
 10 files changed, 346 insertions(+), 4 deletions(-)

commit af8d28014f97ab0d9e4d00961e72aefd7adb470b
Author: Stef Walter <stefw@gnome.org>
Date:   2012-03-27

    Fix broken hashmap behavior
    
     * We were relying on undefined gcc behavior related to the &
       operator.
     * This would show up as a test failure when running with -O2 on
       certain GCC versions, as well as failure on clang 3.1

 p11-kit/hashmap.c | 12 +++++-------
 tests/hash-test.c |  2 --
 2 files changed, 5 insertions(+), 9 deletions(-)

commit f40f63c2b608a399df431df366bf681e6b2bb20e
Author: Stef Walter <stefw@gnome.org>
Date:   2012-03-19

    Remove p11-kit.pot file from git
    
     * Generated automatically

 .gitignore     |   1 +
 po/p11-kit.pot | 343 ---------------------------------------------------------
 2 files changed, 1 insertion(+), 343 deletions(-)

commit bbd0c4dcde10197df1473ffc5641cafe2173a676
Author: Stef Walter <stefw@gnome.org>
Date:   2012-03-09

    Release version 0.12

 NEWS         | 3 +++
 configure.ac | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

commit 300c84133390363a543854e5cd0ac3dd9018544e
Author: Simon Josefsson <simon@josefsson.org>
Date:   2012-03-08

    Fix build problem due to pthread extensions usage
    
    See: http://ipozgaj.blogspot.com/2006/08/posix-threads-and-manual-pages-rant.htm

 configure.ac | 1 +
 1 file changed, 1 insertion(+)

commit 632e268fa86ad8ba55d34044ccc325c20c8fc0c7
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2012-02-07

    Release 0.11

 NEWS           | 3 +++
 configure.ac   | 2 +-
 po/p11-kit.pot | 4 ++--
 3 files changed, 6 insertions(+), 3 deletions(-)

commit 53c34e8ff80500d6ef9366453e88c27a3a52ee46
Author: Stef Walter <stefw@gnome.org>
Date:   2012-01-23

    Remove automatic reinitialization of PKCS#11 after fork
    
     * First of all one should only call async-signal-safe functions
       from the callbacks of pthread_atfork(), and so we cannot
       reinitialize directly.
     * Some modules use pthread_atfork() to detect forking and setup
       their internal state. If we call into them in our pthread_atfork()
       callback then this is inherently racy.
     * There was danger of endless loops and deadlocks which are caused
       by handlers which fork in their C_Initialize
     * Many processes do fork/exec, reinitializing PKCS#11 for these
       forks is quite resourc intensive when the child process won't use
       PKCS#11 at all.

 p11-kit/modules.c | 11 ++---------
 1 file changed, 2 insertions(+), 9 deletions(-)

commit 001d59596a37369d094edcace455f611d9f55908
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2012-01-03

    Release version 0.10

 NEWS         | 3 +++
 configure.ac | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

commit 049e556d043aa6ecfbf32a70dae6e7e5e8eb69d3
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2012-01-02

    Fix build warning on mingw64

 p11-kit/hashmap.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 83dcc15d1d97218004137769ff68e2e8119f1d80
Author: Andreas Metzler <ametzler@downhill.at.eu.org>
Date:   2011-12-23

    Compile CuTest.c separately.
    
    Use regular compile and link instead of having #include "CuTest.c" in
    every test. Works around gcc optimization issue.

 tests/Makefile.am      | 10 +++++++++-
 tests/conf-test.c      |  2 --
 tests/hash-test.c      |  2 --
 tests/pin-test.c       |  2 --
 tests/ptr-array-test.c |  2 --
 tests/test-init.c      |  2 --
 tests/uri-test.c       |  2 --
 7 files changed, 9 insertions(+), 13 deletions(-)

commit 2da833b0ca9539c12745d2f9fef1e7be7c7792dc
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-12-20

    Reorganize tests, work around optimization bug
    
     * Encountered a gcc optimization bug in gcc 4.6.1 which seems to
       be reordering related function calls eroneously. This bug seems
       to be fixed in 4.6.2.
     * Reorganize test code to get around this bug building on mingw,
       and ubuntu 11.10, both of which use gcc 4.6.1

 tests/hash-test.c | 45 ++++++++++++++++++++++-----------------------
 1 file changed, 22 insertions(+), 23 deletions(-)

commit 9328bb7f0aed047dea47e8674e19865d90d423a5
Author: Andreas Metzler <ametzler@downhill.at.eu.org>
Date:   2011-12-09

    Run tests correctly in automake
    
     * This allows failing tests to stop the build

 tests/Makefile.am | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

commit 336d8af58ea3d00a20a56937b11236a6bf2679dd
Author: Michael Cronenworth <mike@cchtml.com>
Date:   2011-11-25

    Build fix for MinGW w64

 p11-kit/compat.h | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

commit e18725f71e0f070a54d763cbba7797031828dd95
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-11-14

    Release version 0.9

 NEWS           | 6 ++++++
 configure.ac   | 2 +-
 po/p11-kit.pot | 4 ++--
 3 files changed, 9 insertions(+), 3 deletions(-)

commit d3dfc6968e54b919c90967a486d20066b0f5bf57
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-11-02

    Reduce autofoo dependencies
    
     * automake 1.10 (although can benefit from some 1.11 features)
     * autoconf 2.61

 configure.ac | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

commit 9ccc74f384ee100ec522e012ea543437b1df123c
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-11-01

    An intelligent error message when gettextize is not around

 autogen.sh | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 7370d64c18b795a63eda40efcc9e786b821cb7f7
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-30

    p11-kit can't be used as a static library
    
     * It just doesn't make sense.
     * The initialization refcounting in particular can only work as
       a shared library.

 configure.ac | 4 ++++
 1 file changed, 4 insertions(+)

commit df0ed92f44fa168c0d02866796f3707687f43214
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-29

    Fix problems crashing when freeing TLS on windows

 p11-kit/util.c | 2 ++
 1 file changed, 2 insertions(+)

commit 922d53016955c0ff2d6d830d726f0d1ea3a5804b
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-29

    Add debug output to windows init and uninit of library

 p11-kit/util.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

commit c940667c434fe64cf4d01cec0873044c54e7f174
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-29

    Make build not depend on gtk-doc or pkg-config
    
     * If enabled, gtk-doc can be used, but we no longer expect the
       gtkdoc autoconf/automake macro files to be installed.
     * pkg-config is no longer used for checks.
     * We still do install pkg-config files, and this is the preferred
       way to build against and link to p11-kit.

 configure.ac | 53 +++++++++++++++++++++++++++++++++++++++++++++++++++--
 1 file changed, 51 insertions(+), 2 deletions(-)

commit 0792fefb2bc9d5db038b48855f0b1bb138653332
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-29

    Handle build case when gettextize is not available or not installed

 autogen.sh | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

commit 969bcab592878322e410f4342a61fccc06b9addd
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-27

    Fix build with clang
    
     * Just removed some unused functions that used GNUC extensions

 tests/cutest/CuTest.c | 10 ----------
 tests/cutest/CuTest.h |  5 -----
 2 files changed, 15 deletions(-)

commit 77bab108dd2a7d1c55468cc991c22397fb5f8ba5
Author: Dr. Volker Zell <dr.volker.zell@oracle.com>
Date:   2011-10-25

    Fix broken build on cygwin and mingw
    
     * Add correct linking options for libintl

 p11-kit/Makefile.am | 2 ++
 1 file changed, 2 insertions(+)

commit 69f7eaa0508326f07832b91557f9e1ad8e6864c6
Author: Michael Cronenworth <mike@cchtml.com>
Date:   2011-10-25

    Fix broken build on windows
    
     * The debug_init() call needed a rename to _p11_debug_init() to match
       the non-Win32 code.

 p11-kit/util.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 190aee9cdf44d257333d7ef9e29113a07f1516c9
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-24

    Release version 0.8

 NEWS           | 7 +++++++
 configure.ac   | 2 +-
 po/p11-kit.pot | 4 ++--
 3 files changed, 10 insertions(+), 3 deletions(-)

commit 138c046a5ff1b0e532896b4d640c0cba6ead4027
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-24

    More fixes for non-static function names
    
     * See previous commit
     * Initialize library before debug statements

 p11-kit/conf.c    |  8 +++----
 p11-kit/debug.c   |  7 -------
 p11-kit/debug.h   | 16 +++++++-------
 p11-kit/modules.c | 62 +++++++++++++++++++++++++++----------------------------
 p11-kit/proxy.c   | 14 ++++++++-----
 p11-kit/uri.c     |  2 +-
 6 files changed, 53 insertions(+), 56 deletions(-)

commit 5507dc4946f0a68cece5ec9e7096e0f9b8c55984
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-24

    Rename non-static functions to have a _p11_xxx prefix.
    
     * Work around issues with brain-dead linkers not respecting
       the libtool -export-symbol-regex argument
    
    https://bugs.freedesktop.org/show_bug.cgi?id=42020

 p11-kit/compat.c       |   8 +--
 p11-kit/compat.h       |  48 +++++++--------
 p11-kit/conf.c         |  36 +++++------
 p11-kit/debug.c        |  17 +++---
 p11-kit/debug.h        |  12 ++--
 p11-kit/hashmap.c      |  68 +++++++++++++--------
 p11-kit/hashmap.h      |  63 +++++++++----------
 p11-kit/modules.c      | 110 ++++++++++++++++-----------------
 p11-kit/pin.c          |  40 ++++++------
 p11-kit/private.h      |   4 +-
 p11-kit/proxy.c        |  18 +++---
 p11-kit/ptr-array.c    |  28 +++++----
 p11-kit/ptr-array.h    |  14 ++---
 p11-kit/uri.c          |   2 +-
 p11-kit/util.c         |  12 ++--
 p11-kit/util.h         |   2 +-
 tests/conf-test.c      | 140 +++++++++++++++++++++---------------------
 tests/hash-test.c      | 162 ++++++++++++++++++++++++-------------------------
 tests/mock-module.c    |  10 +--
 tests/ptr-array-test.c | 122 ++++++++++++++++++-------------------
 tests/test-init.c      |  22 +++----
 tests/uri-test.c       |   5 +-
 22 files changed, 484 insertions(+), 459 deletions(-)

commit db92b76e3acb11e330309ebce071ec2e61400a71
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-17

    Initial port to win32
    
     * Tests do not all yet pass, at least not on wine
     * Added abstraction of some non-portable functions in compat.h/c
     * Build with an argument like this for win32 support:
    	./autogen.sh --host=i586-mingw32msvc
     * This win32 port needs more work from interested parties

 .gitignore          |   3 +
 configure.ac        |  35 ++++++--
 doc/Makefile.am     |   2 +-
 p11-kit/Makefile.am |   1 +
 p11-kit/compat.c    | 114 ++++++++++++++++++++++++++
 p11-kit/compat.h    | 143 ++++++++++++++++++++++++++++++++
 p11-kit/conf.c      |  64 ++++++++++-----
 p11-kit/debug.c     |  31 +++----
 p11-kit/debug.h     |   2 +
 p11-kit/modules.c   | 104 +++++++++++-------------
 p11-kit/private.h   |  40 +++++++--
 p11-kit/proxy.c     |   7 +-
 p11-kit/util.c      | 188 +++++++++++++++++++++++++++++++++++--------
 tests/Makefile.am   |  16 ++--
 tests/conf-test.c   |   2 +
 tests/mock-module.c |  20 +++--
 tests/mock-module.h |   1 +
 tests/pin-test.c    |   3 +
 tests/test-init.c   |  56 +++++++------
 tools/Makefile.am   |   4 +
 tools/compat.c      | 228 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 tools/compat.h      |  63 +++++++++++++++
 tools/p11-kit.c     |   5 +-
 23 files changed, 952 insertions(+), 180 deletions(-)

commit b1d9fd5f88ade222fbd2206c7e11c5514c8b5634
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-10

    Fix up the build options.
    
     * --enable-debug turns off optimization
     * --disable-debug turns off debugging output, debug symbols
     * --enable-strict turns on -Werror

 configure.ac | 123 ++++++++++++++++++++++++++++++++---------------------------
 1 file changed, 66 insertions(+), 57 deletions(-)

commit 73880f950a7dadf712730222ac1b6ea11400746f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-10

    Only call C_Initialize and C_Finalize once per module
    
     * Do not concurretnly call C_Initialize or C_Finalize in a module
     * The PKCS#11 spec indicates that mone thread should call those functions.
     * It's reasonable for a module to expect to only be initialized or
       finalized in one thread.
     * In particular NSS does not lock its C_Initialize or C_Finalize.

 p11-kit/modules.c   | 117 ++++++++++++++++++++++++++++------------------------
 tests/mock-module.c |   4 +-
 tests/test-init.c   | 105 +++++++++++++++++++++++++++++++++++++++++++++-
 3 files changed, 168 insertions(+), 58 deletions(-)

commit 630ce95d7b9ec3ac3cbe71f75910711369274314
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-10

    Combine initialization tests

 tests/Makefile.am      |  14 ++---
 tests/test-fork.c      | 114 ---------------------------------------
 tests/test-init.c      | 144 +++++++++++++++++++++++++++++++++++++++++++++++++
 tests/test-recursive.c |  98 ---------------------------------
 4 files changed, 148 insertions(+), 222 deletions(-)

commit d5a004ded8a0acdb7aa2100b8e116f19d0d9e402
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-10

    Don't allow recursive calling of C_Initialize on a given module.

 p11-kit/modules.c      |  9 ++++-
 tests/Makefile.am      | 10 ++++--
 tests/test-recursive.c | 98 ++++++++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 114 insertions(+), 3 deletions(-)

commit 591c1c14f2ebbcbc3f621456e31e2af1d26820b8
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-10-10

    Rename p11-kit test

 .gitignore        |   2 +
 tests/Makefile.am |   6 +--
 tests/p11-test.c  | 114 ------------------------------------------------------
 tests/test-fork.c | 114 ++++++++++++++++++++++++++++++++++++++++++++++++++++++
 4 files changed, 119 insertions(+), 117 deletions(-)

commit 85d9078be0456de8014a6f186f3916ddb01792d2
Author: Pino Toscano <pino@debian.org>
Date:   2011-09-30

    Don't use PATH_MAX unless its defined
    
     * Fixes build on GNU/Hurd
    
    https://bugs.freedesktop.org/show_bug.cgi?id=41303

 p11-kit/modules.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

commit 639aa9e38692ba5001987bb496e10cca14880807
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-09-28

    Print more information in 'p11-kit -l'

 tools/p11-kit.c | 92 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 92 insertions(+)

commit 67b52ed7d7f298f64be5ead41deeeebab1238d47
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-09-27

    Release 0.7

 NEWS           | 5 +++++
 configure.ac   | 2 +-
 po/p11-kit.pot | 4 ++--
 3 files changed, 8 insertions(+), 3 deletions(-)

commit d3e245f579d917d1393624b6ecf3ae0c3748bbb3
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-09-27

    Don't expand p11-kit config variables in configure.
    
     * Expand them later in Makefile and pkg-config file

 configure.ac | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

commit fcb71c3962314b48e9f8bd7f82673fa4e065607d
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-09-26

    Add test tool to print out error messages
    
     * Allows checking of translations

 .gitignore             |   1 +
 tests/Makefile.am      |   3 +-
 tests/print-messages.c | 137 +++++++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 140 insertions(+), 1 deletion(-)

commit a1cc80045864777db8c77e711f0a8efaad949c3e
Author: Andreas Metzler <ametzler@downhill.at.eu.org>
Date:   2011-09-26

    Fix quoting of build variables
    
    https://bugs.freedesktop.org/show_bug.cgi?id=40985

 p11-kit/Makefile.am | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

commit a081b6652acc9d9a9af22a266f9175f689b8c5d1
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-09-19

    Expand the libdir path correctly
    
    https://bugs.freedesktop.org/show_bug.cgi?id=40985

 configure.ac        | 6 ------
 p11-kit/Makefile.am | 9 ++++++++-
 2 files changed, 8 insertions(+), 7 deletions(-)

commit 8054865325fdb2221f3e425d04d9e03f6475553e
Author: Roman Bogorodskiy <bogorodskiy@gmail.com>
Date:   2011-09-15

    Add #include <limits.h> for PATH_MAX to fix compilation on FreeBSD.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=40923

 p11-kit/modules.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

commit 67dc760cec1653e9571b7c4e2bada3992c2b8361
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-09-14

    Release version 0.6

 NEWS           | 5 +++++
 configure.ac   | 2 +-
 po/p11-kit.pot | 4 ++--
 3 files changed, 8 insertions(+), 3 deletions(-)

commit 11f3f0effb14be788e320d2f75b0d2d769058966
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-09-14

    Add documentation about the configuration paths
    
     * Default module path
     * How to lookup paths using pkg-config

 doc/p11-kit-config.xml | 37 ++++++++++++++++++++++---------------
 doc/p11-kit-docs.sgml  |  1 +
 doc/p11-kit-notes.xml  | 48 ++++++++++++++++++++++++++++++++++++++++++++++++
 doc/p11-kit.xml        |  3 +++
 doc/style.css          |  2 ++
 5 files changed, 76 insertions(+), 15 deletions(-)

commit 927d2e5927ddad1eafe94c0bcadd76cd73d6297a
Author: Kalev Lember <kalevlember@gmail.com>
Date:   2011-09-14

    When a module has a relative path, load it from $libdir/pkcs11
    
    So far we have only supported full paths to the pkcs11 modules in config
    files. This change adds relative path support, so that for modules
    installed under the standard $libdir/pkcs11, the config file won't have
    to spell out the full path.

 configure.ac            |  9 ++++++++
 p11-kit/modules.c       | 61 ++++++++++++++++++++++++++++++++++++++++++++++---
 p11-kit/p11-kit-1.pc.in |  1 +
 3 files changed, 68 insertions(+), 3 deletions(-)

commit 138c1efa9af4893536fb7c3a90d3cb1ac24cea89
Author: Kalev Lember <kalevlember@gmail.com>
Date:   2011-09-14

    Rename pkgconfig configuration directory variables
    
    Renamed them to reduce ambiguity and to pave the way for exposing
    some additional parameters.
    
    p11_system_modules -> p11_system_config_modules
    p11_user_modules   -> p11_user_config_modules
    
    configure --with-pkcs11-dir
    =>
    configure --with-system-config

 configure.ac                   | 50 ++++++++++++++++++++++--------------------
 p11-kit/Makefile.am            |  2 +-
 p11-kit/modules.c              |  5 +++--
 p11-kit/p11-kit-1.pc.in        | 10 +++++----
 p11-kit/pkcs11.conf.example.in |  2 +-
 5 files changed, 37 insertions(+), 32 deletions(-)

commit 1cecad87a968ab6441b020fafb95f991b97e84b3
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-31

    Release version 0.5

 NEWS           | 5 +++++
 configure.ac   | 2 +-
 po/p11-kit.pot | 4 ++--
 3 files changed, 8 insertions(+), 3 deletions(-)

commit e06009c33616d07a0687d0adbb5c59ec1c8965af
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-30

    Don't crash if p11_kit_registered_modules() called after failed init

 p11-kit/modules.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

commit fbdb10edfa39ada801af187dd3abaa5c8bf2ae6b
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-30

    Remove useless typedef

 p11-kit/conf.h | 2 --
 1 file changed, 2 deletions(-)

commit 21b64c68e6a5ffcae50f3561f6dec6ee943a006f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-30

    Add 'critical' setting for modules
    
     * When a module has critical set to 'yes', and that module fails to init
       then it aborts the entire init process.
     * Defaults to 'no'

 doc/p11-kit-config.xml | 24 ++++++++++++++++++++++--
 p11-kit/conf.c         | 18 ++++++++++++++++++
 p11-kit/conf.h         |  3 +++
 p11-kit/modules.c      |  7 ++++++-
 4 files changed, 49 insertions(+), 3 deletions(-)

commit 25512ca5a03d723a84d6de67a7036188d08ec21b
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-24

    Fix bugs in the p11-kit proxy module.
    
     * Initialize the mappings properly
     * Lookup session handles correctly
     * Debug initialization and finalization

 p11-kit/debug.c |  1 +
 p11-kit/debug.h |  3 ++-
 p11-kit/proxy.c | 42 ++++++++++++++++++++++++++++--------------
 3 files changed, 31 insertions(+), 15 deletions(-)

commit 61c925fda7385392b3961f0b44049b9ff7a68093
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-19

    Release version 0.4

 NEWS           | 8 ++++++++
 configure.ac   | 2 +-
 po/p11-kit.pot | 4 ++--
 3 files changed, 11 insertions(+), 3 deletions(-)

commit ae95625311e98caa3cccf82d24a3b612df11b26d
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-19

    Ignore spaces in PKCS#11 URIs
    
     * These should be able to occur anywhere and should be ignored
       according to RFC 3986. This is documented in the PKCS#11 URI
       specification.

 p11-kit/uri.c    | 85 ++++++++++++++++++++++++++++++++++++++++++--------------
 p11-kit/uri.h    |  4 +--
 tests/uri-test.c | 24 ++++++++++++++++
 3 files changed, 90 insertions(+), 23 deletions(-)

commit d4abb441450deceff760086dcdf9d493b258074a
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-14

    Fix endless loop if module forks during initialization.
    
     * If a module forks during its C_Initialize, previously our
       fork handler would try to initialize it again, ad nauseum.
    
    Reported by Nikos on the mailing list.

 .gitignore          |   1 +
 p11-kit/modules.c   |  12 +-
 tests/Makefile.am   |  30 +-
 tests/mock-module.c | 886 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 tests/mock-module.h | 336 ++++++++++++++++++++
 tests/p11-test.c    | 114 +++++++
 6 files changed, 1354 insertions(+), 25 deletions(-)

commit 43169c520292397439bd70fb74e9505d371f7c72
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-14

    Safer initialization of individually initialized module.
    
     * More checks for out of memory.
     * Take more of the same code paths when initializing a single
       module as when initializing registered, or loading from file.
     * Cleanup halfway initialized globals if fail during init.

 p11-kit/modules.c | 36 ++++++++++++++++++++++++++++++------
 1 file changed, 30 insertions(+), 6 deletions(-)

commit 1e2011a308500632a9fbfb541dafcd73d796f3d5
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-05

    Update PKCS#11 URI code for new draft of spec
    
     * pinfile attribute was renamed to pin-source
     * objecttype attribute was renamed to object-type
     * secretkey value was renamed to secret-key
    
    We continue to support parsing the old attribute names and values but
    generate URIs with the new ones.

 doc/Makefile.am          |   2 +-
 doc/p11-kit-sections.txt |   2 +
 p11-kit/pin.c            | 126 +++++++++++++++++++++++------------------------
 p11-kit/pin.h            |  10 ++--
 p11-kit/uri.c            |  83 +++++++++++++++++++++----------
 p11-kit/uri.h            |   9 ++++
 tests/pin-test.c         |  38 +++++++-------
 tests/uri-test.c         |  60 +++++++++++-----------
 8 files changed, 185 insertions(+), 145 deletions(-)

commit 0a2fd044770d645b7707d2b4926a3214147973a8
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-03

    Don't fail when duplicate modules are configured.
    
     * Duplicate modules may be caused by editor backups, misconfigurations
       or a multitude of other sources. Failing dead is a bit harsh.
     * After discussing gnutls needs with Nikos

 p11-kit/modules.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 3b78f626872c637339a3302b8f0607c778aef92c
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-03

    Better debug output for initialization and loading modules.

 p11-kit/modules.c | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

commit ca48cb81f8e1465fdc4e4b504ea9da0324b30658
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-03

    Fix broken debug arguments

 p11-kit/modules.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit e938d137fee800605b5c11d0c2aa6eae90e205eb
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-08-01

    Add example configuration documentation.
    
     * And also install example pkcs11.conf file.

 .gitignore                     |  1 +
 configure.ac                   |  7 ++++--
 doc/p11-kit-config.xml         | 48 ++++++++++++++++++++++++++++++++++++++++++
 p11-kit/Makefile.am            |  6 +++++-
 p11-kit/pkcs11.conf.example.in |  9 ++++++++
 5 files changed, 68 insertions(+), 3 deletions(-)

commit dd6b2c11794a74a33bfa53fec9892cb0c7007e80
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-29

    Release version 0.3

 NEWS   | 5 +++++
 README | 9 ++++++++-
 2 files changed, 13 insertions(+), 1 deletion(-)

commit 24d5da1bfa82e296872ae1ef62dbc073780edf20
Author: Roman Bogorodskiy <bogorodskiy@gmail.com>
Date:   2011-07-28

    Fix building with NLS enabled.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=39622

 tests/Makefile.am | 17 +++++++++++------
 tools/Makefile.am |  3 ++-
 2 files changed, 13 insertions(+), 7 deletions(-)

commit 8f4923bcaa66809aa247859b48f2d67d8950097e
Author: Roman Bogorodskiy <bogorodskiy@gmail.com>
Date:   2011-07-28

    Use AC_SEARCH_LIBS instead of AC_CHECK_LIB for dlopen() to fix on *BSD.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=39622

 configure.ac | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit b1b63063e0da8518e89b485bc4d2827ba2e3fdcf
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-28

    Make p11-kit-proxy.so link point to libp11-kit.so.0.0.0
    
     * The link now points to the actual library, rather than to
       another link.
    
    https://bugzilla.redhat.com/show_bug.cgi?id=725905

 p11-kit/Makefile.am | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit daec3faa85c4f463e3b13688f2bc2bbd1b2ae106
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-27

    Add libtool style versioning variables to p11-kit

 configure.ac        | 16 ++++++++++++++++
 p11-kit/Makefile.am |  4 +++-
 po/p11-kit.pot      |  4 ++--
 3 files changed, 21 insertions(+), 3 deletions(-)

commit fb0952dbeb607542b7feab80b1bbd2b1258cd15f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-27

    Fix bug in hashtable rewrite.
    
     * Initialization mixup.

 p11-kit/hashmap.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 9add486d5bbb2ac6a3566e21d729107c26de77a3
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-27

    Cleanup documentation warnings
    
     * After recent hash table rewrite we should be ignoring the new
       file.

 doc/Makefile.am | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

commit 4454fc36a0dd9b6e99e302769084b2964eef34c1
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-27

    Create a link for the proxy module.
    
     * Install proxy module at its own path which is not prefixed by 'lib'
     * Since the proxy module is the same as the library, and actually
       needs to be loaded as the same library in memory (due to resource
       tracking per process), use a symlink for proxy.
     * Add a variable to the pkg-config file which shows the path
       to the proxy module. ie:
       $ pkg-config --variable=proxy_module p11-kit-1
    
    https://bugzilla.redhat.com/show_bug.cgi?id=725905

 p11-kit/Makefile.am     | 6 +++++-
 p11-kit/p11-kit-1.pc.in | 1 +
 2 files changed, 6 insertions(+), 1 deletion(-)

commit 308a776372eb1560480fbfcb5ef9d918a7a1454f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-27

    Reimplement and remove apache licensed bits of code.
    
     * Reimplement the various bits of the hash table that were
       still based on the apache apr code. Use different algorithms
       for hashing, lookup and other stuff.
     * Use this as an opportunity to cleanup that code and make
       it more legible.
    
    https://bugzilla.redhat.com/show_bug.cgi?id=725905

 COPYING             |  22 +--
 p11-kit/Makefile.am |   2 +-
 p11-kit/conf.c      |  50 +++---
 p11-kit/conf.h      |  12 +-
 p11-kit/hash.c      | 473 ----------------------------------------------------
 p11-kit/hash.h      | 195 ----------------------
 p11-kit/hashmap.c   | 372 +++++++++++++++++++++++++++++++++++++++++
 p11-kit/hashmap.h   | 172 +++++++++++++++++++
 p11-kit/modules.c   |  62 +++----
 p11-kit/pin.c       |   6 +-
 p11-kit/proxy.c     |   8 +-
 tests/conf-test.c   |  64 +++----
 tests/hash-test.c   | 158 +++++++++---------
 13 files changed, 726 insertions(+), 870 deletions(-)

commit 3bb86b72ca5882b1e5684db837c75df810f283c3
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-21

    Expand the various pkcs11 config paths properly.
    
     * Without this the ${prefix} part of the variable wasn't being
       expanded and was making it into the #define.

 configure.ac | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

commit 4a3a1e0b8ad676f057e4fb141b4692987e8ce558
Author: Colin Walters <walters@verbum.org>
Date:   2011-07-18

    configure: Use $sysconfdir for p11_system_conf dir, not hardcoded /etc
    
    If the user specified sysconfdir, we should respect it.  Don't
    hardcode /etc.  This is important for jhbuild, which uses
    /path/to/builddir/etc.

 configure.ac | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 43cf13e1a25da76297cd3397569031d7c3fd3a09
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-19

    Ignore some built files after recent changes.

 .gitignore | 2 ++
 m4/.empty  | 1 +
 m4/empty   | 1 -
 3 files changed, 3 insertions(+), 1 deletion(-)

commit b59ab92e640e13d10484fffc74ed6a218930c6ab
Author: Colin Walters <walters@verbum.org>
Date:   2011-07-18

    build: Make autogen.sh work
    
    * We were missing a call to gettextize, which is what copies in config.rpath
    * Delete ABOUT-NLS, it is copied in by gettextize
    * While we're here, take a page from gtk+'s autogen.sh and just use autoreconf,
      instead of specifying everything.
    * We need to always have an m4/ directory, so that gettextize works,
      so we make a dummy empty file
    * Apparently gettextize is totally insane, requiring user input etc.  Copy
      in some hacks from Avahi's autogen.sh to work around this.

 .gitignore |    1 -
 ABOUT-NLS  | 1281 ------------------------------------------------------------
 autogen.sh |   17 +-
 m4/empty   |    1 +
 4 files changed, 12 insertions(+), 1288 deletions(-)

commit 69dd8b722bcb1a76ff586e71c580f6844412abb9
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-12

    pin: Fix uninitialized variable

 p11-kit/pin.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 087a815b2b9cd5e0ec44866be1ddddb948583e88
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-07

    Bump version number, and tweak upload procedure

 .gitignore   | 1 +
 Makefile.am  | 3 ++-
 configure.ac | 2 +-
 3 files changed, 4 insertions(+), 2 deletions(-)

commit e27e943b83401515b8b6acc1da705df6c56416e1
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-07

    Release version 0.2

 NEWS           | 6 ++++++
 configure.ac   | 2 +-
 po/p11-kit.pot | 2 +-
 3 files changed, 8 insertions(+), 2 deletions(-)

commit 98ba6f9ffb95c5473e5e32d296956e91c4fc2715
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-06

    List labels of all tokens in 'p11-kit -l'

 tools/p11-kit.c | 34 ++++++++++++++++++++++++++++++++--
 1 file changed, 32 insertions(+), 2 deletions(-)

commit 883b3ee76c686d14bbc1f20b0805d733a0c227ad
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-07-06

    More fine tuning of the pin APIs.

 doc/p11-kit-sections.txt |  1 +
 p11-kit/pin.c            | 18 ++++++++++++++++--
 p11-kit/pin.h            |  4 +++-
 3 files changed, 20 insertions(+), 3 deletions(-)

commit 1ff1a4895b2d5ff5fe559b96034fb1c3855d4b45
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-24

    Add documentation for PIN callbacks.

 doc/Makefile.am          |   2 +-
 doc/p11-kit-docs.sgml    |   1 +
 doc/p11-kit-sections.txt |  19 +++
 p11-kit/pin.c            | 328 +++++++++++++++++++++++++++++++++++++----------
 p11-kit/pin.h            |   4 +-
 tests/pin-test.c         |  18 +--
 6 files changed, 295 insertions(+), 77 deletions(-)

commit fd7dee836d0b14efc48bf59955c8a12a72561043
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-24

    Add P11KitPin structure, which encapsulates a returned pin.
    
     * Lets us use variable size buffers.
     * Helps minimize copying.

 p11-kit/pin.c            | 171 +++++++++++++++++++++++++++++++++++++++++++----
 p11-kit/pin.h            |  44 ++++++++----
 tests/files/test-pinfile |   1 +
 tests/pin-test.c         | 161 ++++++++++++++++++++++++++++++--------------
 4 files changed, 302 insertions(+), 75 deletions(-)

commit 2cc2ab90a6b96ea75dfe4d6413e41539075e8f8a
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-21

    Rename p11_kit_pin_read_pinfile to p11_kit_pin_retrieve
    
     * Fix up duplicate register logic as well.

 p11-kit/pin.c    | 13 +++++++------
 p11-kit/pin.h    |  4 ++--
 tests/pin-test.c | 38 +++++++++++++++++++-------------------
 3 files changed, 28 insertions(+), 27 deletions(-)

commit f1ca5d5b57909534d8b21f9be455c94ca57e6636
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-20

    Implement support for registering and calling pinfile callbacks
    
     * These are callbacks that hanlde the pinfile part of a PKCS#11 URI.
     * One library can register a callback that another can then call
       in a thread-safe and simple fashion.

 .gitignore             |   2 +
 p11-kit/Makefile.am    |   3 +
 p11-kit/pin.c          | 332 +++++++++++++++++++++++++++++++++++++++++++++++++
 p11-kit/pin.h          |  85 +++++++++++++
 p11-kit/ptr-array.c    | 150 ++++++++++++++++++++++
 p11-kit/ptr-array.h    |  61 +++++++++
 tests/Makefile.am      |  12 +-
 tests/pin-test.c       | 237 +++++++++++++++++++++++++++++++++++
 tests/ptr-array-test.c | 259 ++++++++++++++++++++++++++++++++++++++
 9 files changed, 1140 insertions(+), 1 deletion(-)

commit 0a793a9e462727f434f6283a712b37ab30df5e95
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-16

    Fix logic error loading registered modules.
    
    Thanks to Richard Bellgrim.

 p11-kit/modules.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit b1b62f1b0856821d046ed92be076f9b9f8c664a9
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-09

    Update pkcs11.h with PKCS#11 2.20 ammendments.

 p11-kit/pkcs11.h | 22 +++++++++++++++++++---
 1 file changed, 19 insertions(+), 3 deletions(-)

commit 6d36c108a0f00f7485967b528b2a9f7c22173a5b
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-09

    Fixed typos and made options clearer.

 doc/p11-kit-config.xml | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

commit d941244aaf0cf142fee986eb914c2767f564dc14
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-09

    By default use /etc/pkcs11 for system configs and not ${prefix}
    
     * Packagers can override this with the --with-pkcs11-dir configure arg.

 configure.ac | 17 +++++++++++++++--
 1 file changed, 15 insertions(+), 2 deletions(-)

commit 4bb63ced295ddd64a019ae49cfae191524a34f07
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-09

    Complete documentation for message functionality.

 doc/p11-kit-docs.sgml    |  1 +
 doc/p11-kit-sections.txt |  6 ++++++
 p11-kit/modules.c        | 15 +++++++++++++++
 p11-kit/util.c           | 29 +++++++++++++++++++++++++++++
 4 files changed, 51 insertions(+)

commit d6463e70eeb0ad3d93788a3e0f13e2007be54c50
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-09

    Complete testing of global config files and directories.

 tests/conf-test.c                    | 262 +++++++++++++++++++++++++++++++++++
 tests/files/system-modules/one       |   3 +
 tests/files/system-modules/two       |   3 +
 tests/files/test-system-invalid.conf |   3 +
 tests/files/test-system-merge.conf   |   7 +
 tests/files/test-system-none.conf    |   8 ++
 tests/files/test-system-only.conf    |   8 ++
 tests/files/test-user-invalid.conf   |   3 +
 tests/files/test-user-only.conf      |   4 +
 tests/files/test-user.conf           |   3 +
 tests/files/user-modules/one         |   2 +
 tests/files/user-modules/three       |   3 +
 12 files changed, 309 insertions(+)

commit 48a08272bfcc0153887b850b4ea82e8fb7d8f1ae
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-09

    Store last failure message per thread.
    
     * Add p11_kit_message() function to get last message.

 doc/p11-kit-config.xml |  2 +-
 p11-kit/Makefile.am    |  3 +-
 p11-kit/conf.c         | 22 +++++++------
 p11-kit/modules.c      | 46 +++++++++++++++++++-------
 p11-kit/p11-kit.h      |  8 +++++
 p11-kit/private.h      |  6 ++--
 p11-kit/util.c         | 87 +++++++++++++++++++++++++++++++++++++++++++++++---
 tests/Makefile.am      |  3 +-
 tests/conf-test.c      | 13 ++++----
 9 files changed, 151 insertions(+), 39 deletions(-)

commit 21333019a5afceb5f07637fb50b784a4ecd9f9ff
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-08

    Refactor configuration
    
     * Move configuration loading into conf.c
     * Have user modules with same name merge/override modules in system.

 p11-kit/Makefile.am |   2 +-
 p11-kit/conf.c      | 429 +++++++++++++++++++++++++++++++++++++++++++++++-----
 p11-kit/conf.h      |  24 ++-
 p11-kit/hash.c      | 117 ++++++++------
 p11-kit/hash.h      |  10 +-
 p11-kit/modules.c   | 366 ++++++++------------------------------------
 p11-kit/private.h   |  11 ++
 p11-kit/util.c      |  17 +++
 tests/conf-test.c   |  40 +++--
 9 files changed, 610 insertions(+), 406 deletions(-)

commit 7c1edab7e6c1c6939ecdeaefc5f006772298f9eb
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-08

    Ignore files without a 'module' value.
    
     * Just skip loading these.

 p11-kit/modules.c | 11 ++++-------
 1 file changed, 4 insertions(+), 7 deletions(-)

commit d6b8300fe9bae0595aaf894c5d98aa7c72209e38
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Bump version number.

 configure.ac   | 6 +++++-
 po/p11-kit.pot | 4 ++--
 2 files changed, 7 insertions(+), 3 deletions(-)

commit 5b77fb058c43e6b0b631e1c7df41994cc41cd2ac
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Make target for uploading release.

 Makefile.am | 3 +++
 1 file changed, 3 insertions(+)

commit bfac05a80d66668a617386e7fdf569b5eb381a93
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Release version 0.1

 p11-kit/Makefile.am | 3 +++
 po/p11-kit.pot      | 5 +++--
 2 files changed, 6 insertions(+), 2 deletions(-)

commit cab38f1cb262e7922098fdb03c2c5828f5f003a1
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Fix up documentation

 doc/p11-kit-sections.txt |  5 ++++-
 p11-kit/util.c           | 41 +++++++++++++++++++++++++++++++++++++++++
 2 files changed, 45 insertions(+), 1 deletion(-)

commit b9a8a140cf09780671402e872130a51ec4f4b014
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Add p11_kit_space_strdup() function, and rename p11_kit_space_strlen()
    
     * Print out module info in p11-kit tool.

 p11-kit/p11-kit.h |  6 ++++++
 p11-kit/uri.c     | 15 ++-------------
 p11-kit/uri.h     |  3 ---
 p11-kit/util.c    | 34 ++++++++++++++++++++++++++++++++++
 tools/p11-kit.c   | 28 +++++++++++++++++++++++++++-
 5 files changed, 69 insertions(+), 17 deletions(-)

commit b315f99c90d01104d6baa91ca0f2cfb32c920abd
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Fix more memory errors and leaks in module code.

 p11-kit/modules.c | 16 ++++++++++++----
 tools/p11-kit.c   |  3 +++
 2 files changed, 15 insertions(+), 4 deletions(-)

commit 7f5d2e9471872d8c1cf7181ba647c1dc74e2c6dd
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Free string output of conf-test

 tests/conf-test.c | 1 +
 1 file changed, 1 insertion(+)

commit fb8b8cada7bad73acf936c1dee2e7b1be64e3513
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Fix URI parsing memory leaks.

 p11-kit/uri.c    | 1 +
 tests/uri-test.c | 1 +
 2 files changed, 2 insertions(+)

commit 7c410200143b72a5976d228d75aab59f8b965fe9
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Fix some hash leaks and bugs.

 p11-kit/hash.c    | 20 ++++++++++++--------
 tests/hash-test.c | 39 +++++++++++++++++++++++++++++++++++++--
 2 files changed, 49 insertions(+), 10 deletions(-)

commit 0f09803ba95bcdfebf4bde509b43b3ca52cd9d3f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Fix compiler warnings.

 p11-kit/hash.c   | 2 +-
 tests/uri-test.c | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

commit a5d3e34397d847a0c9b2e3aab7bd9f0b1080af05
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-07

    Remove unstable API markers.

 p11-kit/Makefile.am | 3 ---
 p11-kit/p11-kit.h   | 9 ---------
 p11-kit/uri.h       | 9 ---------
 tests/Makefile.am   | 3 +--
 tools/Makefile.am   | 3 +--
 5 files changed, 2 insertions(+), 25 deletions(-)

commit edf0b9584f1038797758b4ed878e1d9f48beda9f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-06-06

    Modernize autotools setup.

 .gitignore   |  1 +
 configure.ac | 13 ++++++-------
 2 files changed, 7 insertions(+), 7 deletions(-)

commit 0bd6cf376133f300edff57835eb95f7577d68792
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-30

    Clear correct block of memory in p11_kit_uri_parse().

 p11-kit/uri.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 6f1e963901ca7aff7af6bec376af00f892cbb9ca
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-30

    GNU style definitions in uri.h as well as normal.

 p11-kit/uri.h | 26 ++++++++++++++------------
 1 file changed, 14 insertions(+), 12 deletions(-)

commit 82ca953733a651216125608d5ca7f9aa8005095e
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-30

    Cleanup URI types
    
     * Support with/without library version.
     * Make names of types clearer.

 p11-kit/uri.c    | 63 ++++++++++++++++++++++++++++++------------
 p11-kit/uri.h    | 18 +++++++++---
 tests/uri-test.c | 84 ++++++++++++++++++++++++++++----------------------------
 3 files changed, 101 insertions(+), 64 deletions(-)

commit e19300129d3fe21c9e3af1a7f95ccf3eb5315199
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-30

    Set the return value properly in p11_kit_load_initialize_module()

 p11-kit/modules.c | 3 +++
 1 file changed, 3 insertions(+)

commit b3b68fcb1d3fc4958acc6f6528fb88e7c87b7512
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-30

    Add function p11_kit_uri_space_strlen() for figuring out the length
    of space terminated strings.

 doc/p11-kit-sections.txt | 1 +
 p11-kit/uri.c            | 6 +++---
 p11-kit/uri.h            | 3 +++
 3 files changed, 7 insertions(+), 3 deletions(-)

commit 2aa964160a1615077db18b03a6c72c286c27791f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-30

    Allow use with CRYPTOKI_GNU style use of PKCS#11

 doc/p11-kit-sections.txt | 10 +++++++++-
 p11-kit/p11-kit.h        | 11 ++++++++++-
 p11-kit/uri.c            |  2 +-
 p11-kit/uri.h            | 14 +++++++++++++-
 4 files changed, 33 insertions(+), 4 deletions(-)

commit cfeaf3de3d745d457feaba48c532d7a384d67341
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-27

    Add p11_kit_load_initialize_module() function.
    
     * This function will load a module from a file path, and then
       initialize it.

 doc/p11-kit-sections.txt |   1 +
 p11-kit/modules.c        | 167 ++++++++++++++++++++++++++++++++++++++++-------
 p11-kit/p11-kit.h        |   3 +
 3 files changed, 147 insertions(+), 24 deletions(-)

commit f03252bf032b04ed7a5b98ea52e3c75d84dc0812
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-27

    Rename module arguments from 'funcs' to 'module'

 p11-kit/modules.c | 244 +++++++++++++++++++++++++++---------------------------
 p11-kit/p11-kit.h |   8 +-
 2 files changed, 126 insertions(+), 126 deletions(-)

commit 5d697e5ff8e3222bdb67d0ce8444b0323eeaba69
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-27

    Fix up documentation

 doc/p11-kit-sections.txt | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

commit a2fbdb1a3cd9d137010182be43fdf4ff8491dd9f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-27

    Fix problems with 'make distcheck'

 Makefile.am       | 4 ++++
 doc/Makefile.am   | 3 ++-
 gtk-doc.make      | 9 +++++----
 tests/Makefile.am | 8 ++++++--
 4 files changed, 17 insertions(+), 7 deletions(-)

commit ad14c9c4c1345fe01336fc0d5bfccd3fca248ce1
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-27

    Fix uninitialized variable problem.

 p11-kit/proxy.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit bdd6188e299405e16179906bc79f9fef2605176a
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-27

    Change around installation of headers, pkg-config, and file names
    
     * Install headers to ${prefix}/include/p11-kit-1/p11-kit/
     * This solves problems with other projects that have their own
       pkcs11.h files.
     * Change the pkg-config file name to p11-kit-1.pc
     * Change the source file names.

 .gitignore                 |    6 +-
 configure.ac               |    4 +-
 doc/Makefile.am            |    4 +-
 p11-kit/Makefile.am        |   18 +-
 p11-kit/debug.h            |    4 +-
 p11-kit/messages.c         |  242 ++++++++
 p11-kit/modules.c          | 1195 ++++++++++++++++++++++++++++++++++++++
 p11-kit/p11-kit-1.pc.in    |   17 +
 p11-kit/p11-kit-lib.c      | 1195 --------------------------------------
 p11-kit/p11-kit-messages.c |  242 --------
 p11-kit/p11-kit-private.h  |   52 --
 p11-kit/p11-kit-proxy.c    | 1382 --------------------------------------------
 p11-kit/p11-kit-uri.c      | 1337 ------------------------------------------
 p11-kit/p11-kit-uri.h      |  135 -----
 p11-kit/p11-kit.h          |    2 +-
 p11-kit/p11-kit.pc         |   17 -
 p11-kit/p11-kit.pc.in      |   17 -
 p11-kit/private.h          |   52 ++
 p11-kit/proxy.c            | 1382 ++++++++++++++++++++++++++++++++++++++++++++
 p11-kit/uri.c              | 1337 ++++++++++++++++++++++++++++++++++++++++++
 p11-kit/uri.h              |  135 +++++
 po/POTFILES.in             |    2 +-
 po/p11-kit.pot             |  164 +++---
 tests/uri-test.c           |    2 +-
 24 files changed, 4465 insertions(+), 4478 deletions(-)

commit 92f821b6883e700a97a18d244104dea1031f2dce
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-26

    Add functions for clearing and setting multiple attributes on URI.

 p11-kit/p11-kit-uri.c | 75 ++++++++++++++++++++++++++++++++++++---------------
 p11-kit/p11-kit-uri.h | 12 ++++++---
 tests/uri-test.c      | 41 +++++++++++++++++++++++++---
 3 files changed, 100 insertions(+), 28 deletions(-)

commit c37d5dfaf0c2a5e70066fd1c9606b00329c3622a
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-26

    Return proper errors when NULL is passed to mutex functions.

 p11-kit/p11-kit-lib.c | 12 ++++++++++++
 1 file changed, 12 insertions(+)

commit 0542a87afdacd2c53da5d453b1d23e8a0dd91ea4
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-26

    URI API fine tuning
    
     * Rework API for getting all the attributes, to match usage in PKCS#11
     * Add support for pinfile argument in URIs.
     * Complete tests.

 p11-kit/p11-kit-uri.c | 365 ++++++++++++++++++++++++++++++--------------------
 p11-kit/p11-kit-uri.h |   9 +-
 tests/uri-test.c      | 103 ++++++++++++++
 3 files changed, 328 insertions(+), 149 deletions(-)

commit 7c2a8a5b3ad134b6e3093761d617936dcbd21adf
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-25

    Add p11_kit_uri_message() function.
    
    Gets messages for p11-kit error codes.

 p11-kit/debug.c       |  1 +
 p11-kit/debug.h       |  3 ++-
 p11-kit/p11-kit-uri.c | 38 ++++++++++++++++++++++++++++++++++++++
 p11-kit/p11-kit-uri.h |  2 ++
 4 files changed, 43 insertions(+), 1 deletion(-)

commit a01f4351e34fee946d1ffb81baa31a756e2851be
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-05-24

    Fix null pointer dereference.

 p11-kit/p11-kit-lib.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit e16a0a7183bd7c400ea3df12ad6ee1155a17634c
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-04-05

    Fix lots of bugs and add more debugging statements.

 p11-kit/conf.c        |  3 ++-
 p11-kit/p11-kit-lib.c | 51 +++++++++++++++++++++++++++++++++++++++++----------
 2 files changed, 43 insertions(+), 11 deletions(-)

commit 4d7cf526a352d7c9a02d05a308eef937b1a8987d
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-04-05

    Add basic tool for p11-kit.
    
    List modules:
     $ p11-kit -l

 .gitignore        |   2 +
 Makefile.am       |   1 +
 configure.ac      |   1 +
 tools/Makefile.am |  12 ++++++
 tools/p11-kit.c   | 121 ++++++++++++++++++++++++++++++++++++++++++++++++++++++
 5 files changed, 137 insertions(+)

commit 6078d6d73bc2eb1dbf2283b37d9507297fefba9d
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-04-05

    Add support for debug tracing.
    
    Use P11_KIT_DEBUG=xxx environment variable to enable tracing. Must
    have been built without --disable-debug option.
    
    P11_KIT_DEBUG can (at this point) be one of these values:
     all
     help
     conf
     lib

 .gitignore            |   1 +
 configure.ac          |  23 ++++++---
 doc/Makefile.am       |   2 +-
 p11-kit/Makefile.am   |   1 +
 p11-kit/conf.c        |   7 +++
 p11-kit/debug.c       | 136 ++++++++++++++++++++++++++++++++++++++++++++++++++
 p11-kit/debug.h       |  93 ++++++++++++++++++++++++++++++++++
 p11-kit/p11-kit-lib.c |  17 ++++++-
 8 files changed, 272 insertions(+), 8 deletions(-)

commit aada8e3d41c3be7cdc7e0994c7dff7c307fbbe7f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-04-01

    Fix up copyright lines.

 p11-kit/conf.c            | 4 ++--
 p11-kit/conf.h            | 4 ++--
 p11-kit/hash.c            | 4 ++--
 p11-kit/hash.h            | 4 ++--
 p11-kit/p11-kit-lib.c     | 2 +-
 p11-kit/p11-kit-private.h | 2 +-
 p11-kit/p11-kit-proxy.c   | 2 +-
 p11-kit/p11-kit-uri.h     | 2 +-
 p11-kit/p11-kit.h         | 2 +-
 p11-kit/util.c            | 1 -
 p11-kit/util.h            | 1 -
 11 files changed, 13 insertions(+), 15 deletions(-)

commit 579d40eff31c7a17cc4e4f07d26c6189619fee31
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Add C++ header guards, and require API instability acknowledgement.

 p11-kit/Makefile.am   |  3 +++
 p11-kit/p11-kit-uri.h | 23 ++++++++++++++++++++---
 p11-kit/p11-kit.h     | 17 +++++++++++++++++
 tests/Makefile.am     |  3 ++-
 4 files changed, 42 insertions(+), 4 deletions(-)

commit cf988aa7858d249887ea0818301c7211bb3cab38
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Support setting of CK_C_INITIALIZE_ARGS.pReserved to string.
    
    This is a naughty little thing that a lot of PKCS#11 modules require
    to be properly initialized. So we support setting pReserved to a string
    that is in the config under the 'x-init-reserved' parameter.

 p11-kit/p11-kit-lib.c | 7 +++++++
 1 file changed, 7 insertions(+)

commit 540a00501ba682b420b143480d5864335cad6c71
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Give reference chapter an explicit id.

 doc/p11-kit-docs.sgml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 52dab5cd52b19352e9f29b16c686fc545d2aadf1
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Add make target for uploading docs.

 Makefile.am | 6 ++++++
 1 file changed, 6 insertions(+)

commit a0ef9771b882bf2dc5bd56fcc6bcfdf47ed90feb
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Mix in other documentation.

 doc/Makefile.am                  |  2 +-
 doc/p11-kit-config.xml           | 10 +++--
 doc/p11-kit-docs.sgml            | 12 ++++--
 doc/p11-kit-multiple-problem.xml | 92 ----------------------------------------
 doc/p11-kit-sharing.xml          | 92 ++++++++++++++++++++++++++++++++++++++++
 doc/style.css                    | 17 +++++---
 6 files changed, 117 insertions(+), 108 deletions(-)

commit ca1d8a09e05444de07a1ad722b57f5dcae042892
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Fix up styling and tweaks.

 doc/style.css              | 24 +++++++++++++++++-------
 p11-kit/p11-kit-messages.c |  4 ++--
 2 files changed, 19 insertions(+), 9 deletions(-)

commit 17ebc007ed0376bdea50294201a637be982d68b7
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Fix up styling of documentation.

 doc/p11-kit-docs.sgml |  2 +-
 doc/style.css         | 70 +++++++++++++++++++++++++++++++++++++++++++++++++++
 gtk-doc.make          |  4 ++-
 3 files changed, 74 insertions(+), 2 deletions(-)

commit 479cbd55ee5739d3cd2566379575451dbecf4c54
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Documentation and API cleanup.
    
     * Rename source directory
     * More consistent with return values from URI functions.
     * Allow formatting URI to take a uri type.

 .gitignore                 |   17 +
 Makefile.am                |    6 +-
 configure.ac               |   17 +-
 doc/Makefile.am            |   80 ++-
 doc/p11-kit-docs.sgml      |   24 +
 doc/p11-kit-overrides.txt  |    0
 doc/p11-kit-sections.txt   |   40 ++
 doc/version.xml.in         |    1 +
 gtk-doc.make               |  230 ++++++++
 module/Makefile.am         |   41 --
 module/conf.c              |  245 --------
 module/conf.h              |   51 --
 module/hash.c              |  453 ---------------
 module/hash.h              |  187 ------
 module/p11-kit-lib.c       | 1081 ----------------------------------
 module/p11-kit-messages.c  |  234 --------
 module/p11-kit-private.h   |   52 --
 module/p11-kit-proxy.c     | 1382 --------------------------------------------
 module/p11-kit-uri.c       |  951 ------------------------------
 module/p11-kit-uri.h       |  104 ----
 module/p11-kit.h           |   59 --
 module/p11-kit.pc.in       |   17 -
 module/pkcs11.h            | 1357 -------------------------------------------
 module/util.c              |   51 --
 module/util.h              |   45 --
 p11-kit/Makefile.am        |   40 ++
 p11-kit/conf.c             |  245 ++++++++
 p11-kit/conf.h             |   51 ++
 p11-kit/hash.c             |  452 +++++++++++++++
 p11-kit/hash.h             |  187 ++++++
 p11-kit/p11-kit-lib.c      | 1130 ++++++++++++++++++++++++++++++++++++
 p11-kit/p11-kit-messages.c |  242 ++++++++
 p11-kit/p11-kit-private.h  |   52 ++
 p11-kit/p11-kit-proxy.c    | 1382 ++++++++++++++++++++++++++++++++++++++++++++
 p11-kit/p11-kit-uri.c      | 1195 ++++++++++++++++++++++++++++++++++++++
 p11-kit/p11-kit-uri.h      |  105 ++++
 p11-kit/p11-kit.h          |   59 ++
 p11-kit/p11-kit.pc         |   17 +
 p11-kit/p11-kit.pc.in      |   17 +
 p11-kit/pkcs11.h           | 1357 +++++++++++++++++++++++++++++++++++++++++++
 p11-kit/util.c             |   51 ++
 p11-kit/util.h             |   45 ++
 tests/Makefile.am          |    8 +-
 tests/uri-test.c           |   82 +--
 44 files changed, 7064 insertions(+), 6378 deletions(-)

commit 6132cd99c39739ef5360e41e92f22d287007577e
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    WIP

 module/p11-kit-lib.c | 119 +++++++++++++++++++++++++++++++++++++++++++++++++++
 module/p11-kit-uri.c |  43 +++++++++++++++++++
 2 files changed, 162 insertions(+)

commit c45d9df39035dee8a3fff610d98ac3b4c245f1dc
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Fix for previous commit.
    
    Actually use the alloc_module_unlocked() function.

 module/p11-kit-lib.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

commit 9985957799fd7142125f1d2dd0fae4366ec83f32
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-31

    Custom initialization and finalization arguments cannot be supported.
    
    When multiple consumers are using a PKCS#11 module, initialization
    (and finalization) arguments cannot be supported. The first one calling
    would win out, and the others would get unexpected behavior.

 module/p11-kit-lib.c     | 193 ++++++++++++++++++++++++-----------------------
 module/p11-kit-private.h |   4 +-
 module/p11-kit-proxy.c   |   4 +-
 module/p11-kit.h         |   6 +-
 4 files changed, 104 insertions(+), 103 deletions(-)

commit 1104f03d9b34cc659838124e00ac864c35af4f82
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-03

    Add info and copyright.

 doc/p11-kit.xml | 42 ++++++++++++++++++++++++++++++++++--------
 1 file changed, 34 insertions(+), 8 deletions(-)

commit d05a04968e07f6a2084ceb747938dc7cc049cb5f
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-03-03

    The start of some documentation.

 .gitignore                       |   2 +
 Makefile.am                      |   2 +-
 configure.ac                     |   1 +
 doc/Makefile.am                  |  22 ++++++++
 doc/docbook-params.xsl           |  39 +++++++++++++
 doc/p11-kit-config.xml           | 119 +++++++++++++++++++++++++++++++++++++++
 doc/p11-kit-multiple-problem.xml |  92 ++++++++++++++++++++++++++++++
 doc/p11-kit.xml                  |  11 ++++
 8 files changed, 287 insertions(+), 1 deletion(-)

commit 25cbc9b3293f2c6df38bd0528b89101e5e547321
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-02-21

    Add uri function for listing which attribute types are present.

 module/p11-kit-uri.c | 24 +++++++++++++++++++++++-
 module/p11-kit-uri.h |  3 +++
 2 files changed, 26 insertions(+), 1 deletion(-)

commit ff7db14f0acae463165377f2d4b999e566298b40
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-02-21

    Fix bug where we try to dlclose() modules we didn't load.

 module/p11-kit-lib.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

commit 1d9ca2ddb4df85b7235ec78e4996cf2d1fd775a2
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-02-19

    Reference implementation of PKCS#11 URIs

 .gitignore             |    1 +
 module/Makefile.am     |    3 +
 module/p11-kit-proxy.c |   14 +-
 module/p11-kit-uri.c   |  886 ++++++++++++++++++++++++++++++++++++++++
 module/p11-kit-uri.h   |  101 +++++
 module/p11-kit.h       |    2 +
 module/util.c          |   51 +++
 module/util.h          |   45 +++
 tests/Makefile.am      |    7 +-
 tests/uri-test.c       | 1050 ++++++++++++++++++++++++++++++++++++++++++++++++
 10 files changed, 2146 insertions(+), 14 deletions(-)

commit 65509aa3a7c35d8bd5a947ca87c14d4de11deb21
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-02-18

    Add p11_kit_strerror() method and internationalization.

 .gitignore                |    5 +
 ABOUT-NLS                 | 1281 +++++++++++++++++++++++++++++++++++++++++++++
 Makefile.am               |    4 +-
 configure.ac              |    4 +
 module/Makefile.am        |   14 +-
 module/p11-kit-lib.c      |    4 +-
 module/p11-kit-messages.c |  234 +++++++++
 module/p11-kit.h          |    2 +
 po/Makefile.in.in         |  444 ++++++++++++++++
 po/Makevars               |   41 ++
 po/POTFILES.in            |    2 +
 po/Rules-quot             |   47 ++
 po/boldquot.sed           |   10 +
 po/en@boldquot.header     |   25 +
 po/en@quot.header         |   22 +
 po/insert-header.sin      |   23 +
 po/p11-kit.pot            |  342 ++++++++++++
 po/quot.sed               |    6 +
 po/remove-potcdate.sin    |   19 +
 19 files changed, 2523 insertions(+), 6 deletions(-)

commit 5cc83571c3e0e212f4d84b05bb15088409d9c752
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-02-17

    Properly read user-config setting.
    
     * Unless the system 'user-config' setting is 'none' we allow
       the user to override or merge all settings, including the
       'user-config' setting.

 module/p11-kit-lib.c | 187 ++++++++++++++++++++++++++++++++++++++++-----------
 1 file changed, 146 insertions(+), 41 deletions(-)

commit 80fe1806941d555433f3a1c97ab116dd281041e0
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-02-17

    Add a proper pkg-config file.

 .gitignore           |  2 ++
 configure.ac         | 25 ++++++++++++++-----------
 module/Makefile.am   | 10 +++++-----
 module/p11-kit.pc.in | 17 +++++++++++++++++
 4 files changed, 38 insertions(+), 16 deletions(-)

commit c03b1023835887569315fbec6295be3cc0f4cf42
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-02-17

    Only allow colon between name and value.

 module/conf.c           | 4 ++--
 tests/files/test-1.conf | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

commit 14dfb79ca65dd80e117103c4f8852ae2b4a419a0
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-01-30

    Configuration tests.

 .gitignore              |   1 +
 module/conf.c           |  25 ++++++----
 module/conf.h           |   6 +--
 module/p11-kit-lib.c    |   8 ++--
 tests/Makefile.am       |  13 ++++--
 tests/conf-test.c       | 121 ++++++++++++++++++++++++++++++++++++++++++++++++
 tests/files/test-1.conf |   6 +++
 7 files changed, 158 insertions(+), 22 deletions(-)

commit 4375e297b19bc2177e17cc5616e75d96be053328
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-01-26

    Add testing and start testing hash table functionality.

 .gitignore               |   8 +
 Makefile.am              |  12 +-
 configure.ac             |  42 ++++++
 module/Makefile.am       |  16 +-
 module/hash.c            |  15 ++
 module/hash.h            |   5 +
 tests/Makefile.am        |  17 +++
 tests/cutest/CuTest.c    | 339 ++++++++++++++++++++++++++++++++++++++++++
 tests/cutest/CuTest.h    | 116 +++++++++++++++
 tests/cutest/README.txt  | 211 ++++++++++++++++++++++++++
 tests/cutest/license.txt |  38 +++++
 tests/hash-test.c        | 377 +++++++++++++++++++++++++++++++++++++++++++++++
 12 files changed, 1191 insertions(+), 5 deletions(-)

commit f8009b4d504de0ed752b867893acd263108409e0
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-01-24

    Reinitialize modules after fork().

 module/p11-kit-lib.c     | 51 ++++++++++++++++++++++++++++++++++++++++++++----
 module/p11-kit-private.h |  1 +
 module/p11-kit-proxy.c   | 18 +++++++++++++++++
 3 files changed, 66 insertions(+), 4 deletions(-)

commit b2b0acbc5789823a33de9eabec10e2b8656f3632
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-01-24

    Initial implementation with new config system.

 configure.ac             |    3 +-
 module/Makefile.am       |   10 +-
 module/conf.c            |  240 ++++++
 module/conf.h            |   51 ++
 module/hash.c            |  512 ++++++------
 module/hash.h            |  110 ++-
 module/p11-kit-lib.c     |  810 +++++++++++++++++++
 module/p11-kit-private.h |   51 ++
 module/p11-kit-proxy.c   | 1376 ++++++++++++++++++++++++++++++++
 module/p11-kit.c         | 1974 ----------------------------------------------
 module/p11-kit.h         |   12 +-
 11 files changed, 2885 insertions(+), 2264 deletions(-)

commit 5a53e44a73d4fb62483e890fe348ea40d27ef573
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-01-24

    Rename to p11-kit.
    
    A less pretentios, better description of what's going on.

 ChangeLog          |    2 +-
 configure.ac       |    4 +-
 module/Makefile.am |    8 +-
 module/p11-kit.c   | 1974 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 module/p11-kit.h   |   57 ++
 module/p11-unity.c | 1974 ----------------------------------------------------
 module/p11-unity.h |   57 --
 7 files changed, 2038 insertions(+), 2038 deletions(-)

commit 492c2ff7c191e5df75140a47e4e43fa25fd16023
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-01-22

    Rework public library API so that we can initialize arbitrary
    modules.

 module/p11-unity.c | 752 ++++++++++++++++++++++++++++++++++-------------------
 module/p11-unity.h |  21 +-
 2 files changed, 502 insertions(+), 271 deletions(-)

commit c2a5aaf7baf4bcc006674a1938205f93028b8ab0
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-01-22

    Rough idea of possible library functions.

 configure.ac       |   5 +-
 module/p11-unity.c | 307 ++++++++++++++++++++++++++++++++++++++++++++---------
 module/p11-unity.h |  56 ++++++++++
 3 files changed, 314 insertions(+), 54 deletions(-)

commit a50ba779ff3e0a5d4f35fb2b6ab525a423575cc4
Author: Stef Walter <stefw@collabora.co.uk>
Date:   2011-01-20

    Initial implementation of p11-unity

 .gitignore         |   31 ++
 AUTHORS            |    1 +
 COPYING            |   47 ++
 ChangeLog          |   31 ++
 Makefile.am        |   18 +
 NEWS               |    2 +
 README             |    1 +
 autogen.sh         |   21 +
 configure.ac       |   90 +++
 module/Makefile.am |   18 +
 module/hash.c      |  400 ++++++++++++++
 module/hash.h      |  158 ++++++
 module/p11-unity.c | 1543 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 module/pkcs11.h    | 1357 +++++++++++++++++++++++++++++++++++++++++++++
 14 files changed, 3718 insertions(+)
